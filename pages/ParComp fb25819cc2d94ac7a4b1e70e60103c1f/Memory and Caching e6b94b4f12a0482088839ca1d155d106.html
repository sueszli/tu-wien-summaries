<html><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"/><title>Memory and Caching</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
-webkit-print-color-adjust: exact;
}
* {
box-sizing: border-box;
-webkit-print-color-adjust: exact;
}html,
body {
margin: 0;
padding: 0;
}
@media only screen {
body {
margin: 2em auto;
max-width: 900px;
color: rgb(55, 53, 47);
}
}body {
line-height: 1.5;
white-space: pre-wrap;
}a,
a.visited {
color: inherit;
text-decoration: underline;
}.pdf-relative-link-path {
font-size: 80%;
color: #444;
}h1,
h2,
h3 {
letter-spacing: -0.01em;
line-height: 1.2;
font-weight: 600;
margin-bottom: 0;
}.page-title {
font-size: 2.5rem;
font-weight: 700;
margin-top: 0;
margin-bottom: 0.75em;
}h1 {
font-size: 1.875rem;
margin-top: 1.875rem;
}h2 {
font-size: 1.5rem;
margin-top: 1.5rem;
}h3 {
font-size: 1.25rem;
margin-top: 1.25rem;
}.source {
border: 1px solid #ddd;
border-radius: 3px;
padding: 1.5em;
word-break: break-all;
}.callout {
border-radius: 3px;
padding: 1rem;
}figure {
margin: 1.25em 0;
page-break-inside: avoid;
}figcaption {
opacity: 0.5;
font-size: 85%;
margin-top: 0.5em;
}mark {
background-color: transparent;
}.indented {
padding-left: 1.5em;
}hr {
background: transparent;
display: block;
width: 100%;
height: 1px;
visibility: visible;
border: none;
border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}img {
max-width: 100%;
}@media only print {
img {
max-height: 100vh;
object-fit: contain;
}
}@page {
margin: 1in;
}.collection-content {
font-size: 0.875rem;
}.column-list {
display: flex;
justify-content: space-between;
}.column {
padding: 0 1em;
}.column:first-child {
padding-left: 0;
}.column:last-child {
padding-right: 0;
}.table_of_contents-item {
display: block;
font-size: 0.875rem;
line-height: 1.3;
padding: 0.125rem;
}.table_of_contents-indent-1 {
margin-left: 1.5rem;
}.table_of_contents-indent-2 {
margin-left: 3rem;
}.table_of_contents-indent-3 {
margin-left: 4.5rem;
}.table_of_contents-link {
text-decoration: none;
opacity: 0.7;
border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}table,
th,
td {
border: 1px solid rgba(55, 53, 47, 0.09);
border-collapse: collapse;
}table {
border-left: none;
border-right: none;
}th,
td {
font-weight: normal;
padding: 0.25em 0.5em;
line-height: 1.5;
min-height: 1.5em;
text-align: left;
}th {
color: rgba(55, 53, 47, 0.6);
}ol,
ul {
margin: 0;
margin-block-start: 0.6em;
margin-block-end: 0.6em;
}li > ol:first-child,
li > ul:first-child {
margin-block-start: 0.6em;
}ul > li {
list-style: disc;
}ul.to-do-list {
padding-inline-start: 0;
}ul.to-do-list > li {
list-style: none;
}.to-do-children-checked {
text-decoration: line-through;
opacity: 0.375;
}ul.toggle > li {
list-style: none;
}ul {
padding-inline-start: 1.7em;
}ul > li {
padding-left: 0.1em;
}ol {
padding-inline-start: 1.6em;
}ol > li {
padding-left: 0.2em;
}.mono ol {
padding-inline-start: 2em;
}.mono ol > li {
text-indent: -0.4em;
}.toggle {
padding-inline-start: 0em;
list-style-type: none;
}/* Indent toggle children */
.toggle > li > details {
padding-left: 1.7em;
}.toggle > li > details > summary {
margin-left: -1.1em;
}.selected-value {
display: inline-block;
padding: 0 0.5em;
background: rgba(206, 205, 202, 0.5);
border-radius: 3px;
margin-right: 0.5em;
margin-top: 0.3em;
margin-bottom: 0.3em;
white-space: nowrap;
}.collection-title {
display: inline-block;
margin-right: 1em;
}.page-description {
margin-bottom: 2em;
}.simple-table {
margin-top: 1em;
font-size: 0.875rem;
empty-cells: show;
}
.simple-table td {
height: 29px;
min-width: 120px;
}.simple-table th {
height: 29px;
min-width: 120px;
}.simple-table-header-color {
background: rgb(247, 246, 243);
color: black;
}
.simple-table-header {
font-weight: 500;
}time {
opacity: 0.5;
}.icon {
display: inline-block;
max-width: 1.2em;
max-height: 1.2em;
text-decoration: none;
vertical-align: text-bottom;
margin-right: 0.5em;
}img.icon {
border-radius: 3px;
}.user-icon {
width: 1.5em;
height: 1.5em;
border-radius: 100%;
margin-right: 0.5rem;
}.user-icon-inner {
font-size: 0.8em;
}.text-icon {
border: 1px solid #000;
text-align: center;
}.page-cover-image {
display: block;
object-fit: cover;
width: 100%;
max-height: 30vh;
}.page-header-icon {
font-size: 3rem;
margin-bottom: 1rem;
}.page-header-icon-with-cover {
margin-top: -0.72em;
margin-left: 0.07em;
}.page-header-icon img {
border-radius: 3px;
}.link-to-page {
margin: 1em 0;
padding: 0;
border: none;
font-weight: 500;
}p > .user {
opacity: 0.5;
}td > .user,
td > time {
white-space: nowrap;
}input[type="checkbox"] {
transform: scale(1.5);
margin-right: 0.6em;
vertical-align: middle;
}p {
margin-top: 0.5em;
margin-bottom: 0.5em;
}.image {
border: none;
margin: 1.5em 0;
padding: 0;
border-radius: 0;
text-align: center;
}.code,
code {
background: rgba(135, 131, 120, 0.15);
border-radius: 3px;
padding: 0.2em 0.4em;
border-radius: 3px;
font-size: 85%;
tab-size: 2;
}code {
color: #eb5757;
}.code {
padding: 1.5em 1em;
}.code-wrap {
white-space: pre-wrap;
word-break: break-all;
}.code > code {
background: none;
padding: 0;
font-size: 100%;
color: inherit;
}blockquote {
font-size: 1.25em;
margin: 1em 0;
padding-left: 1em;
border-left: 3px solid rgb(55, 53, 47);
}.bookmark {
text-decoration: none;
max-height: 8em;
padding: 0;
display: flex;
width: 100%;
align-items: stretch;
}.bookmark-title {
font-size: 0.85em;
overflow: hidden;
text-overflow: ellipsis;
height: 1.75em;
white-space: nowrap;
}.bookmark-text {
display: flex;
flex-direction: column;
}.bookmark-info {
flex: 4 1 180px;
padding: 12px 14px 14px;
display: flex;
flex-direction: column;
justify-content: space-between;
}.bookmark-image {
width: 33%;
flex: 1 1 180px;
display: block;
position: relative;
object-fit: cover;
border-radius: 1px;
}.bookmark-description {
color: rgba(55, 53, 47, 0.6);
font-size: 0.75em;
overflow: hidden;
max-height: 4.5em;
word-break: break-word;
}.bookmark-href {
font-size: 0.75em;
margin-top: 0.25em;
}.sans {
font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji",
"Segoe UI Symbol";
}
.code {
font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace;
}
.serif {
font-family: Lyon-Text, Georgia, ui-serif, serif;
}
.mono {
font-family: iawriter-mono, Nitti, Menlo, Courier, monospace;
}
.pdf .sans {
font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif,
"Segoe UI Emoji", "Segoe UI Symbol", "Twemoji", "Noto Color Emoji", "Noto Sans CJK JP";
}
.pdf:lang(zh-CN) .sans {
font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif,
"Segoe UI Emoji", "Segoe UI Symbol", "Twemoji", "Noto Color Emoji", "Noto Sans CJK SC";
}
.pdf:lang(zh-TW) .sans {
font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif,
"Segoe UI Emoji", "Segoe UI Symbol", "Twemoji", "Noto Color Emoji", "Noto Sans CJK TC";
}
.pdf:lang(ko-KR) .sans {
font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif,
"Segoe UI Emoji", "Segoe UI Symbol", "Twemoji", "Noto Color Emoji", "Noto Sans CJK KR";
}
.pdf .code {
font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, "Twemoji", "Noto Color Emoji",
"Noto Sans Mono CJK JP";
}
.pdf:lang(zh-CN) .code {
font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, "Twemoji", "Noto Color Emoji",
"Noto Sans Mono CJK SC";
}
.pdf:lang(zh-TW) .code {
font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, "Twemoji", "Noto Color Emoji",
"Noto Sans Mono CJK TC";
}
.pdf:lang(ko-KR) .code {
font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, "Twemoji", "Noto Color Emoji",
"Noto Sans Mono CJK KR";
}
.pdf .serif {
font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, "Twemoji", "Noto Color Emoji", "Noto Serif CJK JP";
}
.pdf:lang(zh-CN) .serif {
font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, "Twemoji", "Noto Color Emoji", "Noto Serif CJK SC";
}
.pdf:lang(zh-TW) .serif {
font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, "Twemoji", "Noto Color Emoji", "Noto Serif CJK TC";
}
.pdf:lang(ko-KR) .serif {
font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, "Twemoji", "Noto Color Emoji", "Noto Serif CJK KR";
}
.pdf .mono {
font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, "Twemoji", "Noto Color Emoji", "Noto Sans Mono CJK JP";
}
.pdf:lang(zh-CN) .mono {
font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, "Twemoji", "Noto Color Emoji", "Noto Sans Mono CJK SC";
}
.pdf:lang(zh-TW) .mono {
font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, "Twemoji", "Noto Color Emoji", "Noto Sans Mono CJK TC";
}
.pdf:lang(ko-KR) .mono {
font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, "Twemoji", "Noto Color Emoji", "Noto Sans Mono CJK KR";
}
.highlight-default {
color: rgba(55, 53, 47, 1);
}
.highlight-gray {
color: rgba(120, 119, 116, 1);
fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
color: rgba(159, 107, 83, 1);
fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
color: rgba(217, 115, 13, 1);
fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
color: rgba(203, 145, 47, 1);
fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
color: rgba(68, 131, 97, 1);
fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
color: rgba(51, 126, 169, 1);
fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
color: rgba(144, 101, 176, 1);
fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
color: rgba(193, 76, 138, 1);
fill: rgba(193, 76, 138, 1);
}
.highlight-red {
color: rgba(212, 76, 71, 1);
fill: rgba(212, 76, 71, 1);
}
.highlight-gray_background {
background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
background: rgba(253, 235, 236, 1);
}
.block-color-default {
color: inherit;
fill: inherit;
}
.block-color-gray {
color: rgba(120, 119, 116, 1);
fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
color: rgba(159, 107, 83, 1);
fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
color: rgba(217, 115, 13, 1);
fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
color: rgba(203, 145, 47, 1);
fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
color: rgba(68, 131, 97, 1);
fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
color: rgba(51, 126, 169, 1);
fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
color: rgba(144, 101, 176, 1);
fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
color: rgba(193, 76, 138, 1);
fill: rgba(193, 76, 138, 1);
}
.block-color-red {
color: rgba(212, 76, 71, 1);
fill: rgba(212, 76, 71, 1);
}
.block-color-gray_background {
background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
background: rgba(253, 235, 236, 1);
}
.select-value-color-interactiveBlue {
background-color: rgba(35, 131, 226, 0.07);
}
.select-value-color-pink {
background-color: rgba(245, 224, 233, 1);
}
.select-value-color-purple {
background-color: rgba(232, 222, 238, 1);
}
.select-value-color-green {
background-color: rgba(219, 237, 219, 1);
}
.select-value-color-gray {
background-color: rgba(227, 226, 224, 1);
}
.select-value-color-translucentGray {
background-color: rgba(255, 255, 255, 0.0375);
}
.select-value-color-orange {
background-color: rgba(250, 222, 201, 1);
}
.select-value-color-brown {
background-color: rgba(238, 224, 218, 1);
}
.select-value-color-red {
background-color: rgba(255, 226, 221, 1);
}
.select-value-color-yellow {
background-color: rgba(253, 236, 200, 1);
}
.select-value-color-blue {
background-color: rgba(211, 229, 239, 1);
}
.select-value-color-pageGlass {
background-color: undefined;
}
.select-value-color-washGlass {
background-color: undefined;
}.checkbox {
display: inline-flex;
vertical-align: text-bottom;
width: 16;
height: 16;
background-size: 16px;
margin-left: 2px;
margin-right: 5px;
}.checkbox-on {
background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}.checkbox-off {
background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}/* -------- injections from notionBackup -------- */body {
white-space: normal !important;
}p {
min-height: 1em !important;
}.code,
code {
font-size: 100% !important;
}blockquote {
font-size: 100% !important;
}.callout {
white-space: normal !important;
}
.callout div:has(span.icon) {
font-size: 100% !important;
}.source:not(.bookmark) {
font-size: 100% !important;
}p {
min-height: 1em !important;
}
</style></head><body><article class="page sans"><header><h1 class="page-title">Memory and Caching</h1><p class="page-description"></p></header><div class="page-body"><p></p><nav class="block-color-gray table_of_contents"><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#f8443035-3f1c-45f8-ac6c-6aad4a845395">Definition</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#79f725e9-4478-40e3-91f8-cc8b12f05357">Shared-memory model</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#e54a7517-6564-4e45-b39f-f87e5c36766b">Cache</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#64b8047c-19e5-45b3-b87a-a2298ce64000">Cache read/write-miss</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#e88ebb51-cb42-483c-ac42-aacc3ab96d8b">Cache impact on performance</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#9b1230d6-9ecf-4392-bd40-e51d33209c8e">Example: Matrix-Matrix multiplication</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#a2f0f739-9f03-4818-bc85-2c118175c755">Recursive solution</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#818f25e1-5345-4a25-8253-6da60788403d">Cache coherence</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#3a73a0cc-acd7-4121-ac6b-fd9d683a6371">False sharing</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#dc607523-0ab7-4699-86f4-4907acbc9c2f">NUMA memory performance</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#b5c70856-51f7-45f6-914a-529a8fc7cc17">Super-linear speedup</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#9ed87e22-4d20-4930-885e-6f38d226db0f">Application performance and memory system</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#caf82a95-08aa-4363-a83a-517d76d4db98">Program order and memory consistency</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#5323f8d2-30dd-4c92-9970-6cc651121256">Consistency models</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#31785a2d-a701-4e7a-9b06-406fefab5132">Programming models for memory</a></div></nav><p></p><h1>Definition</h1><p><mark class="highlight-blue">Modern terminology</mark></p><div class="indented"><p><mark class="highlight-teal">Core</mark></p><div class="indented"><p>CPU / Processing element PE (also still sometimes called processor)</p></div><p></p><p><mark class="highlight-teal">Processor</mark></p><div class="indented"><p>several cores that can execute a program</p><ul class="bulleted-list"><li style="list-style-type: disc"><em>Multi-core processor</em><p>Processor with several cores physically on the same chip. Always shared-memory (typically caches).</p></li></ul><ul class="bulleted-list"><li style="list-style-type: disc"><em>Many-core processor</em><p>Usually the GPU is meant.</p></li></ul></div><p></p><p><mark class="highlight-teal">Multi-processor system</mark></p><div class="indented"><p>System with several processors, not necessarily on the same chip.</p><p>The processors can be multi-core and can have shared-memory or shared caches.</p></div><p></p></div><p></p><figure class="image"><a href="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled.png"><img src="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled.png" style="width: 240px"/></a></figure><p></p><p><mark class="highlight-blue">Programming model concepts</mark></p><div class="indented"><p>Thread, process program under execution</p><p>Task some piece of work to be executed by a process or thread</p></div><p></p><p></p><p></p><h1>Shared-memory model</h1><p>Shared memory models for architectures and machines</p><p></p><p><mark class="highlight-blue">Naive shared memory model</mark></p><div class="indented"><p>Processors connected directly to memory (as in UMA or NUMA)</p><p>Read/write operations done independently (not PRAM, not lock-step, not synchronized)</p><p><em>Implicit assumption:</em></p><div class="indented"><ul class="bulleted-list"><li style="list-style-type: disc">
Outcome is an
<em>interleaving</em>
of the instructions.
</li></ul><ul class="bulleted-list"><li style="list-style-type: disc">
Memory is
<em>consistent</em>
as defined by program order (read and write order).
</li></ul></div><p></p></div><p></p><p><mark class="highlight-blue">Naive shared programming model</mark></p><div class="indented"><ol class="numbered-list" start="1" type="1"><li><mark class="highlight-teal">Processors execute processes/threads inside each process.</mark><p>Model does not specify which processor (core) executes it and there may be more threads than processors (oversubscription).</p><div class="indented"><p><em>Symmetric multiprocessing SMP</em>
OS binds thread to core.
</p><p><em>Improved performance by pinnning</em>
Explicitly binding thread to core.
</p><p><mark class="highlight-gray">ie. for utilization of private caches</mark></p><p><em>Parallel computing (dedicated system)</em>
Num. of cores = threads and some pinning.
</p></div><p></p></li></ol><ol class="numbered-list" start="2" type="1"><li><mark class="highlight-teal">Processes/threads are not synchronized.</mark></li></ol><ol class="numbered-list" start="3" type="1"><li><mark class="highlight-teal">Processes/threads exchange data through shared memory.</mark></li></ol><ol class="numbered-list" start="4" type="1"><li><mark class="highlight-teal">NUMA but entire memory is directly visible.</mark></li></ol></div><p></p><figure class="image"><a href="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled%201.png"><img src="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled%201.png" style="width: 240px"/></a></figure><p></p><h2>Cache</h2><p><mark class="highlight-blue">“Real” shared memory architecture</mark></p><div class="indented"><p>Cache (small and fast memory close to processor) and memory systems reduce memory bottleneck.</p><p>Modern processors use several different caches with different purposes and different levels.</p><div class="indented"><p>Main memory GB space, &gt;100 cycles per access</p><p><strong><mark class="highlight-teal">Cache</mark></strong><mark class="highlight-teal"></mark>
Kb to MB space, 1-20 cycles per access
</p><p>Register ≤64 bit, 0-1 cycles</p></div><p></p></div><p></p><div class="column-list"><div class="column" style="width: 25%"><figure class="image"><a href="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled%202.png"><img src="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled%202.png" style="width: 48px"/></a></figure></div><div class="column" style="width: 25%"><figure class="image"><a href="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled%203.png"><img src="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled%203.png" style="width: 96px"/></a></figure></div><div class="column" style="width: 25%"><figure class="image"><a href="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled%204.png"><img src="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled%204.png" style="width: 96px"/></a></figure></div><div class="column" style="width: 25%"><figure class="image"><a href="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled%205.png"><img src="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled%205.png" style="width: 96px"/></a></figure></div></div><p></p><p><mark class="highlight-blue">Cache as a problematic abstraction (illusion)</mark></p><div class="indented"><p>
In single processor architectures the cache contributes towards sustaining the RAM abstraction and is successful but in parallel
processor architectures the abstraction becomes problematic:
</p><p><mark class="highlight-teal"><em>Cache coherency problem</em></mark><em></em>
synchronizing caches: local copy of one cache gets updated
</p><p><mark class="highlight-teal"><em>Memory consistency problem</em></mark><em></em>
different views in threads of what should be the same data
</p></div><p></p><p></p><p><mark class="highlight-blue">Cache Granularity</mark></p><div class="indented"><p>
Cache consists of
<em>cache-lines/blocks</em>
of memory, used when reading/writing from main-memory.
</p><p>Typical size: 64Bytes (8 doubles, 16 ints)</p></div><p></p><p></p><p><mark class="highlight-blue">Locality</mark></p><div class="indented"><p>Caches make sense because of the following algorithm-properties:</p><div class="indented"><p><em>temporal locality</em>
locations in memory used are used several times in succession
</p><p><mark class="highlight-gray">ie. when using the same operand (address)</mark></p><p><em>spacial locality</em>
locations in memory used are close to eachother
</p><p><mark class="highlight-gray">ie. when using different indices of an array</mark></p></div><p></p></div><p></p><p></p><p><mark class="highlight-blue">Multiprocessor/multi-core caches</mark></p><div class="indented"><p>Shared memory, cache coherent NUMA (ccNUMA) through memory network.</p><p>Several cores share caches at different levels.</p></div><p></p><figure class="image"><a href="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled%206.png"><img src="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled%206.png" style="width: 132px"/></a></figure><p></p><p><mark class="highlight-blue">Mapping data from memory to cache</mark></p><div class="indented"><p>
Assume data
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"></mstyle></mrow><annotation encoding="application/x-tex">\small</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"></span></span></span><span>﻿</span></span>
occupies as much space as a block or less.
</p><ul class="bulleted-list"><li style="list-style-type: disc"><em>fully associative</em>
data can be stored in any cache-line
</li></ul><ul class="bulleted-list"><li style="list-style-type: disc"><em>set associative</em>
data can be stored in a small set of cache-lines
<ul class="toggle"><li><details open=""><summary>in depth</summary><p>
Memory:
<mark class="highlight-gray"><code>M[0, ..., n-1]</code></mark></p><p>
Cache:
<mark class="highlight-gray"><code>Lines [0, ..., m-1]</code></mark></p><div class="indented"><p>
where
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>m</mi><mo>≪</mo><mi>n</mi></mstyle></mrow><annotation encoding="application/x-tex">\small m \ll n</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.5203800000000001em; vertical-align: -0.035190000000000006em"></span><span class="mord mathnormal sizing reset-size6 size5">m</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span><span class="mrel sizing reset-size6 size5">≪</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height: 0.387504em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5">n</span></span></span></span></span><span>﻿</span></span>
and block size
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>s</mi></mstyle></mrow><annotation encoding="application/x-tex">\small s</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.387504em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5">s</span></span></span></span></span><span>﻿</span></span>
.
</p></div><p></p><hr/><p>
k-way set associative means that the cache lines are grouped in
<mark class="highlight-gray"><code>m/k</code></mark><mark class="highlight-gray"></mark>
sets — each set with
<mark class="highlight-gray"><code>k</code></mark><mark class="highlight-gray"></mark>
cache-lines.
</p><p><mark class="highlight-gray"><code>M[i]</code></mark><mark class="highlight-gray"></mark>
is cached in set
<mark class="highlight-gray"><code>(i/s) mod (m/k)</code></mark></p><hr/><p>
Usually
<mark class="highlight-gray"><code>m=2^r</code></mark><mark class="highlight-gray"></mark>
and
<mark class="highlight-gray"><code>s=2^r'</code></mark><mark class="highlight-gray"></mark>
for some
<mark class="highlight-gray"><code>r,r'&gt;0</code></mark></p><p>Mod and div then can be translated into mask and shift.</p><p></p></details></li></ul></li></ul><ul class="bulleted-list"><li style="list-style-type: disc"><em>directly mapped</em>
data can be stored in only one specific cache-line
<ul class="toggle"><li><details open=""><summary>in depth</summary><p>
Memory:
<mark class="highlight-gray"><code>M[0, ..., n-1]</code></mark></p><p>
Cache:
<mark class="highlight-gray"><code>Lines [0, ..., m-1]</code></mark></p><div class="indented"><p>
where
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>m</mi><mo>≪</mo><mi>n</mi></mstyle></mrow><annotation encoding="application/x-tex">\small m \ll n</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.5203800000000001em; vertical-align: -0.035190000000000006em"></span><span class="mord mathnormal sizing reset-size6 size5">m</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span><span class="mrel sizing reset-size6 size5">≪</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height: 0.387504em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5">n</span></span></span></span></span><span>﻿</span></span>
and block size
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>s</mi></mstyle></mrow><annotation encoding="application/x-tex">\small s</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.387504em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5">s</span></span></span></span></span><span>﻿</span></span>
.
</p></div><p></p><hr/><p><mark class="highlight-gray"><code>M[i]</code></mark><mark class="highlight-gray"></mark>
is cached in line
<mark class="highlight-gray"><code>(i/s) mod m</code></mark></p><div class="indented"><p><mark class="highlight-gray"><code>M[0],…,M[s-1]</code></mark><mark class="highlight-gray"></mark>
go to line 0
</p><p><mark class="highlight-gray"><code>M[s],…,M[2s-1]</code></mark><mark class="highlight-gray"></mark>
to line 1
</p><div class="indented"><p>…</p></div><p></p><p><mark class="highlight-gray"><code>M[m],…,M[m+s-1]</code></mark>
again to line 0
</p><div class="indented"><p>…</p></div><p></p></div><p></p><hr/><p>
Usually
<mark class="highlight-gray"><code>m=2^r</code></mark><mark class="highlight-gray"></mark>
and
<mark class="highlight-gray"><code>s=2^r'</code></mark><mark class="highlight-gray"></mark>
for some
<mark class="highlight-gray"><code>r,r'&gt;0</code></mark></p><p>Mod and div then can be translated into mask and shift.</p><p></p></details></li></ul></li></ul></div><p></p><p></p><h2>Cache read/write-miss</h2><p>A “cache-hit” is when the address is already in the cache and ready to be read.</p><p></p><p><mark class="highlight-blue">Cache reading</mark></p><div class="indented"><p>Cache hit Read from cache</p><p>Read cache-miss Load block from memory into cache and read from cache</p></div><p></p><p></p><p><mark class="highlight-blue">Cache writing</mark></p><div class="indented"><p>Cache hit Overwrite cache (and memory or wait until block is evicted)</p><div class="indented"><p><mark class="highlight-teal">a) Write-back cache</mark></p><div class="indented"><p><mark class="highlight-gray">(typically also write-allocate)</mark></p><p>block is passed to memory, when it’s being evicted from cache</p></div><p></p><p><mark class="highlight-teal">b) Write-through cache</mark></p><div class="indented"><p><mark class="highlight-gray">(typically also write-non-allocate)</mark></p><p>each write to cache is immediately passed to memory</p></div><p></p></div><p></p><hr/><p>Write cache-miss Loading block from memory is optional</p><div class="indented"><p><mark class="highlight-teal">a) Write allocate</mark></p><div class="indented"><p>Load block from memory into cache, then overwrite</p></div><p></p><p><mark class="highlight-teal">b) Write non-allocate</mark></p><div class="indented"><p>Overwrite memory directly</p></div><p></p></div><p></p></div><p></p><p></p><p><mark class="highlight-blue">Types of misses</mark></p><div class="indented"><p>Cold cache</p><div class="indented"><p>Cache hasn’t been in use and is therefore empty.</p><ul class="bulleted-list"><li style="list-style-type: disc">Cold miss every (read) memory access that is a cache-miss</li></ul></div><p></p><p>Warm cache</p><div class="indented"><p>Cache has been in use.</p><ul class="bulleted-list"><li style="list-style-type: disc">Capacity miss entire cache full - some lines must be evicted</li></ul><ul class="bulleted-list"><li style="list-style-type: disc">Conflict miss specific line is full (not necessarily the whole cache) - must be evicted</li></ul></div><p></p></div><p></p><p></p><p><mark class="highlight-blue">Hit-rate, miss-rate</mark></p><div class="indented"><p>Memory references divided by number of instructions that hit or miss the catch.</p></div><p></p><p></p><p><mark class="highlight-blue">Eviction (removal) from cache</mark></p><div class="indented"><p>When there is a capacity or conflict miss, the cache evicts line to make room for new one.</p><p>For direct mapping caches we use the mapping.</p><p>For associative caches:</p><div class="indented"><p><em>LRU least recently used</em></p><p><em>LFU least frequently used</em></p><p><em>Random replacement</em></p></div><p></p></div><p></p><p></p><p></p><h1>Cache impact on performance</h1><p>Cache usually maintained in hardware (”free lunch”).</p><p>The cache impacts the sequential and parallel performance.</p><p></p><h2>Example: Matrix-Matrix multiplication</h2><p><mark class="highlight-blue">Matrix-Matrix multiplication</mark></p><div class="indented"><p><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>C</mi><mo>=</mo><mi>A</mi><mo>⋅</mo><mi>B</mi></mstyle></mrow><annotation encoding="application/x-tex">\small C = A\cdot B</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.614997em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.07153em">C</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span><span class="mrel sizing reset-size6 size5">=</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height: 0.614997em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5">A</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">⋅</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.614997em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.05017em">B</span></span></span></span></span><span>﻿</span></span>
(associative, distributive but not commutative)
</p><p><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>C</mi><mo stretchy="false">[</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">]</mo><mo>=</mo><msub><mo>∑</mo><mrow><mn>0</mn><mo>≤</mo><mi>k</mi><mo>&lt;</mo><mi>n</mi></mrow></msub><mi>A</mi><mo stretchy="false">[</mo><mi>i</mi><mo separator="true">,</mo><mi>k</mi><mo stretchy="false">]</mo><mo>⋅</mo><mi>B</mi><mo stretchy="false">[</mo><mi>k</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">]</mo></mstyle></mrow><annotation encoding="application/x-tex">\small C[i,j] = \sum_{0 \leq k &lt; n} A[i,k] \cdot B[k,j]</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.07153em">C</span><span class="mopen sizing reset-size6 size5">[</span><span class="mord mathnormal sizing reset-size6 size5">i</span><span class="mpunct sizing reset-size6 size5">,</span><span class="mspace" style="margin-right: 0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.05724em">j</span><span class="mclose sizing reset-size6 size5">]</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span><span class="mrel sizing reset-size6 size5">=</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height: 1.041591em; vertical-align: -0.366591em"></span><span class="mop sizing reset-size6 size5"><span class="mop op-symbol small-op" style="position: relative; top: -0.0000050000000000050004em">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.14628333333333327em"><span style="top: -2.2833233333333336em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mrel mtight">≤</span><span class="mord mathnormal mtight" style="margin-right: 0.03148em">k</span><span class="mrel mtight">&lt;</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4073233333333333em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size5">A</span><span class="mopen sizing reset-size6 size5">[</span><span class="mord mathnormal sizing reset-size6 size5">i</span><span class="mpunct sizing reset-size6 size5">,</span><span class="mspace" style="margin-right: 0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.03148em">k</span><span class="mclose sizing reset-size6 size5">]</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">⋅</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.05017em">B</span><span class="mopen sizing reset-size6 size5">[</span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.03148em">k</span><span class="mpunct sizing reset-size6 size5">,</span><span class="mspace" style="margin-right: 0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.05724em">j</span><span class="mclose sizing reset-size6 size5">]</span></span></span></span></span><span>﻿</span></span></p><pre class="code"><code>for (i=0; i&lt;n; i++) {
for (j=0; j&lt;n; j++) {
C[i][j] = 0;
for (k=0; k&lt;n; k++) {
C[i][j] += A[i][k]*B[k][j];
}
}
}</code></pre><p>Simple implementation based on mathematical definition (not the best).</p><p>
Work
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>3</mn></msup><mo stretchy="false">)</mo></mstyle></mrow><annotation encoding="application/x-tex">\small O(n^3)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.938364em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.02778em">O</span><span class="mopen sizing reset-size6 size5">(</span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7926266666666666em"><span style="top: -2.963em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mclose sizing reset-size6 size5">)</span></span></span></span></span><span>﻿</span></span></p><p>
Complexity
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>O</mi><mo stretchy="false">(</mo><mi>m</mi><mo>⋅</mo><msqrt><mi>m</mi></msqrt><mo stretchy="false">)</mo></mstyle></mrow><annotation encoding="application/x-tex">\small O(m \cdot \sqrt m)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.02778em">O</span><span class="mopen sizing reset-size6 size5">(</span><span class="mord mathnormal sizing reset-size6 size5">m</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">⋅</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.9452520000000001em; vertical-align: -0.225em"></span><span class="mord sqrt sizing reset-size6 size5"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.8002800000000001em"><span class="svg-align" style="top: -3em"><span class="pstrut" style="height: 3em"></span><span class="mord mathnormal" style="padding-left: 0.833em">m</span></span><span style="top: -2.76028em"><span class="pstrut" style="height: 3em"></span><span class="hide-tail" style="min-width: 0.853em; height: 1.08em"><svg height="1.08em" preserveaspectratio="xMinYMin slice" viewbox="0 0 400000 1080" width="400em"><path d="M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.23972em"><span></span></span></span></span></span><span class="mclose sizing reset-size6 size5">)</span></span></span></span></span><span>﻿</span></span>
where
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>m</mi><mo>=</mo><msup><mi>n</mi><mn>2</mn></msup></mstyle></mrow><annotation encoding="application/x-tex">\small m = n^2</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.387504em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5">m</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span><span class="mrel sizing reset-size6 size5">=</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height: 0.713364em; vertical-align: 0em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7926266666666666em"><span style="top: -2.963em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span></p></div><p></p><p></p><figure class="image"><a href="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled-2022-05-23-2016.excalidraw.svg"><img src="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled-2022-05-23-2016.excalidraw.svg" style="width: 240px"/></a></figure><p></p><p><mark class="highlight-blue">Interchanging loops impacts the performance</mark></p><div class="indented"><p>
The 3 loops can be interchanged:
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.8em"><mn>3</mn><mo stretchy="false">!</mo><mo>=</mo><mn>6</mn></mstyle></mrow><annotation encoding="application/x-tex">\footnotesize 3! = 6</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.5555519999999999em; vertical-align: 0em"></span><span class="mord sizing reset-size6 size4">3</span><span class="mclose sizing reset-size6 size4">!</span><span class="mspace" style="margin-right: 0.3252777777777778em"></span><span class="mrel sizing reset-size6 size4">=</span><span class="mspace" style="margin-right: 0.3252777777777778em"></span></span><span class="base"><span class="strut" style="height: 0.515552em; vertical-align: 0em"></span><span class="mord sizing reset-size6 size4">6</span></span></span></span></span><span>﻿</span></span>
possible variations.
</p><ul class="toggle"><li><details open=""><summary>
worst performance:
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>i</mi></mstyle></mrow><annotation encoding="application/x-tex">\small i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.593568em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5">i</span></span></span></span></span><span>﻿</span></span>
as the innermost loop (jki, kji)
</summary><pre class="code"><code>for (k=0; k&lt;n; k++) {
for (j=0; j&lt;n; j++) {
for (i=0; i&lt;n; i++) {
C[i][j] += A[i][k]*B[k][j];
}
}
}</code></pre><p><mark class="highlight-gray"><code>B[k][j]</code></mark>
is independent of
<mark class="highlight-gray"><code>i</code></mark>
.
</p><p>
Each iteration is 1 load for
<mark class="highlight-gray"><code>A[i][k]</code></mark><mark class="highlight-gray"></mark>
and 1 store for
<mark class="highlight-gray"><code>C[i][j]</code></mark>
:
</p><div class="indented"><p>they both are cache misses (assuming cache can store 2 matrix rows at most).</p></div><p></p><p></p></details></li></ul><ul class="toggle"><li><details open=""><summary>
medium performance:
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>k</mi></mstyle></mrow><annotation encoding="application/x-tex">\small k</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.624996em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.03148em">k</span></span></span></span></span><span>﻿</span></span>
as the innermost loop (ijk, jik)
</summary><pre class="code"><code>for (i=0; i&lt;n; i++) {
for (j=0; j&lt;n; j++) {
C[i][j] = 0;
for (k=0; k&lt;n; k++) {
C[i][j] += A[i][k]*B[k][j];
}
}
}</code></pre><p><mark class="highlight-gray"><code>C[i][j]</code></mark>
is independent of
<mark class="highlight-gray"><code>k</code></mark>
(update in register by compiler).
</p><p>
Each iteration is 2 loads for
<mark class="highlight-gray"><code>A[i][k]</code></mark>
,
<mark class="highlight-gray"><code>B[k][j]</code></mark>
and 1 store for
<mark class="highlight-gray"><code>C[i][j]</code></mark>
:
</p><div class="indented"><p>
each load of
<mark class="highlight-gray"><code>B[k][j]</code></mark><mark class="highlight-gray"></mark>
is a cache miss because the matrix is accessed in row order.
</p></div><p></p><p></p></details></li></ul><ul class="toggle"><li><details open=""><summary>
best performance:
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>j</mi></mstyle></mrow><annotation encoding="application/x-tex">\small j</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.768564em; vertical-align: -0.174996em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.05724em">j</span></span></span></span></span><span>﻿</span></span>
as the innermost loop (ikj, kij)
</summary><pre class="code"><code>// initialize C[i][j] = 0;for (i=0; i&lt;n; i++) {
for (k=0; k&lt;n; k++) {
for (j=0; j&lt;n; j++) {
C[i][j] += A[i][k]*B[k][j];
}
}
}</code></pre><p><mark class="highlight-gray"><code>A[i][k]</code></mark>
is independent of
<mark class="highlight-gray"><code>j</code></mark>
(update in register by compiler).
</p><p>
Each iteration is 1 load for
<mark class="highlight-gray"><code>B[k][j]</code></mark>
and 1 store for
<mark class="highlight-gray"><code>C[i][j]</code></mark>
:
</p><div class="indented"><p>Both are accessed in row order and the miss-rate is given by the cache-line size.</p><p>The spatial and temporal locality is exploited well.</p><p></p></div><p></p></details></li></ul></div><p></p><figure class="image"><a href="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled%207.png"><img src="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled%207.png" style="width: 144px"/></a></figure><p></p><div class="indented"><p>This is because how C stores matrices.</p><div class="indented"><p>Scanning the matrix in row order reduces the number of main-memory-accesses.</p><p>We load blocks of 8-16 elements into the cache.</p><p>If row &gt; cache, next row forces eviction.</p></div><p></p></div><p></p><figure class="image"><a href="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled%208.png"><img src="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled%208.png" style="width: 336px"/></a></figure><p></p><p><mark class="highlight-blue">Parallelization</mark></p><div class="indented"><p><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mstyle></mrow><annotation encoding="application/x-tex">\small i,j</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.768564em; vertical-align: -0.174996em"></span><span class="mord mathnormal sizing reset-size6 size5">i</span><span class="mpunct sizing reset-size6 size5">,</span><span class="mspace" style="margin-right: 0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.05724em">j</span></span></span></span></span><span>﻿</span></span>
loops fully independent (data parallel).
</p><p><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>k</mi></mstyle></mrow><annotation encoding="application/x-tex">\small k</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.624996em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.03148em">k</span></span></span></span></span><span>﻿</span></span>
loop should be in increasing order (unless commutativity of
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mo>+</mo></mstyle></mrow><annotation encoding="application/x-tex">\small +</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.599994em; vertical-align: -0.07499700000000001em"></span><span class="mord sizing reset-size6 size5">+</span></span></span></span></span><span>﻿</span></span>
is exploited)
</p><pre class="code"><code>par (0&lt;=i&lt;n, 0&lt;=j&lt;n) {
C[i][j] = 0;
for (k=0; k&lt;n; k++) {
C[i][j] += A[i][k]*B[k][j];
}
}</code></pre></div><p></p><p></p><h2>Recursive solution</h2><p><mark class="highlight-blue">Alternative solution: recursive</mark></p><div class="indented"><p>Recursively splitting matrices in half in both dimensions.</p><p>Each recursion level has 8 submatrix multiplications, 4 submatrix additions:</p><pre class="code"><code>C00 = A00 * B00 + A01 * B10
C01 = A00 * B01 + A01 * B11
C10 = A10 * B00 + A11 * B10
C11 = A10 * B01 + A11 * B11</code></pre><div class="column-list"><div class="column" style="width: 50%"><figure class="image"><a href="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled%209.png"><img src="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled%209.png" style="width: 240px"/></a></figure></div><div class="column" style="width: 50%"><figure class="image"><a href="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled%2010.png"><img src="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled%2010.png" style="width: 288px"/></a></figure></div></div></div><p></p><p></p><p><mark class="highlight-gray"><em>Calculated using the master theorem</em></mark></p><p>
Work
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>W</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><mn>8</mn><mo>⋅</mo><mi>W</mi><mo stretchy="false">(</mo><mi>n</mi><mi mathvariant="normal">/</mi><mn>2</mn><mo stretchy="false">)</mo><mo>+</mo><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><mi>n</mi><mn>2</mn><mo stretchy="false">)</mo><mo>=</mo><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>3</mn></msup><mo stretchy="false">)</mo></mstyle></mrow><annotation encoding="application/x-tex">\small W(n) = 8 \cdot W(n/2)+ \Theta(n2 ) = \Theta(n^3)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.13889em">W</span><span class="mopen sizing reset-size6 size5">(</span><span class="mord mathnormal sizing reset-size6 size5">n</span><span class="mclose sizing reset-size6 size5">)</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span><span class="mrel sizing reset-size6 size5">=</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height: 0.5799960000000001em; vertical-align: 0em"></span><span class="mord sizing reset-size6 size5">8</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">⋅</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.13889em">W</span><span class="mopen sizing reset-size6 size5">(</span><span class="mord mathnormal sizing reset-size6 size5">n</span><span class="mord sizing reset-size6 size5">/2</span><span class="mclose sizing reset-size6 size5">)</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord sizing reset-size6 size5">Θ</span><span class="mopen sizing reset-size6 size5">(</span><span class="mord mathnormal sizing reset-size6 size5">n</span><span class="mord sizing reset-size6 size5">2</span><span class="mclose sizing reset-size6 size5">)</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span><span class="mrel sizing reset-size6 size5">=</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height: 0.938364em; vertical-align: -0.225em"></span><span class="mord sizing reset-size6 size5">Θ</span><span class="mopen sizing reset-size6 size5">(</span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7926266666666666em"><span style="top: -2.963em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mclose sizing reset-size6 size5">)</span></span></span></span></span><span>﻿</span></span></p><p>number of nodes in an matrix-multiplication DAG</p><p>
Time
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>T</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><mi>T</mi><mo stretchy="false">(</mo><mi>n</mi><mi mathvariant="normal">/</mi><mn>2</mn><mo stretchy="false">)</mo><mo>+</mo><munder><munder><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>log</mi><mo>⁡</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><mo stretchy="true">undefined</mo></munder><mtext>recursion depth</mtext></munder><mo>=</mo><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><mi>log</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>n</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo stretchy="false">)</mo></mstyle></mrow><annotation encoding="application/x-tex">
\small T(n) = T(n/2)+ \underbrace{O(\log n)}_{\text{recursion depth}} =\Theta(\log(n)^2)
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.13889em">T</span><span class="mopen sizing reset-size6 size5">(</span><span class="mord mathnormal sizing reset-size6 size5">n</span><span class="mclose sizing reset-size6 size5">)</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span><span class="mrel sizing reset-size6 size5">=</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.13889em">T</span><span class="mopen sizing reset-size6 size5">(</span><span class="mord mathnormal sizing reset-size6 size5">n</span><span class="mord sizing reset-size6 size5">/2</span><span class="mclose sizing reset-size6 size5">)</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 2.196528em; vertical-align: -1.5215280000000002em"></span><span class="mord munder sizing reset-size6 size5"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.7499999999999998em"><span style="top: -1.4390399999999999em"><span class="pstrut" style="height: 3em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">recursion depth</span></span></span></span></span><span style="top: -2.9999999999999996em"><span class="pstrut" style="height: 3em"></span><span class="mord munder"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.75em"><span class="svg-align" style="top: -2.102em"><span class="pstrut" style="height: 3em"></span><span class="stretchy" style="height: 0.548em; min-width: 1.6em"><span class="brace-left" style="height: 0.548em"><svg height="0.548em" preserveaspectratio="xMinYMin slice" viewbox="0 0 400000 548" width="400em"><path d="M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13
35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688
0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7
-331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z"></path></svg></span><span class="brace-center" style="height: 0.548em"><svg height="0.548em" preserveaspectratio="xMidYMin slice" viewbox="0 0 400000 548" width="400em"><path d="M199572 214
c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14
53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3
11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0
-5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z"></path></svg></span><span class="brace-right" style="height: 0.548em"><svg height="0.548em" preserveaspectratio="xMaxYMin slice" viewbox="0 0 400000 548" width="400em"><path d="M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3
28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237
-174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z"></path></svg></span></span></span><span style="top: -3em"><span class="pstrut" style="height: 3em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.02778em">O</span><span class="mopen">(</span><span class="mop">
lo
<span style="margin-right: 0.01389em">g</span></span><span class="mspace" style="margin-right: 0.16666666666666666em"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.898em"><span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.690586666666667em"><span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2777777777777778em"></span><span class="mrel sizing reset-size6 size5">=</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height: 0.938364em; vertical-align: -0.225em"></span><span class="mord sizing reset-size6 size5">Θ</span><span class="mopen sizing reset-size6 size5">(</span><span class="mop sizing reset-size6 size5">
lo
<span style="margin-right: 0.01389em">g</span></span><span class="mopen sizing reset-size6 size5">(</span><span class="mord mathnormal sizing reset-size6 size5">n</span><span class="mclose sizing reset-size6 size5"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7926266666666666em"><span style="top: -2.963em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose sizing reset-size6 size5">)</span></span></span></span></span><span>﻿</span></span></p><p>length of the longest path</p><p></p><p><mark class="highlight-blue">Cache behavior</mark></p><div class="indented"><p>
Good - can be made
<em>cache oblivious</em>
(Good cache behavior is independent of actual cache size).
</p><p>
Can be made
<em>cache-aware</em>
: multiplying smaller matrices of size
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msup><mi>k</mi><mo lspace="0em" mathvariant="normal" rspace="0em">′</mo></msup><mo>×</mo><msup><mi>k</mi><mrow><mo mathvariant="normal">′</mo><mo mathvariant="normal">′</mo></mrow></msup></mstyle></mrow><annotation encoding="application/x-tex">\small k' \times k''</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.7350329999999999em; vertical-align: -0.07499700000000001em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal" style="margin-right: 0.03148em">k</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7333733333333333em"><span style="top: -2.963em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">×</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.660036em; vertical-align: 0em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal" style="margin-right: 0.03148em">k</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7333733333333333em"><span style="top: -2.963em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight"><span class="mord mtight">′′</span></span></span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>
so that they fit in cache (based on cache hierarchy).
</p></div><p></p><figure class="image"><a href="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled%2011.png"><img src="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled%2011.png" style="width: 192px"/></a></figure><p></p><ul class="toggle"><li><details open=""><summary><mark class="highlight-blue">Implementation in C</mark></summary><p>Two dimensional arrays are pointers:</p><div class="indented"><p>
ie:
<mark class="highlight-gray"><code>A[0][0 ... n-1]</code></mark>
is between the pointers
<mark class="highlight-gray"><code>A[0]</code></mark><mark class="highlight-gray"></mark>
and
<mark class="highlight-gray"><code>A[1]</code></mark>
.
</p></div><p></p><p>
We therefore represent each submatrix as
<mark class="highlight-gray"><code>A[m0 ... m1][k0 ... k1]</code></mark>
.
</p><p>
Result matrices ie.
<mark class="highlight-gray"><code>c0</code></mark>
have size
<mark class="highlight-gray"><code>(m1-m0)x(n1-n0)</code></mark>
.
</p><div class="indented"><figure class="image"><a href="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled%2012.png"><img src="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled%2012.png" style="width: 192px"/></a></figure></div><p></p><p></p><p>
For the recursive calls submatrices are computed using offsets
<mark class="highlight-gray"><code>mo</code></mark>
,
<mark class="highlight-gray"><code>no</code></mark>
.
</p><p>
The recursion is stopped when the smallest matrix has size
<mark class="highlight-gray"><code>m1-m0 &lt; CUTOFF</code></mark>
(determined experimentally).
</p><pre class="code"><code>void MM(
double A[][], double B[][],
int m0, int m1, int k0, int k1, int n0, int n1,
double C[][],
int mo, int no // offset in c0, c1
) {
if (/*n0,n1,k0,k1,m0,m1 too small: CUTOFF*/) {
BaseMM(A,B,m0,m1,k0,k1,n0,n1,C,mo,no); // call other function with all args} else {
double c0[m1-m0][n1-n0]; // output of top half of B
double c1[m1-m0][n1-n0]; // output of bottom half of B// A (left-top quad) vs. B (top half) --&gt; C0 (top half)
MM(A, B, m0, (m0+m1)/2, k0, (k0+k1)/2, n0, (n0+n1)/2, c0, 0, 0);
MM(A, B, m0, (m0+m1)/2, k0, (k0+k1)/2, (n0+n1)/2, n1, c0, 0, (n1-n0)/2);// A (right-top quad) vs. B (bottom half) --&gt; C1 (top half)
MM(A, B, m0, (m0+m1)/2, (k0+k1)/2, k1, n0, (n0+n1)/2, c1, 0, 0);
MM(A, B, m0, (m0+m1)/2, (k0+k1)/2, k1, (n0+n1)/2, n1, c1, 0, (n1-n0)/2);
// A (left-bottom quad) vs. B (top half) --&gt; C0 (bottom half)
MM(A, B, (m0+m1)/2, m1, k0, (k0+k1)/2, n0, (n0+n1)/2, c0, m1-m0, 0);
MM(A, B, (m0+m1)/2, m1, k0, (k0+k1)/2, (n0+n1)/2, n1, c0, m1-m0, (n1-n0)/2);// A (right-bottom quad) vs. B (bottom half) --&gt; C1 (bottom half)
MM(A, B, (m0+m1)/2, m1, (k0+k1)/2, k1, n0, (n0+n1)/2, c1, m1-m0, 0);
MM(A, B, (m0+m1)/2, m1, (k0+k1)/2, k1, (n0+n1)/2, n1, c1, m1-m0, (n1-n0)/2);// C = c0 + c1 (using offset)
for (i=m0; i&lt;m1; i++) {
for (j=n0; j&lt;n1; j++) {
C[mo+i][no+j] = c0[i-m0][j-n0] + c1[i-m0][j-n0];
}
}... free memory of c0 and c1
}
}</code></pre><p>
Call with
<mark class="highlight-gray"><code>MM(A,B,0,m,0,k,0,n,C,0,0);</code></mark></p><p>All MM calls are independent.</p></details></li></ul><p></p><p></p><h1>Cache coherence</h1><p><mark class="highlight-blue">Example: caches that are not coherent</mark></p><div class="indented"><p>
Core 0, 1 have private caches and both loaded address
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em"></span><span class="mord mathnormal">a</span></span></span></span></span><span>﻿</span></span>
.
</p><div class="indented"><ol class="numbered-list" start="1" type="1"><li>
Core 0 writes to
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em"></span><span class="mord mathnormal">a</span></span></span></span></span><span>﻿</span></span></li></ol><ol class="numbered-list" start="2" type="1"><li>
Core 1 wants to read
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em"></span><span class="mord mathnormal">a</span></span></span></span></span><span>﻿</span></span>
but has a different value
</li></ol></div><p></p></div><p></p><p></p><p><mark class="highlight-blue">Definition: cache coherence</mark></p><div class="indented"><p>
Let order of memory accesses to specific address
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em"></span><span class="mord mathnormal">a</span></span></span></span></span><span>﻿</span></span>
be given by program order.
</p><div class="indented"><ol class="numbered-list" start="1" type="1"><li>
If processor
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>P</mi></mstyle></mrow><annotation encoding="application/x-tex">\small P</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.614997em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.13889em">P</span></span></span></span></span><span>﻿</span></span>
writes to
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="pink"><mi>a</mi></mstyle></mrow><annotation encoding="application/x-tex">\color{pink} a</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em"></span><span class="mord mathnormal" style="color: pink">a</span></span></span></span></span><span>﻿</span></span>
and no other writes occur (by any processor) before its next read of
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="pink"><mi>a</mi></mstyle></mrow><annotation encoding="application/x-tex">\color{pink} a</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em"></span><span class="mord mathnormal" style="color: pink">a</span></span></span></span></span><span>﻿</span></span>
- then it must read the value it first wrote to
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="pink"><mi>a</mi></mstyle></mrow><annotation encoding="application/x-tex">\color{pink} a</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em"></span><span class="mord mathnormal" style="color: pink">a</span></span></span></span></span><span>﻿</span></span>
.
</li></ol><ol class="numbered-list" start="2" type="1"><li>
If
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>P</mi><mn>1</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small P_1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.749997em; vertical-align: -0.135em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal" style="margin-right: 0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: -0.13889em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>
writes to
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="pink"><mi>a</mi></mstyle></mrow><annotation encoding="application/x-tex">\color{pink} a</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em"></span><span class="mord mathnormal" style="color: pink">a</span></span></span></span></span><span>﻿</span></span>
and no other writes occur (by any processor) afterwards until
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>P</mi><mn>2</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small P_2</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.749997em; vertical-align: -0.135em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal" style="margin-right: 0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: -0.13889em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>
reads
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="pink"><mi>a</mi></mstyle></mrow><annotation encoding="application/x-tex">\color{pink} a</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em"></span><span class="mord mathnormal" style="color: pink">a</span></span></span></span></span><span>﻿</span></span>
- then
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>P</mi><mn>2</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small P_2</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.749997em; vertical-align: -0.135em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal" style="margin-right: 0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: -0.13889em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>
must read the value
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>P</mi><mn>1</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small P_1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.749997em; vertical-align: -0.135em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal" style="margin-right: 0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: -0.13889em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>
first wrote to
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="pink"><mi>a</mi></mstyle></mrow><annotation encoding="application/x-tex">\color{pink} a</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em"></span><span class="mord mathnormal" style="color: pink">a</span></span></span></span></span><span>﻿</span></span>
.
</li></ol><ol class="numbered-list" start="3" type="1"><li>
If
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>P</mi><mn>1</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small P_1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.749997em; vertical-align: -0.135em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal" style="margin-right: 0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: -0.13889em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>
and
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>P</mi><mn>2</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small P_2</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.749997em; vertical-align: -0.135em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal" style="margin-right: 0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: -0.13889em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>
write to
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="pink"><mi>a</mi></mstyle></mrow><annotation encoding="application/x-tex">\color{pink} a</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em"></span><span class="mord mathnormal" style="color: pink">a</span></span></span></span></span><span>﻿</span></span>
at the same time, then only one write is stored at
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="pink"><mi>a</mi></mstyle></mrow><annotation encoding="application/x-tex">\color{pink} a</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em"></span><span class="mord mathnormal" style="color: pink">a</span></span></span></span></span><span>﻿</span></span>
.
</li></ol></div><p></p><ul class="toggle"><li><details open=""><summary>More formal definition</summary><ol class="numbered-list" start="1" type="1"><li>
If processor
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>P</mi></mstyle></mrow><annotation encoding="application/x-tex">\small P</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.614997em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.13889em">P</span></span></span></span></span><span>﻿</span></span>
writes to
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="pink"><mi>a</mi></mstyle></mrow><annotation encoding="application/x-tex">\color{pink} a</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em"></span><span class="mord mathnormal" style="color: pink">a</span></span></span></span></span><span>﻿</span></span>
at time
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>t</mi><mn>1</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small t_1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.688572em; vertical-align: -0.135em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>
and reads
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="pink"><mi>a</mi></mstyle></mrow><annotation encoding="application/x-tex">\color{pink} a</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em"></span><span class="mord mathnormal" style="color: pink">a</span></span></span></span></span><span>﻿</span></span>
at
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>t</mi><mn>2</mn></msub><mo>&gt;</mo><msub><mi>t</mi><mn>1</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small t_2&gt;t_1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.688572em; vertical-align: -0.135em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2777777777777778em"></span><span class="mrel sizing reset-size6 size5">&gt;</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height: 0.688572em; vertical-align: -0.135em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>
, and there are no other writes (by
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>P</mi></mstyle></mrow><annotation encoding="application/x-tex">\small P</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.614997em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.13889em">P</span></span></span></span></span><span>﻿</span></span>
or other) to
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="pink"><mi>a</mi></mstyle></mrow><annotation encoding="application/x-tex">\color{pink} a</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em"></span><span class="mord mathnormal" style="color: pink">a</span></span></span></span></span><span>﻿</span></span>
between
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>t</mi><mn>1</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small t_1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.688572em; vertical-align: -0.135em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>
and
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>t</mi><mn>2</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small t_2</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.688572em; vertical-align: -0.135em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>
, then
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>P</mi></mstyle></mrow><annotation encoding="application/x-tex">\small P</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.614997em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.13889em">P</span></span></span></span></span><span>﻿</span></span>
reads the value written at
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>t</mi><mn>1</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small t_1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.688572em; vertical-align: -0.135em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>
.
</li></ol><ol class="numbered-list" start="2" type="1"><li>
If
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>P</mi><mn>1</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small P_1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.749997em; vertical-align: -0.135em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal" style="margin-right: 0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="
top: -2.45em;
margin-left: -0.13889em;
margin-right: 0.05555555555555556em;
"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>
writes to
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="pink"><mi>a</mi></mstyle></mrow><annotation encoding="application/x-tex">\color{pink} a</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em"></span><span class="mord mathnormal" style="color: pink">a</span></span></span></span></span><span>﻿</span></span>
at
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>t</mi><mn>1</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small t_1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.688572em; vertical-align: -0.135em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>
and another
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>P</mi><mn>2</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small P_2</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.749997em; vertical-align: -0.135em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal" style="margin-right: 0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="
top: -2.45em;
margin-left: -0.13889em;
margin-right: 0.05555555555555556em;
"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>
reads a at
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>t</mi><mn>2</mn></msub><mo>&gt;</mo><msub><mi>t</mi><mn>1</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small t_2&gt;t_1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.688572em; vertical-align: -0.135em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2777777777777778em"></span><span class="mrel sizing reset-size6 size5">&gt;</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height: 0.688572em; vertical-align: -0.135em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>
and no other
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>P</mi></mstyle></mrow><annotation encoding="application/x-tex">\small P</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.614997em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.13889em">P</span></span></span></span></span><span>﻿</span></span>
writes to
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="pink"><mi>a</mi></mstyle></mrow><annotation encoding="application/x-tex">\color{pink} a</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em"></span><span class="mord mathnormal" style="color: pink">a</span></span></span></span></span><span>﻿</span></span>
between
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>t</mi><mn>1</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small t_1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.688572em; vertical-align: -0.135em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>
and
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>t</mi><mn>2</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small t_2</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.688572em; vertical-align: -0.135em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>
, then
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>P</mi><mn>2</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small P_2</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.749997em; vertical-align: -0.135em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal" style="margin-right: 0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="
top: -2.45em;
margin-left: -0.13889em;
margin-right: 0.05555555555555556em;
"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>
reads the value written by
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>P</mi><mn>1</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small P_1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.749997em; vertical-align: -0.135em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal" style="margin-right: 0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="
top: -2.45em;
margin-left: -0.13889em;
margin-right: 0.05555555555555556em;
"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>
at
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>t</mi><mn>1</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small t_1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.688572em; vertical-align: -0.135em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>
.
<p>
But there must be sufficient space between
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>t</mi><mn>1</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small t_1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.688572em; vertical-align: -0.135em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="
top: -2.45em;
margin-left: 0em;
margin-right: 0.05555555555555556em;
"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>
and
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>t</mi><mn>2</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small t_2</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.688572em; vertical-align: -0.135em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="
top: -2.45em;
margin-left: 0em;
margin-right: 0.05555555555555556em;
"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>
until the updates become visible (there is no absolute time and nothing is immediate).
</p></li></ol><ol class="numbered-list" start="3" type="1"><li>
If
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>P</mi><mn>1</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small P_1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.749997em; vertical-align: -0.135em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal" style="margin-right: 0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="
top: -2.45em;
margin-left: -0.13889em;
margin-right: 0.05555555555555556em;
"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>
and
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>P</mi><mn>2</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small P_2</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.749997em; vertical-align: -0.135em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal" style="margin-right: 0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="
top: -2.45em;
margin-left: -0.13889em;
margin-right: 0.05555555555555556em;
"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>
write to
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="pink"><mi>a</mi></mstyle></mrow><annotation encoding="application/x-tex">\color{pink} a</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em"></span><span class="mord mathnormal" style="color: pink">a</span></span></span></span></span><span>﻿</span></span>
at the same time, then either the value of
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>P</mi><mn>1</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small P_1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.749997em; vertical-align: -0.135em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal" style="margin-right: 0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="
top: -2.45em;
margin-left: -0.13889em;
margin-right: 0.05555555555555556em;
"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>
or the value of
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>P</mi><mn>2</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small P_2</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.749997em; vertical-align: -0.135em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal" style="margin-right: 0.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="
top: -2.45em;
margin-left: -0.13889em;
margin-right: 0.05555555555555556em;
"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>
is stored at
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="pink"><mi>a</mi></mstyle></mrow><annotation encoding="application/x-tex">\color{pink} a</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em"></span><span class="mord mathnormal" style="color: pink">a</span></span></span></span></span><span>﻿</span></span>
.
<p>Same time means “sufficiently close” in time - the writes must be “serialized”.</p></li></ol></details></li></ul></div><p></p><p></p><p><mark class="highlight-blue">ccNUMA-Systems</mark></p><div class="indented"><p>(most multi-core and symmetric multiprocessing SMP nodes)</p><p>Cache coherence at cache-line-level, maintained by hardware-protocols.</p><p>This negatively impacts the performance: bus/network traffic, protocol overhead, transistors and power.</p><p><mark class="highlight-gray">Note: Not all systems are cache coherent (ie. NEC Vector computers)</mark></p></div><p></p><p></p><h2>False sharing</h2><p><mark class="highlight-blue">Sharing / false sharing</mark></p><div class="indented"><p>Cache coherence is maintained at cache-line-level.</p><p>Two different addresses are written to cache - but the entire cache-line must be updated.</p></div><p></p><p></p><p><mark class="highlight-blue">Avoiding false sharing</mark></p><div class="indented"><p>Simple, shared variables updated by different threads should be in different cache-lines.</p><p>Solutions:</p><div class="indented"><ul class="bulleted-list"><li style="list-style-type: disc">Simple local variables → compiler might put them in different cache lines</li></ul><ul class="bulleted-list"><li style="list-style-type: disc">Pad data-structures (ie. padded array) → wastes a lot of memory</li></ul></div><p></p></div><p></p><figure class="image"><a href="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled%2013.png"><img src="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled%2013.png" style="width: 384px"/></a></figure><p></p><p><mark class="highlight-blue">Example 1) unnecessary update</mark></p><div class="indented"><p><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo separator="true">,</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a,b</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.8888799999999999em; vertical-align: -0.19444em"></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.16666666666666666em"></span><span class="mord mathnormal">b</span></span></span></span></span><span>﻿</span></span>
are both in the same cache-line.
</p><div class="indented"><p>
core0 updates
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em"></span><span class="mord mathnormal">a</span></span></span></span></span><span>﻿</span></span>
in a loop, core1 updates
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em"></span><span class="mord mathnormal">b</span></span></span></span></span><span>﻿</span></span>
in a loop.
</p><p>
Although
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo separator="true">,</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a,b</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.8888799999999999em; vertical-align: -0.19444em"></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.16666666666666666em"></span><span class="mord mathnormal">b</span></span></span></span></span><span>﻿</span></span>
are in different memory locations, each update will cause a cache coherency activity (although unnecessary).
</p></div><p></p><p>
Variables
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo separator="true">,</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a,b</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.8888799999999999em; vertical-align: -0.19444em"></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.16666666666666666em"></span><span class="mord mathnormal">b</span></span></span></span></span><span>﻿</span></span>
are called “falsely shared”.
</p></div><p></p><p></p><p><mark class="highlight-blue">Example 2) storing sum of rows: row-major</mark></p><div class="indented"><p>
Storing row sums at index
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mn>0</mn></mstyle></mrow><annotation encoding="application/x-tex">\small 0</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.5799960000000001em; vertical-align: 0em"></span><span class="mord sizing reset-size6 size5">0</span></span></span></span></span><span>﻿</span></span>
in matrix:
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>a</mi><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo><mo>=</mo><msub><mo>∑</mo><mi>i</mi></msub><mi>a</mi><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo></mstyle></mrow><annotation encoding="application/x-tex">\small a[j][0] = \sum_i a[j][i]</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5">a</span><span class="mopen sizing reset-size6 size5">[</span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.05724em">j</span><span class="mclose sizing reset-size6 size5">]</span><span class="mopen sizing reset-size6 size5">[</span><span class="mord sizing reset-size6 size5">0</span><span class="mclose sizing reset-size6 size5">]</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span><span class="mrel sizing reset-size6 size5">=</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height: 0.9600090000000001em; vertical-align: -0.285009em"></span><span class="mop sizing reset-size6 size5"><span class="mop op-symbol small-op" style="position: relative; top: -0.0000050000000000050004em">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1230033333333333em"><span style="top: -2.2833233333333336em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.31667666666666666em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size5">a</span><span class="mopen sizing reset-size6 size5">[</span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.05724em">j</span><span class="mclose sizing reset-size6 size5">]</span><span class="mopen sizing reset-size6 size5">[</span><span class="mord mathnormal sizing reset-size6 size5">i</span><span class="mclose sizing reset-size6 size5">]</span></span></span></span></span><span>﻿</span></span></p><p>Matrix is stored row-major in C.</p><div class="indented"><p>
Therefore all
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>a</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo></mstyle></mrow><annotation encoding="application/x-tex">\small a[i][0]</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5">a</span><span class="mopen sizing reset-size6 size5">[</span><span class="mord mathnormal sizing reset-size6 size5">i</span><span class="mclose sizing reset-size6 size5">]</span><span class="mopen sizing reset-size6 size5">[</span><span class="mord sizing reset-size6 size5">0</span><span class="mclose sizing reset-size6 size5">]</span></span></span></span></span><span>﻿</span></span>
are most likely in different cache lines.
</p><p>
The rows
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>j</mi></mstyle></mrow><annotation encoding="application/x-tex">\small j</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.768564em; vertical-align: -0.174996em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.05724em">j</span></span></span></span></span><span>﻿</span></span>
and
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>j</mi><mo>+</mo><mn>1</mn></mstyle></mrow><annotation encoding="application/x-tex">\small j +1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.768564em; vertical-align: -0.174996em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.05724em">j</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.5799960000000001em; vertical-align: 0em"></span><span class="mord sizing reset-size6 size5">1</span></span></span></span></span><span>﻿</span></span>
are not spatially close and wont be updated based on eachother.
</p></div><p></p><pre class="code"><code>// a[m][n] two dimensional matrix
int *a = (int*)malloc(m*n*sizeof(int));// row order access
#pragma omp parallel for
for (j=0; j&lt;m; j++) {
int *x = a+j*n; // get address of row
int i;
for (i=1; i&lt;n; i++) { // sum all elements of row and store in [0]
x[0] += x[i];
}
}</code></pre></div><p></p><figure class="image"><a href="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled%2014.png"><img src="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled%2014.png" style="width: 240px"/></a></figure><p></p><p><mark class="highlight-blue">Example 3) storing sum of rows: col-major</mark></p><div class="indented"><p>same problem as above</p><p>Matrix is stored col-major in FORTRAN.</p><div class="indented"><p>
Therefore all
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>a</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo></mstyle></mrow><annotation encoding="application/x-tex">\small a[i][0]</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5">a</span><span class="mopen sizing reset-size6 size5">[</span><span class="mord mathnormal sizing reset-size6 size5">i</span><span class="mclose sizing reset-size6 size5">]</span><span class="mopen sizing reset-size6 size5">[</span><span class="mord sizing reset-size6 size5">0</span><span class="mclose sizing reset-size6 size5">]</span></span></span></span></span><span>﻿</span></span>
are most likely in the same cache line and are updated
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>p</mi><mo>⋅</mo><mi>n</mi></mstyle></mrow><annotation encoding="application/x-tex">\small p\cdot n</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.575001em; vertical-align: -0.174996em"></span><span class="mord mathnormal sizing reset-size6 size5">p</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">⋅</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.387504em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5">n</span></span></span></span></span><span>﻿</span></span>
times.
</p></div><p></p><pre class="code"><code>// x[m][n] two dimensional matrix
int *a = (int*)malloc(n*m*sizeof(int));// row order access
#pragma omp parallel { // assuming p = m
int t = omp_get_thread_num(); // thread id
int i, j;
int *x = a;
for (j=t+p, i=1; i&lt;n; i++,j+=p) {
x[t] += x[j];
}
}</code></pre><ul class="toggle"><li><details open=""><summary>implementation with variable</summary><p>should have no false sharing (as the original FORTRAN implementation).</p><p>But compiler might put the variable in a different cache-line.</p><pre class="code"><code>// x[m][n] two dimensional matrix
int *a = (int*)malloc(n*m*sizeof(int));// row order access
#pragma omp parallel {
int t = omp_get_thread_num(); // thread id
int i, j;
int *x = a;
register int sum = 0;
for (j=t+p, i=1; i&lt;n; i++,j+=p) {
sum += x[j];
}
x[t] = sum;
}</code></pre></details></li></ul></div><p></p><figure class="image"><a href="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled%2015.png"><img src="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled%2015.png" style="width: 240px"/></a></figure><p></p><p></p><h1>NUMA memory performance</h1><p><mark class="highlight-blue">Memory (”von Neumann”) bottleneck in NUMA</mark></p><div class="indented"><p>The memory access times are non-uniform:</p><div class="indented"><p>Memory closer to a core is faster than memory on another CPU</p></div><p></p><ul class="toggle"><li><details open=""><summary>other problems</summary><ul class="bulleted-list"><li style="list-style-type: disc">Connection to memory via memory controllers (prefered by memory in bank)</li></ul><ul class="bulleted-list"><li style="list-style-type: disc">Less memory controllers than cores and they all share the same memory bandwidth</li></ul></details></li></ul></div><p></p><figure class="image"><a href="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled.png"><img src="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled.png" style="width: 240px"/></a></figure><p></p><p><mark class="highlight-blue">First touch</mark></p><div class="indented"><p>Applications try to allocate memory from closer to cores.</p><p>“First-touch” OS support:</p><div class="indented"><p><em>
“The first core (thread) to touch a virtual memory page will cause the virtual page to be allocated in memory close to that
core”
</em></p><p class="block-color-gray">
This also means that threads that allocate later, are forced to use memory farthest away (remote instead of local).
</p></div><p></p></div><p></p><p></p><p><mark class="highlight-blue">Latency hiding techniques</mark></p><div class="indented"><p><em>These techniques hide latency, but bandwidth must still be suitable for memory requests.</em></p><p><mark class="highlight-teal">Prefetching</mark></p><div class="indented"><p>Start loading operands well before use.</p></div><p></p><p><mark class="highlight-teal">Multi-threading</mark>
(via hardware or software)
</p><div class="indented"><p>switching between virtual processors when a thread requests data and coming back when data arrived.</p><p>(requires explicit parallel instruction computing EPIC)</p></div><p></p></div><p></p><p></p><p><mark class="highlight-blue">Memory hierarchy and latency</mark></p><div class="indented"><p>Registers 0 cycles</p><p>L1 cache 1 cycle</p><p>L2 cache 10 cycles</p><p>L3 cache 30 cycles</p><p>Main memory 100 cycles</p><p>Disk 100.000 cycles</p><p>Tape 10.000.000 cycles</p></div><p></p><div class="column-list"><div class="column" style="width: 33.333333333333336%"><figure class="image"><a href="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled%2016.png"><img src="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled%2016.png" style="width: 144px"/></a></figure></div><div class="column" style="width: 33.333333333333336%"><figure class="image"><a href="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled%2017.png"><img src="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled%2017.png" style="width: 192px"/></a></figure></div><div class="column" style="width: 33.33333333333333%"><figure class="image"><a href="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled%2018.png"><img src="Memory%20and%20Caching%20e6b94b4f12a0482088839ca1d155d106/Untitled%2018.png" style="width: 1154px"/></a></figure></div></div><p></p><h2>Super-linear speedup</h2><p><mark class="highlight-blue">Super-linear speedup is impossible — Previous proof: simulation argument</mark></p><div class="indented"><p>Simulation argument: linear/perfect speedup is the best possible.</p><div class="indented"><p>Simulation argument assumes that parallel and sequential processors behave similarly = same memory behavior.</p><p>This is not true for real systems with a deep memory hierarchy.</p></div><p></p></div><p></p><p></p><p><mark class="highlight-blue">Definition</mark></p><div class="indented"><p>
single processor input size
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>n</mi></mstyle></mrow><annotation encoding="application/x-tex">\small n</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.387504em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5">n</span></span></span></span></span><span>﻿</span></span>
, has access to deep memory hierarchy
</p><p>
multiple processors input size
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>n</mi><mi mathvariant="normal">/</mi><mi>p</mi></mstyle></mrow><annotation encoding="application/x-tex">\small n/p</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5">n</span><span class="mord sizing reset-size6 size5">/</span><span class="mord mathnormal sizing reset-size6 size5">p</span></span></span></span></span><span>﻿</span></span>
, each have full access to main memory and cache
</p></div><p></p><p></p><div class="indented"><p><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mtext>ref</mtext><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mstyle></mrow><annotation encoding="application/x-tex">\small \text{ref}(n)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord text sizing reset-size6 size5"><span class="mord">ref</span></span><span class="mopen sizing reset-size6 size5">(</span><span class="mord mathnormal sizing reset-size6 size5">n</span><span class="mclose sizing reset-size6 size5">)</span></span></span></span></span><span>﻿</span></span>
number of memory references
</p><p><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mtext>Mseq</mtext><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mstyle></mrow><annotation encoding="application/x-tex">\small \text{Mseq}(n)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord text sizing reset-size6 size5"><span class="mord">Mseq</span></span><span class="mopen sizing reset-size6 size5">(</span><span class="mord mathnormal sizing reset-size6 size5">n</span><span class="mclose sizing reset-size6 size5">)</span></span></span></span></span><span>﻿</span></span>
avg time per reference for a single processor (deep hierarchy)
</p><p><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mtext>Mpar</mtext><mo stretchy="false">(</mo><mi>p</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo></mstyle></mrow><annotation encoding="application/x-tex">\small \text{Mpar}(p,n)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord text sizing reset-size6 size5"><span class="mord">Mpar</span></span><span class="mopen sizing reset-size6 size5">(</span><span class="mord mathnormal sizing reset-size6 size5">p</span><span class="mpunct sizing reset-size6 size5">,</span><span class="mspace" style="margin-right: 0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size5">n</span><span class="mclose sizing reset-size6 size5">)</span></span></span></span></span><span>﻿</span></span>
avg time per reference for a single processor in parallel system (flat hierarchy)
</p><p></p><p>If performance is defined by cost of memory references:</p><figure class="equation">Sp(n)=ref(n)⋅Mseq(n)ref(n)/p⋅Mpar(p,n)=p⋅Mseq(n)Mpar(p,n)\small S_p(n) = \frac{\text{ref}(n) \cdot \text{Mseq}(n)}{\text{ref}(n)/p \cdot \text{Mpar}(p,n)} = p \cdot                                                    \frac{\text{Mseq}(n)}{\text{Mpar}(p,n)}Sp​(n)=ref(n)/p⋅Mpar(p,n)ref(n)⋅Mseq(n)​=p⋅Mpar(p,n)Mseq(n)​</figure></div><p></p><ul class="toggle"><li><details open=""><summary>Example</summary><p><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mtext>Mseq</mtext><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><mn>1000</mn></mstyle></mrow><annotation encoding="application/x-tex">\small \text{Mseq}(n) = 1000</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord text sizing reset-size6 size5"><span class="mord">Mseq</span></span><span class="mopen sizing reset-size6 size5">(</span><span class="mord mathnormal sizing reset-size6 size5">n</span><span class="mclose sizing reset-size6 size5">)</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span><span class="mrel sizing reset-size6 size5">=</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height: 0.5799960000000001em; vertical-align: 0em"></span><span class="mord sizing reset-size6 size5">1000</span></span></span></span></span><span>﻿</span></span></p><p><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mtext>Mpar</mtext><mo stretchy="false">(</mo><mi>p</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><mn>100</mn></mstyle></mrow><annotation encoding="application/x-tex">\small \text{Mpar}(p,n) = 100</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord text sizing reset-size6 size5"><span class="mord">Mpar</span></span><span class="mopen sizing reset-size6 size5">(</span><span class="mord mathnormal sizing reset-size6 size5">p</span><span class="mpunct sizing reset-size6 size5">,</span><span class="mspace" style="margin-right: 0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size5">n</span><span class="mclose sizing reset-size6 size5">)</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span><span class="mrel sizing reset-size6 size5">=</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height: 0.5799960000000001em; vertical-align: 0em"></span><span class="mord sizing reset-size6 size5">100</span></span></span></span></span><span>﻿</span></span>
(independent of
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>n</mi><mo separator="true">,</mo><mi>p</mi></mstyle></mrow><annotation encoding="application/x-tex">\small n, p</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.5625em; vertical-align: -0.174996em"></span><span class="mord mathnormal sizing reset-size6 size5">n</span><span class="mpunct sizing reset-size6 size5">,</span><span class="mspace" style="margin-right: 0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size5">p</span></span></span></span></span><span>﻿</span></span>
)
</p><p>This would give us super a super-linear speedup</p><div class="indented"><p>
(wrong term, since its linear but greater than
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>p</mi></mstyle></mrow><annotation encoding="application/x-tex">\small p</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.5625em; vertical-align: -0.174996em"></span><span class="mord mathnormal sizing reset-size6 size5">p</span></span></span></span></span><span>﻿</span></span>
).
</p><p><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>S</mi><mi>p</mi></msub><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><mn>10</mn><mo>⋅</mo><mi>p</mi></mstyle></mrow><annotation encoding="application/x-tex">\small S_p(n) = 10 \cdot p</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.9266640000000002em; vertical-align: -0.25166400000000005em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal" style="margin-right: 0.05764em">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.13703999999999994em"><span style="
top: -2.45em;
margin-left: -0.05764em;
margin-right: 0.05555555555555556em;
"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span></span></span></span></span></span></span><span class="mopen sizing reset-size6 size5">(</span><span class="mord mathnormal sizing reset-size6 size5">n</span><span class="mclose sizing reset-size6 size5">)</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span><span class="mrel sizing reset-size6 size5">=</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height: 0.5799960000000001em; vertical-align: 0em"></span><span class="mord sizing reset-size6 size5">10</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">⋅</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.5625em; vertical-align: -0.174996em"></span><span class="mord mathnormal sizing reset-size6 size5">p</span></span></span></span></span><span>﻿</span></span></p></div><p></p></details></li></ul><p></p><h2>Application performance and memory system</h2><p><mark class="highlight-blue">Bounds for applications (”roofline performance / estimate model”)</mark></p><div class="indented"><p><em>Memory bound</em>
time operating on data &lt; time reading/writing data
</p><p><em>Compute bound</em>
time operating on data &gt; time reading/writing data
</p><ul class="toggle"><li><details open=""><summary><mark class="highlight-gray">formal definition</mark></summary><p>
Given Implementation
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>A</mi></mstyle></mrow><annotation encoding="application/x-tex">\small A</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.614997em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5">A</span></span></span></span></span><span>﻿</span></span>
on multi-core system:
</p><div class="indented"><p>
performance
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>P</mi></mstyle></mrow><annotation encoding="application/x-tex">\small P</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.614997em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.13889em">P</span></span></span></span></span><span>﻿</span></span>
= ie. in operations/s or other measure
</p><p>
operational intensity
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>O</mi></mstyle></mrow><annotation encoding="application/x-tex">\small O</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.614997em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.02778em">O</span></span></span></span></span><span>﻿</span></span>
= average num of operations per byte read/written
</p><p>
memory bandwidth
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>B</mi></mstyle></mrow><annotation encoding="application/x-tex">\small B</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.614997em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.05017em">B</span></span></span></span></span><span>﻿</span></span></p></div><p></p><hr/><p><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>A</mi></mstyle></mrow><annotation encoding="application/x-tex">\small A</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.614997em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5">A</span></span></span></span></span><span>﻿</span></span>
is memory bound, if
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>P</mi><mi mathvariant="normal">/</mi><mi>O</mi><mo>&gt;</mo><mi>B</mi></mstyle></mrow><annotation encoding="application/x-tex">\small P/O &gt; B</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.13889em">P</span><span class="mord sizing reset-size6 size5">/</span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.02778em">O</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span><span class="mrel sizing reset-size6 size5">&gt;</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height: 0.614997em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.05017em">B</span></span></span></span></span><span>﻿</span></span></p><p><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>A</mi></mstyle></mrow><annotation encoding="application/x-tex">\small A</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.614997em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5">A</span></span></span></span></span><span>﻿</span></span>
is compute bound, if
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>P</mi><mi mathvariant="normal">/</mi><mi>O</mi><mo>≤</mo><mi>B</mi></mstyle></mrow><annotation encoding="application/x-tex">\small P/O \leq B</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.13889em">P</span><span class="mord sizing reset-size6 size5">/</span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.02778em">O</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span><span class="mrel sizing reset-size6 size5">≤</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height: 0.614997em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.05017em">B</span></span></span></span></span><span>﻿</span></span></p><p></p></details></li></ul><ul class="toggle"><li><details open=""><summary><mark class="highlight-gray">example</mark></summary><p>memory bound algorithms</p><div class="indented"><p>Merge, prefix-sums → few operations per byte</p></div><p></p><p>less memory bound algorithms</p><div class="indented"><p>
Matrix-matrix multiplication →
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>3</mn></msup><mo stretchy="false">)</mo></mstyle></mrow><annotation encoding="application/x-tex">\small O(n^3)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.938364em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.02778em">O</span><span class="mopen sizing reset-size6 size5">(</span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7926266666666666em"><span style="top: -2.963em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mclose sizing reset-size6 size5">)</span></span></span></span></span><span>﻿</span></span>
operations on
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mstyle></mrow><annotation encoding="application/x-tex">\small O(n^2)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.938364em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.02778em">O</span><span class="mopen sizing reset-size6 size5">(</span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7926266666666666em"><span style="top: -2.963em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose sizing reset-size6 size5">)</span></span></span></span></span><span>﻿</span></span>
data
</p></div><p></p><hr/><p>Example: Assuming prefix sums performs</p><div class="indented"><p><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>O</mi></mstyle></mrow><annotation encoding="application/x-tex">\small O</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.614997em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.02778em">O</span></span></span></span></span><span>﻿</span></span>
= 1/16 FLOP per Byte
</p><div class="indented"><p>1 FLOP per 8 Byte word read and written (16 Bytes)</p></div><p></p><p><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>P</mi></mstyle></mrow><annotation encoding="application/x-tex">\small P</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.614997em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.13889em">P</span></span></span></span></span><span>﻿</span></span>
= 2 GFLOPs
</p><p>Then it is memory bound is bandwidth is &lt; 32GByte/s.</p><p></p></div><p></p></details></li></ul><p>
If
<em>memory bound</em>
, speedup is limited by memory bandwidth (= How much faster can
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>p</mi></mstyle></mrow><annotation encoding="application/x-tex">\small p</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.5625em; vertical-align: -0.174996em"></span><span class="mord mathnormal sizing reset-size6 size5">p</span></span></span></span></span><span>﻿</span></span>
cores read/write than only one core?)
</p></div><p></p><p></p><p></p><h1>Program order and memory consistency</h1><p>Execution-order is not always program-order.</p><p></p><p><mark class="highlight-blue">Sequential program order</mark></p><div class="indented"><p>Sequential consistency</p><p></p></div><p></p><p><mark class="highlight-blue">Parallel program order</mark></p><div class="indented"><p><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>p</mi></mstyle></mrow><annotation encoding="application/x-tex">\small p</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.5625em; vertical-align: -0.174996em"></span><span class="mord mathnormal sizing reset-size6 size5">p</span></span></span></span></span><span>﻿</span></span>
processors execute some interleaving of parallel program (SPMD or MIMD).
</p><p>Possible: sequential consistency, relaxed consistency</p><ul class="toggle"><li><details open=""><summary><mark class="highlight-gray">example</mark></summary><div class="column-list"><div class="column" style="width: 50%"><pre class="code"><code>a = 1;
a = 2; // last assignment to a
b = 3; // last assignment to b</code></pre></div><div class="column" style="width: 50%"><pre class="code"><code>b = 7; // last assignment to b
a = 1;
a = 2; // last assignment to a</code></pre></div></div><p>Possible outcomes:</p><div class="indented"><ul class="bulleted-list"><li style="list-style-type: disc"><mark class="highlight-gray"><code>a = 2</code></mark>
,
<mark class="highlight-gray"><code>b = 3</code></mark></li></ul><ul class="bulleted-list"><li style="list-style-type: disc"><mark class="highlight-gray"><code>a = 2</code></mark>
,
<mark class="highlight-gray"><code>b = 7</code></mark></li></ul></div><p></p><p>Impossible outcomes:</p><div class="indented"><ul class="bulleted-list"><li style="list-style-type: disc"><mark class="highlight-gray"><code>a = 1</code></mark>
,
<mark class="highlight-gray"><code>b = 3</code></mark></li></ul><p></p></div><p></p></details></li></ul></div><p></p><p></p><h2>Consistency models</h2><p><mark class="highlight-blue">Memory consistency (Problem)</mark></p><div class="indented"><p>What view do threads have of the memory?</p><p>In what order do writes to different locations in memory become visible to other cores?</p><ul class="toggle"><li><details open=""><summary><mark class="highlight-gray">example</mark></summary><div class="column-list"><div class="column" style="width: 50%"><pre class="code"><code>x = 0;
// … some code
x = 1;
if (y==0) {
// body
}</code></pre></div><div class="column" style="width: 50%"><pre class="code"><code>y = 0;
// … some code
y = 1;
if (x==0) {
// body
}</code></pre></div></div><p>Question: can core0 and core1 both execute the body of the if-statement?</p><p>Answer:</p><div class="indented"><p>No, because they each flip the other variable from 0 to 1 before being able to enter the body.</p><p>If both variables are flipped to 1 then no body is executed → therefore this is not a good lock-algorithm.</p></div><p></p><p></p><p>
Assuming that
<mark class="highlight-gray"><code>x</code></mark>
,
<mark class="highlight-gray"><code>y</code></mark><mark class="highlight-gray"></mark>
are not in cache of any core:
</p><div class="indented"><p>
The answer is only valid under the assumption that the writes to the memory are not delayed - else we won’t get an
interleaving of the two programs.
</p></div><p></p><p></p></details></li></ul></div><p></p><p></p><p><mark class="highlight-blue">Sequential consistency</mark></p><div class="indented"><p>
Outcome of parallel program = execution of some interleaving
<mark class="highlight-gray">of the memory accesses of all processors</mark>
.
</p><p>Memory operations of each processor:</p><div class="indented"><ol class="numbered-list" start="1" type="1"><li>take effect immediately</li></ol><ol class="numbered-list" start="2" type="1"><li>performed in program-order</li></ol></div><p></p><hr/><p>Easy to prove properties of programs or reason about correctness (ie. with invariants).</p><p>
Is guaranteed by hardware
<mark class="highlight-gray">(caches, write buffers, ... are logically transparent)</mark>
.
</p><ul class="toggle"><li><details open=""><summary>Sequential consistency not guaranteed by modern multiprocessors because it reduces performance.</summary><p>In modern multiprocessors (ie. x86, POWER, SPARC):</p><div class="indented"><ul class="bulleted-list"><li style="list-style-type: disc">Caches may delay writes</li></ul><ul class="bulleted-list"><li style="list-style-type: disc">Write buffers may delay and/or reorder writes</li></ul><ul class="bulleted-list"><li style="list-style-type: disc">Memory network may reorder writes</li></ul><ul class="bulleted-list"><li style="list-style-type: disc">Compiler may reorder updates</li></ul></div><p></p></details></li></ul></div><p></p><p></p><p><mark class="highlight-blue">Relaxed consistency</mark></p><div class="indented"><p><mark class="highlight-gray">loads = reads, stores = writes</mark></p><p>May permit:</p><div class="indented"><ul class="bulleted-list"><li style="list-style-type: disc">Reordering loads after loads</li></ul><ul class="bulleted-list"><li style="list-style-type: disc">Reordering loads after stores</li></ul><ul class="bulleted-list"><li style="list-style-type: disc">Reorderung stores after loads</li></ul><ul class="bulleted-list"><li style="list-style-type: disc">Reorderung stores after stores</li></ul></div><p></p><hr/><p>Weaker constraints on hardware.</p><p>More difficult to prove properties of programs or reason about correctness.</p><ul class="toggle"><li><details open=""><summary><mark class="highlight-gray">example</mark></summary><p>
Initial value:
<mark class="highlight-gray"><code>flag = false</code></mark></p><div class="column-list"><div class="column" style="width: 50%"><pre class="code"><code>while (!flag) { }
a = otherval;</code></pre></div><div class="column" style="width: 50%"><pre class="code"><code>otherval = 42;
flag = true;</code></pre></div></div><p>Under sequential consistency:</p><div class="indented"><p>
the outcome is
<mark class="highlight-gray"><code>a == 42</code></mark></p></div><p></p><p>Under relaxed consistency:</p><div class="indented"><p>
Writes could be reordered and
<em>any</em>
old value could be stored in
<mark class="highlight-gray"><code>a</code></mark>
.
</p><p>
Compiler won’t attempt move assignment to
<mark class="highlight-gray"><code>a</code></mark>
before loop but might remove the loop altogether. (Declare boolean flag as
<mark class="highlight-gray"><code>volatile</code></mark>
).
</p></div><p></p><p></p><hr/><p>
This can be solved with a fence: Completes all writes executed before the fence and sets flag
<mark class="highlight-gray"><code>f</code></mark>
.
</p><div class="column-list"><div class="column" style="width: 50%"><pre class="code"><code>while (!flag) { }
fence;
a = otherval;</code></pre></div><div class="column" style="width: 50%"><pre class="code"><code>otherval = 42;
fence(&amp;flag);</code></pre></div></div><p></p></details></li></ul></div><p></p><p></p><h2>Programming models for memory</h2><p>Memory fences and memory barriers enforce pending operations to complete.</p><div class="indented"><p>Fence = local operation for a core</p><p>Barrier = involves all processors</p></div><p></p><p></p><p><mark class="highlight-blue">Memory fence</mark></p><div class="indented"><p>Programming model (memory model)</p><p>Synchronization/coordination construct to enforce a specific set of interleavings:</p><div class="indented"><p><mark class="highlight-gray"><code>fence;</code></mark><mark class="highlight-gray"></mark>
flushes
<em>all</em>
write buffers.
</p></div><p></p><ul class="toggle"><li><details open=""><summary><mark class="highlight-gray">example</mark></summary><div class="column-list"><div class="column" style="width: 50%"><pre class="code"><code>x = 0;
fence; // so core1 can enter
// … some code
x = 1;fence; // so core1 can't enter
if (y==0) {
// body
}</code></pre></div><div class="column" style="width: 50%"><pre class="code"><code>y = 0;
fence;
// … some code
y = 1;fence;
if (x==0) {
// body
}</code></pre></div></div></details></li></ul></div><p></p><p></p></div></article></body></html>