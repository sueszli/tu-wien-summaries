<html><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"/><title>MPI</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
-webkit-print-color-adjust: exact;
}
* {
box-sizing: border-box;
-webkit-print-color-adjust: exact;
}html,
body {
margin: 0;
padding: 0;
}
@media only screen {
body {
margin: 2em auto;
max-width: 900px;
color: rgb(55, 53, 47);
}
}body {
line-height: 1.5;
white-space: pre-wrap;
}a,
a.visited {
color: inherit;
text-decoration: underline;
}.pdf-relative-link-path {
font-size: 80%;
color: #444;
}h1,
h2,
h3 {
letter-spacing: -0.01em;
line-height: 1.2;
font-weight: 600;
margin-bottom: 0;
}.page-title {
font-size: 2.5rem;
font-weight: 700;
margin-top: 0;
margin-bottom: 0.75em;
}h1 {
font-size: 1.875rem;
margin-top: 1.875rem;
}h2 {
font-size: 1.5rem;
margin-top: 1.5rem;
}h3 {
font-size: 1.25rem;
margin-top: 1.25rem;
}.source {
border: 1px solid #ddd;
border-radius: 3px;
padding: 1.5em;
word-break: break-all;
}.callout {
border-radius: 3px;
padding: 1rem;
}figure {
margin: 1.25em 0;
page-break-inside: avoid;
}figcaption {
opacity: 0.5;
font-size: 85%;
margin-top: 0.5em;
}mark {
background-color: transparent;
}.indented {
padding-left: 1.5em;
}hr {
background: transparent;
display: block;
width: 100%;
height: 1px;
visibility: visible;
border: none;
border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}img {
max-width: 100%;
}@media only print {
img {
max-height: 100vh;
object-fit: contain;
}
}@page {
margin: 1in;
}.collection-content {
font-size: 0.875rem;
}.column-list {
display: flex;
justify-content: space-between;
}.column {
padding: 0 1em;
}.column:first-child {
padding-left: 0;
}.column:last-child {
padding-right: 0;
}.table_of_contents-item {
display: block;
font-size: 0.875rem;
line-height: 1.3;
padding: 0.125rem;
}.table_of_contents-indent-1 {
margin-left: 1.5rem;
}.table_of_contents-indent-2 {
margin-left: 3rem;
}.table_of_contents-indent-3 {
margin-left: 4.5rem;
}.table_of_contents-link {
text-decoration: none;
opacity: 0.7;
border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}table,
th,
td {
border: 1px solid rgba(55, 53, 47, 0.09);
border-collapse: collapse;
}table {
border-left: none;
border-right: none;
}th,
td {
font-weight: normal;
padding: 0.25em 0.5em;
line-height: 1.5;
min-height: 1.5em;
text-align: left;
}th {
color: rgba(55, 53, 47, 0.6);
}ol,
ul {
margin: 0;
margin-block-start: 0.6em;
margin-block-end: 0.6em;
}li > ol:first-child,
li > ul:first-child {
margin-block-start: 0.6em;
}ul > li {
list-style: disc;
}ul.to-do-list {
padding-inline-start: 0;
}ul.to-do-list > li {
list-style: none;
}.to-do-children-checked {
text-decoration: line-through;
opacity: 0.375;
}ul.toggle > li {
list-style: none;
}ul {
padding-inline-start: 1.7em;
}ul > li {
padding-left: 0.1em;
}ol {
padding-inline-start: 1.6em;
}ol > li {
padding-left: 0.2em;
}.mono ol {
padding-inline-start: 2em;
}.mono ol > li {
text-indent: -0.4em;
}.toggle {
padding-inline-start: 0em;
list-style-type: none;
}/* Indent toggle children */
.toggle > li > details {
padding-left: 1.7em;
}.toggle > li > details > summary {
margin-left: -1.1em;
}.selected-value {
display: inline-block;
padding: 0 0.5em;
background: rgba(206, 205, 202, 0.5);
border-radius: 3px;
margin-right: 0.5em;
margin-top: 0.3em;
margin-bottom: 0.3em;
white-space: nowrap;
}.collection-title {
display: inline-block;
margin-right: 1em;
}.page-description {
margin-bottom: 2em;
}.simple-table {
margin-top: 1em;
font-size: 0.875rem;
empty-cells: show;
}
.simple-table td {
height: 29px;
min-width: 120px;
}.simple-table th {
height: 29px;
min-width: 120px;
}.simple-table-header-color {
background: rgb(247, 246, 243);
color: black;
}
.simple-table-header {
font-weight: 500;
}time {
opacity: 0.5;
}.icon {
display: inline-block;
max-width: 1.2em;
max-height: 1.2em;
text-decoration: none;
vertical-align: text-bottom;
margin-right: 0.5em;
}img.icon {
border-radius: 3px;
}.user-icon {
width: 1.5em;
height: 1.5em;
border-radius: 100%;
margin-right: 0.5rem;
}.user-icon-inner {
font-size: 0.8em;
}.text-icon {
border: 1px solid #000;
text-align: center;
}.page-cover-image {
display: block;
object-fit: cover;
width: 100%;
max-height: 30vh;
}.page-header-icon {
font-size: 3rem;
margin-bottom: 1rem;
}.page-header-icon-with-cover {
margin-top: -0.72em;
margin-left: 0.07em;
}.page-header-icon img {
border-radius: 3px;
}.link-to-page {
margin: 1em 0;
padding: 0;
border: none;
font-weight: 500;
}p > .user {
opacity: 0.5;
}td > .user,
td > time {
white-space: nowrap;
}input[type="checkbox"] {
transform: scale(1.5);
margin-right: 0.6em;
vertical-align: middle;
}p {
margin-top: 0.5em;
margin-bottom: 0.5em;
}.image {
border: none;
margin: 1.5em 0;
padding: 0;
border-radius: 0;
text-align: center;
}.code,
code {
background: rgba(135, 131, 120, 0.15);
border-radius: 3px;
padding: 0.2em 0.4em;
border-radius: 3px;
font-size: 85%;
tab-size: 2;
}code {
color: #eb5757;
}.code {
padding: 1.5em 1em;
}.code-wrap {
white-space: pre-wrap;
word-break: break-all;
}.code > code {
background: none;
padding: 0;
font-size: 100%;
color: inherit;
}blockquote {
font-size: 1.25em;
margin: 1em 0;
padding-left: 1em;
border-left: 3px solid rgb(55, 53, 47);
}.bookmark {
text-decoration: none;
max-height: 8em;
padding: 0;
display: flex;
width: 100%;
align-items: stretch;
}.bookmark-title {
font-size: 0.85em;
overflow: hidden;
text-overflow: ellipsis;
height: 1.75em;
white-space: nowrap;
}.bookmark-text {
display: flex;
flex-direction: column;
}.bookmark-info {
flex: 4 1 180px;
padding: 12px 14px 14px;
display: flex;
flex-direction: column;
justify-content: space-between;
}.bookmark-image {
width: 33%;
flex: 1 1 180px;
display: block;
position: relative;
object-fit: cover;
border-radius: 1px;
}.bookmark-description {
color: rgba(55, 53, 47, 0.6);
font-size: 0.75em;
overflow: hidden;
max-height: 4.5em;
word-break: break-word;
}.bookmark-href {
font-size: 0.75em;
margin-top: 0.25em;
}.sans {
font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji",
"Segoe UI Symbol";
}
.code {
font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace;
}
.serif {
font-family: Lyon-Text, Georgia, ui-serif, serif;
}
.mono {
font-family: iawriter-mono, Nitti, Menlo, Courier, monospace;
}
.pdf .sans {
font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif,
"Segoe UI Emoji", "Segoe UI Symbol", "Twemoji", "Noto Color Emoji", "Noto Sans CJK JP";
}
.pdf:lang(zh-CN) .sans {
font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif,
"Segoe UI Emoji", "Segoe UI Symbol", "Twemoji", "Noto Color Emoji", "Noto Sans CJK SC";
}
.pdf:lang(zh-TW) .sans {
font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif,
"Segoe UI Emoji", "Segoe UI Symbol", "Twemoji", "Noto Color Emoji", "Noto Sans CJK TC";
}
.pdf:lang(ko-KR) .sans {
font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif,
"Segoe UI Emoji", "Segoe UI Symbol", "Twemoji", "Noto Color Emoji", "Noto Sans CJK KR";
}
.pdf .code {
font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, "Twemoji", "Noto Color Emoji",
"Noto Sans Mono CJK JP";
}
.pdf:lang(zh-CN) .code {
font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, "Twemoji", "Noto Color Emoji",
"Noto Sans Mono CJK SC";
}
.pdf:lang(zh-TW) .code {
font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, "Twemoji", "Noto Color Emoji",
"Noto Sans Mono CJK TC";
}
.pdf:lang(ko-KR) .code {
font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, "Twemoji", "Noto Color Emoji",
"Noto Sans Mono CJK KR";
}
.pdf .serif {
font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, "Twemoji", "Noto Color Emoji", "Noto Serif CJK JP";
}
.pdf:lang(zh-CN) .serif {
font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, "Twemoji", "Noto Color Emoji", "Noto Serif CJK SC";
}
.pdf:lang(zh-TW) .serif {
font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, "Twemoji", "Noto Color Emoji", "Noto Serif CJK TC";
}
.pdf:lang(ko-KR) .serif {
font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, "Twemoji", "Noto Color Emoji", "Noto Serif CJK KR";
}
.pdf .mono {
font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, "Twemoji", "Noto Color Emoji", "Noto Sans Mono CJK JP";
}
.pdf:lang(zh-CN) .mono {
font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, "Twemoji", "Noto Color Emoji", "Noto Sans Mono CJK SC";
}
.pdf:lang(zh-TW) .mono {
font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, "Twemoji", "Noto Color Emoji", "Noto Sans Mono CJK TC";
}
.pdf:lang(ko-KR) .mono {
font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, "Twemoji", "Noto Color Emoji", "Noto Sans Mono CJK KR";
}
.highlight-default {
color: rgba(55, 53, 47, 1);
}
.highlight-gray {
color: rgba(120, 119, 116, 1);
fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
color: rgba(159, 107, 83, 1);
fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
color: rgba(217, 115, 13, 1);
fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
color: rgba(203, 145, 47, 1);
fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
color: rgba(68, 131, 97, 1);
fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
color: rgba(51, 126, 169, 1);
fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
color: rgba(144, 101, 176, 1);
fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
color: rgba(193, 76, 138, 1);
fill: rgba(193, 76, 138, 1);
}
.highlight-red {
color: rgba(212, 76, 71, 1);
fill: rgba(212, 76, 71, 1);
}
.highlight-gray_background {
background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
background: rgba(253, 235, 236, 1);
}
.block-color-default {
color: inherit;
fill: inherit;
}
.block-color-gray {
color: rgba(120, 119, 116, 1);
fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
color: rgba(159, 107, 83, 1);
fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
color: rgba(217, 115, 13, 1);
fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
color: rgba(203, 145, 47, 1);
fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
color: rgba(68, 131, 97, 1);
fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
color: rgba(51, 126, 169, 1);
fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
color: rgba(144, 101, 176, 1);
fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
color: rgba(193, 76, 138, 1);
fill: rgba(193, 76, 138, 1);
}
.block-color-red {
color: rgba(212, 76, 71, 1);
fill: rgba(212, 76, 71, 1);
}
.block-color-gray_background {
background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
background: rgba(253, 235, 236, 1);
}
.select-value-color-interactiveBlue {
background-color: rgba(35, 131, 226, 0.07);
}
.select-value-color-pink {
background-color: rgba(245, 224, 233, 1);
}
.select-value-color-purple {
background-color: rgba(232, 222, 238, 1);
}
.select-value-color-green {
background-color: rgba(219, 237, 219, 1);
}
.select-value-color-gray {
background-color: rgba(227, 226, 224, 1);
}
.select-value-color-translucentGray {
background-color: rgba(255, 255, 255, 0.0375);
}
.select-value-color-orange {
background-color: rgba(250, 222, 201, 1);
}
.select-value-color-brown {
background-color: rgba(238, 224, 218, 1);
}
.select-value-color-red {
background-color: rgba(255, 226, 221, 1);
}
.select-value-color-yellow {
background-color: rgba(253, 236, 200, 1);
}
.select-value-color-blue {
background-color: rgba(211, 229, 239, 1);
}
.select-value-color-pageGlass {
background-color: undefined;
}
.select-value-color-washGlass {
background-color: undefined;
}.checkbox {
display: inline-flex;
vertical-align: text-bottom;
width: 16;
height: 16;
background-size: 16px;
margin-left: 2px;
margin-right: 5px;
}.checkbox-on {
background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}.checkbox-off {
background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}/* -------- injections from notionBackup -------- */body {
white-space: normal !important;
}p {
min-height: 1em !important;
}.code,
code {
font-size: 100% !important;
}blockquote {
font-size: 100% !important;
}.callout {
white-space: normal !important;
}
.callout div:has(span.icon) {
font-size: 100% !important;
}.source:not(.bookmark) {
font-size: 100% !important;
}p {
min-height: 1em !important;
}
</style></head><body><article class="page sans"><header><h1 class="page-title">MPI</h1><p class="page-description"></p></header><div class="page-body"><ul class="toggle"><li><details open=""><summary>CLI commands for compiling</summary><p>
On batch systems:
<mark class="highlight-gray"></mark><mark class="highlight-gray"><code>slurm srun</code></mark>
,
<mark class="highlight-gray"><code>sbatch</code></mark></p><pre class="code"><code>mpicc, mpif77, mpif90 – like cc, f77, f90
mpirun –np &lt;procs&gt; &lt;program&gt; … &lt;program options&gt; // -np means only one node </code></pre><p>
Starts
<mark class="highlight-gray"><code>&lt;procs&gt;</code></mark>
number of MPI processes executing same
<mark class="highlight-gray"><code>&lt;program&gt;</code></mark>
on available resources (processors, cores, threads, ...)
</p><p></p><p><mark class="highlight-gray"><code>&lt;program&gt;</code></mark>
executes:
</p><pre class="code"><code>MPI_Init(&amp;argc,&amp;argv);
// sets up internal data structures, incl:
...
MPI_Comm_size(MPI_COMM_WORLD,&amp;size);</code></pre><p></p></details></li></ul><p><a href="https://hpc-tutorials.llnl.gov/mpi/">https://hpc-tutorials.llnl.gov/mpi/</a></p><p><a href="https://curc.readthedocs.io/en/latest/programming/MPI-C.html">https://curc.readthedocs.io/en/latest/programming/MPI-C.html</a></p><p></p><p></p><nav class="block-color-gray table_of_contents"><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#45193c4b-4c59-485f-a2cf-2b9fdf5481aa">Models</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#317a46a8-cd1c-45d9-8964-b859cdf30527">Message-passing model</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#af07e1aa-631a-4723-8896-61dedd500f7f">MPI model</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#3f3e8580-1913-4fe0-9b65-e067e9bab3f7">MPI Concepts</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#7e49aa78-0af5-4ef8-8ea3-da3ef4b36df3">Basic library routines</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#43c2d29f-5919-40d4-b2cc-a7d750ade21c">Point-to-point communication</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#af3295e7-db2e-40cb-a765-c0614c628dbd">Sending</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#05e98387-1e76-437c-9c2d-a9d968deccea">Receiving</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#3cdb407e-cc4d-46b3-9403-866260c14247">Examples</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#361d4dd1-8f2a-4eab-bc07-c294682f6ee7">Safe programming</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#c12effa1-eb01-4abc-9f0f-d56343c8dcfa">Datatypes</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#d3947d3d-ee8f-4c8c-b911-1e483d08f1a0">One-sided communication</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#4edf517e-2982-41e5-a681-9c9351c758b0">Window, Epoch model</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#b2a98b39-94e1-4804-a4ee-d64babe8f61f">Origin, Target</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#55e805e2-6fe9-497b-a5f6-9b92c1dba3da">Epoch model, synchronization</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#a7a56b31-1586-4586-8adb-4956f73a9e88">Collective communication</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#b139517f-58ee-4227-9630-acdca6e78195">Overview</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#f924564e-7d5a-4c3e-9859-f69fda7916dd">Operations</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#3b2e7c91-3d61-4e14-825b-238e74185fcd">Reduction collectives</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#9c663bef-af2e-4f2e-9f65-230fd066483b">Scan collectives</a></div></nav><p></p><p></p><h1>Models</h1><h2>Message-passing model</h2><p><mark class="highlight-blue">Message-passing parallel abstraction / programming model</mark></p><div class="indented"><p><em>“Message passing paradigm”</em></p><p><em>“shared-nothing programming model”</em></p><p>Finite set of processes with local memory, program (no shared memory).</p><p>Explicit communication: Sending, receiving messages.</p><div class="indented"><ul class="bulleted-list"><li style="list-style-type: disc">Fully connected network: all processes are connected and can communicate.</li></ul><ul class="bulleted-list"><li style="list-style-type: disc">Communication can be one-sided (otherwise always both parties are involved).</li></ul><ul class="bulleted-list"><li style="list-style-type: disc">
We abstract over medium (physical network properties = communication network) and routing algorithm.
</li></ul></div><p></p><p>No implicit synchronization between processes (nothing else is shared).</p></div><p></p><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled.png" style="width: 288px"/></a></figure><p><mark class="highlight-blue">Advantages</mark></p><div class="indented"><p>All data exchange is explicit, deterministic</p><div class="indented"><p>We known: when, what, where</p><p>Reasoning about correctness, no race conditions</p></div><p></p></div><p></p><p></p><p><mark class="highlight-blue">Performance model</mark></p><div class="indented"><p>Communication = expensive (do it rarely and with large messages)</p><p>Local computation = cheap</p></div><p></p><p></p><h2>MPI model</h2><p><mark class="highlight-blue">Message passing interface MPI</mark></p><div class="indented"><p>Library</p><p>Standard for parallel programming in given model (no performance model).</p><p>Used for distributed applications with non-trivial algorithms that require communication.</p><p>Implemented efficiently and can coexist with other parallel interfaces (OpenMP, threads, ...)</p><div class="indented"><p>communication inside library isolated from communication outside library.</p></div><p></p><p>support SPMD, MIMD</p><div class="indented"><p>= loosely synchronous, all processes run the same program, processes distinguish themselves by their rank (process ID)</p><p>MIMD consists of application with different compiled programs.</p><p>(In this lecture only SPMD)</p></div><p></p><p></p></div><p></p><p><mark class="highlight-blue">MPI programming model</mark></p><div class="indented"><p>Physical processors can run multiple MPI processes (but usually only one, therefore static).</p><div class="indented"><p>Binding processes to processors is not part of the MPI.</p></div><p></p><hr/><ol class="numbered-list" start="1" type="1"><li>
Processes with rank
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">;</mo><mtext></mtext><mi>p</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo></mstyle></mrow><annotation encoding="application/x-tex">\small [0;~p-1]</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mopen sizing reset-size6 size5">[</span><span class="mord sizing reset-size6 size5">0</span><span class="mpunct sizing reset-size6 size5">;</span><span class="mspace nobreak sizing reset-size6 size5"></span><span class="mspace" style="margin-right: 0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size5">p</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">−</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord sizing reset-size6 size5">1</span><span class="mclose sizing reset-size6 size5">]</span></span></span></span></span><span>﻿</span></span>
in communication domain, can communicate.
</li></ol><ol class="numbered-list" start="2" type="1"><li>≥1 communication domains possible (created relative to default domain).</li></ol><ol class="numbered-list" start="3" type="1"><li>Processes operate only on local data - all communication explicit (and also reliable, ordered).</li></ol><ol class="numbered-list" start="4" type="1"><li>
Three basic communication models:
<ol class="numbered-list" start="1" type="i"><li>Point-to-point communication</li></ol><ol class="numbered-list" start="2" type="i"><li>One-sided communication</li></ol><ol class="numbered-list" start="3" type="i"><li>Collective operations</li></ol></li></ol><ol class="numbered-list" start="5" type="1"><li>Communication domains can reflect physical topology of network</li></ol><ol class="numbered-list" start="6" type="1"><li>No communication cost model</li></ol></div><p></p><p></p><p><mark class="highlight-blue">MPI communication models</mark></p><div class="indented"><ol class="numbered-list" start="1" type="i"><li>
Point-to-point communication (different modes)
<p>non-local and local completion</p><p><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="pink"><mstyle mathsize="0.9em"><mtext>MPI-Send</mtext><mo>⟹</mo><mtext>MPI-Recv</mtext></mstyle></mstyle></mrow><annotation encoding="application/x-tex">
\color{pink}\small \text{MPI-Send} \Longrightarrow \text{MPI-Recv}
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.646596em; vertical-align: -0.0216em"></span><span class="mord text sizing reset-size6 size5" style="color: pink"><span class="mord" style="color: pink">MPI-Send</span></span><span class="mspace" style="margin-right: 0.2777777777777778em"></span><span class="mrel sizing reset-size6 size5" style="color: pink">⟹</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height: 0.614997em; vertical-align: 0em"></span><span class="mord text sizing reset-size6 size5" style="color: pink"><span class="mord" style="color: pink">MPI-Recv</span></span></span></span></span></span><span>﻿</span></span></p></li></ol><ol class="numbered-list" start="2" type="i"><li>
One-sided communication (different synchronization mechanisms)
<p>local completion</p><p><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="pink"><mstyle mathsize="0.9em"><mtext>MPI-Put</mtext><mo>⟹</mo></mstyle></mstyle></mrow><annotation encoding="application/x-tex">\color{pink}\small \text{MPI-Put} \Longrightarrow</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.636597em; vertical-align: -0.0216em"></span><span class="mord text sizing reset-size6 size5" style="color: pink"><span class="mord" style="color: pink">MPI-Put</span></span><span class="mspace" style="margin-right: 0.2777777777777778em"></span><span class="mrel sizing reset-size6 size5" style="color: pink">⟹</span></span></span></span></span><span>﻿</span></span></p></li></ol><ol class="numbered-list" start="3" type="i"><li>
Collective operations (can be non-blocking)
<p>non-local completion</p><p><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="pink"><mstyle mathsize="0.9em"><mtext>MPI-Bcast</mtext><mo>⟹</mo><mi>a</mi><mpadded voffset="0.3em"><mstyle displaystyle="false" scriptlevel="0"><mstyle displaystyle="false" scriptlevel="0"><mi>b</mi></mstyle></mstyle></mpadded><mi>c</mi></mstyle></mstyle></mrow><annotation encoding="application/x-tex">
\color{pink}\small \text{MPI-Bcast} \Longrightarrow a\raisebox{0.3em}{$b$}c
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.636597em; vertical-align: -0.0216em"></span><span class="mord text sizing reset-size6 size5" style="color: pink"><span class="mord" style="color: pink">MPI-Bcast</span></span><span class="mspace" style="margin-right: 0.2777777777777778em"></span><span class="mrel sizing reset-size6 size5" style="color: pink">⟹</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height: 0.894996em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5" style="color: pink">a</span><span class="vlist-t sizing reset-size6 size5"><span class="vlist-r"><span class="vlist" style="height: 0.99444em"><span style="top: -3.1999999999999997em"><span class="pstrut" style="height: 2.9em"></span><span class="mord" style="color: pink"><span class="mord mathnormal" style="color: pink">b</span></span></span></span></span></span><span class="mord mathnormal sizing reset-size6 size5" style="color: pink">c</span></span></span></span></span><span>﻿</span></span></p></li></ol><ol class="block-color-gray numbered-list" start="4" type="i"><li>
Other operations (not in this lecture)
<p>parallel I/O, spawning processes, virtual topologies, ...</p></li></ol><hr/><p>Rule:</p><div class="indented"><p>
All messages sent must be received, else
<mark class="highlight-gray"><code>MPI_Finalize()</code></mark>
may not terminate because there are pending communications.
</p></div><p></p></div><p></p><p></p><p><mark class="highlight-blue">Deadlocks in MPI</mark></p><div class="indented"><p>Possible forms:</p><div class="indented"><ol class="numbered-list" start="1" type="a"><li>All processes waiting for event that can not happen</li></ol><ol class="numbered-list" start="2" type="a"><li>
Process
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>i</mi></mstyle></mrow><annotation encoding="application/x-tex">\small i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.593568em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5">i</span></span></span></span></span><span>﻿</span></span>
waiting for
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>j</mi></mstyle></mrow><annotation encoding="application/x-tex">\small j</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.768564em; vertical-align: -0.174996em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.05724em">j</span></span></span></span></span><span>﻿</span></span>
,
<p><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>j</mi></mstyle></mrow><annotation encoding="application/x-tex">\small j</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.768564em; vertical-align: -0.174996em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.05724em">j</span></span></span></span></span><span>﻿</span></span>
waiting for
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>i</mi></mstyle></mrow><annotation encoding="application/x-tex">\small i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.593568em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5">i</span></span></span></span></span><span>﻿</span></span></p></li></ol><ol class="numbered-list" start="3" type="a"><li>
Process
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>i</mi></mstyle></mrow><annotation encoding="application/x-tex">\small i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.593568em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5">i</span></span></span></span></span><span>﻿</span></span>
waiting for
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>i</mi><mo>+</mo><mn>1</mn></mstyle></mrow><annotation encoding="application/x-tex">\small i+1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.668565em; vertical-align: -0.07499700000000001em"></span><span class="mord mathnormal sizing reset-size6 size5">i</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.5799960000000001em; vertical-align: 0em"></span><span class="mord sizing reset-size6 size5">1</span></span></span></span></span><span>﻿</span></span>
,
<p><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>i</mi><mo>+</mo><mn>1</mn></mstyle></mrow><annotation encoding="application/x-tex">\small i+1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.668565em; vertical-align: -0.07499700000000001em"></span><span class="mord mathnormal sizing reset-size6 size5">i</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.5799960000000001em; vertical-align: 0em"></span><span class="mord sizing reset-size6 size5">1</span></span></span></span></span><span>﻿</span></span>
waiting for
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>i</mi><mo>+</mo><mn>2</mn></mstyle></mrow><annotation encoding="application/x-tex">\small i+2</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.668565em; vertical-align: -0.07499700000000001em"></span><span class="mord mathnormal sizing reset-size6 size5">i</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.5799960000000001em; vertical-align: 0em"></span><span class="mord sizing reset-size6 size5">2</span></span></span></span></span><span>﻿</span></span>
,
</p><p><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>…</mo></mrow><annotation encoding="application/x-tex">\dots</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.12em; vertical-align: 0em"></span><span class="minner">…</span></span></span></span></span><span>﻿</span></span></p></li></ol></div><p></p></div><p></p><p><mark class="highlight-blue">Unsafe programs in MPI</mark></p><div class="indented"><p>
An MPI program is
<em>unsafe</em>
if termination depends on implementation of library (ie. buffering of
<mark class="highlight-gray"><code>MPI_Send</code></mark>
), concrete context (ie. processes and communication).
</p><p>It may or may not deadlock.</p><p>Not portable (different libraries implemented differently).</p></div><p></p><p></p><p></p><h1>MPI Concepts</h1><p><mark class="highlight-blue">Communicator object</mark><code><mark class="highlight-blue">comm</mark></code><mark class="highlight-blue">(= communication domain)</mark></p><div class="indented"><p>Communicators are static objects that cannot change.</p><div class="indented"><p>Processes cannot be moved around in them - we can only create new comms from old ones (and free them after the usage).</p></div><p></p><p>Predefined communicators:</p><div class="indented"><p><mark class="highlight-gray"><code>MPI_COMM_WORLD</code></mark><mark class="highlight-gray"></mark>
= Initial communicator, contains set of processes that all can communicate with eachother, communication context.
</p><p><mark class="highlight-gray"><code>MPI_COMM_SELF</code></mark>
= Singleton communicator with only process (itself)
</p><p><mark class="highlight-gray"><code>MPI_COMM_NULL</code></mark>
= No or invalid communicator
</p></div><p></p><hr/><p>Rules:</p><div class="indented"><ol class="numbered-list" start="1" type="1"><li>Communication in MPI is always relative to comm</li></ol><ol class="numbered-list" start="2" type="1"><li>Process ranks = id + communicator they are in</li></ol></div><p></p></div><p></p><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%201.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%201.png" style="width: 144px"/></a></figure><p></p><p><mark class="highlight-blue">Handle</mark></p><div class="indented"><p>special MPI typedef.</p><p>Handles are opaque (not transparent) - the internal datastructures can only be accessed through the operations defined on them.</p><hr/><p>TL;DR: they are the prefixes of library routines.</p><p><mark class="highlight-gray">ie.</mark><mark class="highlight-gray"><code>MPI_COMM_WORLD</code></mark><mark class="highlight-gray">has handle</mark><code><mark class="highlight-gray">MPI_Comm</mark></code><mark class="highlight-gray">and is used to access the current comm of a process and perform operations on it.</mark></p></div><p></p><p></p><p><mark class="highlight-blue">MPI handles</mark></p><div class="indented"><p><mark class="highlight-teal"><code>MPI_Comm</code></mark><mark class="highlight-teal">- communicators (global)</mark></p><div class="indented"><p>
can be manipulated with collective operations (ie.
<mark class="highlight-gray"><code>MPI_Comm_split</code></mark>
,
<mark class="highlight-gray"><code>MPI_Comm_dup</code></mark>
, ...)
</p></div><p></p><p><mark class="highlight-teal"><code>MPI_Group</code></mark><mark class="highlight-teal">- process groups (local)</mark></p><div class="indented"><p>ordered set of processes used for one-sided communication</p><ul class="toggle"><li><details open=""><summary>can be manipulated locally</summary><pre class="code"><code>MPI_Group_union
MPI_Group_intersection
MPI_Group_incl, MPI_Group_excl
MPI_Group_translate_ranks
MPI_Group_compare
...</code></pre></details></li></ul></div><p></p><p><mark class="highlight-teal"><code>MPI_Win</code></mark><mark class="highlight-teal">- windows for one-sided communication (distributed)</mark></p><p><mark class="highlight-teal"><code>MPI_Datatype</code></mark><mark class="highlight-teal">- Description of data layouts</mark></p><div class="indented"><p>describe unit of communication.</p></div><p></p><p><mark class="highlight-teal"><code>MPI_Op</code></mark><mark class="highlight-teal">- Binary operations</mark></p><p><mark class="highlight-teal"><code>MPI_Request</code></mark><mark class="highlight-teal">- Request handle for point-to-point</mark></p><p><mark class="highlight-teal"><code>MPI_Status</code></mark><mark class="highlight-teal">- Communication status</mark></p><div class="indented"><p>Information on what was received.</p></div><p></p><p><mark class="highlight-teal"><code>MPI_Errhandler</code></mark></p><p><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>…</mo></mrow><annotation encoding="application/x-tex">\dots</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.12em; vertical-align: 0em"></span><span class="minner">…</span></span></span></span></span><span>﻿</span></span></p></div><p></p><p></p><p></p><h1>Basic library routines</h1><p><mark class="highlight-blue">Function arguments</mark></p><div class="indented"><p><em>OUT arguments</em>
pointers
</p><p><em>IN arguments</em>
pointers, values
</p><p><em>Handles</em>
special MPI typedef’s
</p><ul class="toggle"><li><details open=""><summary>Example</summary><pre class="code"><code>int MPI_Reduce(
void *sendbuf, // IN
void *recvbuf, // OUT
int count, // IN
MPI_Datatype datatype, // IN (handle)
MPI_Op op, // IN (handle)
int root, // IN
MPI_Comm comm // IN (handle)
);</code></pre></details></li></ul></div><p></p><p></p><p><mark class="highlight-blue">Error-status</mark></p><div class="indented"><p>Good practice: checking error status</p><pre class="code"><code>err = MPI_&lt;some MPI function&gt;(…); // returns ie. MPI_SUCCESS</code></pre><ul class="toggle"><li><details open=""><summary>List of all error codes</summary><p>One can also define new ones.</p><pre class="code"><code>MPI_SUCCESS
MPI_ERR_BUFFER
MPI_ERR_COUNT
MPI_ERR_TYPE
MPI_ERR_TAG
MPI_ERR_COUNT
MPI_ERR_RANK
…
MPI_ERR_UNKNOWN
MPI_ERR_TRUNCATE // sometimes returned for point-to-point
…
MPI_ERR_WIN
MPI_ERR_LASTCODE</code></pre><p></p></details></li></ul></div><p></p><p><mark class="highlight-blue">Calling with try-catch similar function</mark></p><div class="indented"><p><mark class="highlight-gray"><code>errhandle</code></mark>
: handle to function that will be called on error (but usually it doesn’t work and the function will just abort)
</p><pre class="code"><code>MPI_Comm_set_errhandler(comm,errhandle)</code></pre></div><p></p><p></p><p><mark class="highlight-blue">First and last coll of MPI in application (only called once)</mark></p><div class="indented"><pre class="code"><code>MPI_Init(&amp;argc,&amp;argv);
MPI_Finalize();</code></pre></div><p></p><p></p><p><mark class="highlight-blue">Size of communicator and process rank</mark></p><div class="indented"><pre class="code"><code>MPI_Comm_rank(MPI_COMM_WORLD,&amp;rank);
MPI_Comm_size(MPI_COMM_WORLD,&amp;size);</code></pre><hr/><ul class="toggle"><li><details open=""><summary>Example: Check rank and size of communicator</summary><pre class="code"><code>#include &lt;mpi.h&gt;int main(int argc, char *argv[]) {
int rank, size;
MPI_Init(&amp;argc, &amp;argv); // first call, performed by all -&gt; MPI_Initialized(flag)MPI_Comm_size(MPI_COMM_WORLD, &amp;size);
MPI_Comm_rank(MPI_COMM_WORLD, &amp;rank); // Who am I?fprintf(stdout,"Here is %d out of %d\n", rank, size);MPI_Finalize(); // last call, performed by all -&gt; MPI_Finalized(flag)
return 0;
}</code></pre><p></p></details></li></ul><ul class="toggle"><li><details open=""><summary>Example: Assign task to processor</summary><pre class="code"><code>MPI_Comm_size(MPI_COMM_WORLD,&amp;size);
MPI_Comm_rank(MPI_COMM_WORLD,&amp;rank);if (size&lt;10 || size&gt;1000000) MPI_Abort(comm,errcode);if (rank==0) {
// code for rank 0; may be special
} else if (rank%2==0) {
// remainder even ranks
} else if (rank==7) {
// another special one
} else {
// all other (odd) processes…
}</code></pre></details></li></ul></div><p></p><p></p><p><mark class="highlight-blue">Benchmarking</mark></p><div class="indented"><pre class="code"><code>MPI_Barrier(MPI_COMM_WORLD); // synchronize processes (semantically)
double point_in_time = MPI_Wtime(); // get time</code></pre></div><p></p><p></p><p><mark class="highlight-blue">Freeing memory for communicators</mark></p><div class="indented"><p>Frees any allocated communicator after use.</p><pre class="code"><code>MPI_Comm_free(&amp;comm);</code></pre><p><mark class="highlight-gray">(</mark><mark class="highlight-gray"><code>MPI_COMM_WORLD</code></mark><mark class="highlight-gray">,</mark><mark class="highlight-gray"><code>MPI_COMM_SELF</code></mark><mark class="highlight-gray">can not be freed)</mark></p></div><p></p><p></p><p></p><h1>Point-to-point communication</h1><p><mark class="highlight-blue">Point-to-point communication</mark></p><div class="indented"><p>Two processes communicate explicitly.</p><p>Both involved as: sender, receiver.</p></div><p></p><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%202.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%202.png" style="width: 144px"/></a></figure><p><mark class="highlight-blue">General properties</mark></p><div class="indented"><p>Deadlock free Message is eventually received (with matching operations)</p><p>Non-overtaking Messages sent to the same destination arrive there in sent order.</p><p>Different order can be enforced with tags.</p><p>Reliable Messages don’t get lost, content can be trusted.</p></div><p></p><p></p><h2>Sending</h2><p><mark class="highlight-blue">Sender</mark></p><div class="indented"><p>Completion is non-local:</p><div class="indented"><p>Call return may depend on receiving rank having initiated receive operation.</p><p>The local completion depends on implementation (can be done so that the sender returns fast).</p></div><p></p><p>Operation is blocking:</p><div class="indented"><p><mark class="highlight-gray"><code>MPI_Send</code></mark><mark class="highlight-gray"></mark>
returns back to caller of function, when
<mark class="highlight-gray"><code>sendbuf</code></mark><mark class="highlight-gray"></mark>
is safe to be reused again (not necessarily when message is received).
</p></div><p></p><p>Operation is non-overtaking:</p><div class="indented"><p>Messages sent to the same destination arrive there in sent order.</p></div><p></p><pre class="code"><code>MPI_Send(
void *sendbuf, // pointer to data to be sent
int count, // number of units to be sent
MPI_Datatype datatype, // datatype of unit (unchecked, programmers responsibility)
int dest, // rank of receiver
int tag, // type of message
MPI_Comm comm // communicator (in which both are placed)
);</code></pre><p>Convention: Buffer size must be divisible by 3.</p></div><p></p><p></p><p><mark class="highlight-blue">Multiple implementations in library</mark></p><div class="indented"><p><mark class="highlight-gray"><code>MPI_Send</code></mark><mark class="highlight-gray"></mark>
standard - returns when buffer can be used
</p><p><mark class="highlight-gray"><code>MPI_Ssend</code></mark>
synchronous - returns when buffer can be used and recipient received
</p><p><mark class="highlight-gray"><code>MPI_Bsend</code></mark>
buffered - returns immediately (also copies data to immediate buffer)
</p><p><mark class="highlight-gray"><code>MPI_Rsend</code></mark>
ready - precondition: receive must have been posted (acknowledgement)
</p><p><mark class="highlight-gray"><code>MPI_Isend</code></mark>
immediate - returns immediately
</p></div><p></p><p></p><h2>Receiving</h2><p><mark class="highlight-blue">Recipient</mark></p><div class="indented"><p>Operation is blocking:</p><div class="indented"><p><mark class="highlight-gray"><code>MPI_Recv</code></mark><mark class="highlight-gray"></mark>
returns back to caller of function, when message has been received (Can take forever → deadlock).
</p><p>
Then stores status in given pointer (ie. status is
<mark class="highlight-gray"><code>MPI_ERR_TRUNCATE</code></mark><mark class="highlight-gray"></mark>
if buffer of receiver is not large enough).
</p></div><p></p><pre class="code"><code>MPI_Recv(
// ... same as above
MPI_Status *status // status of received message
);</code></pre><p><mark class="highlight-teal">Wildcards:</mark>
Can accept message from any rank with
<code><mark class="highlight-gray">MPI_ANY_SOURCE</mark></code><mark class="highlight-gray"><mark class="highlight-gray"></mark></mark>
and any tag with
<code><mark class="highlight-gray"><mark class="highlight-gray">MPI_ANY_TAG</mark></mark></code>
(but leads to non-determinism).
</p><p>Convention: Buffer size must be divisible by 3.</p></div><p></p><p></p><p><mark class="highlight-blue">Multiple implementations in library</mark></p><div class="indented"><p><mark class="highlight-gray"><code>MPI_Rece</code></mark><mark class="highlight-gray"></mark>
Standard - blocking
</p><p><mark class="highlight-gray"><code>MPI_IRecv</code></mark>
Immediate - nonblocking
</p></div><p></p><p></p><p><mark class="highlight-blue">Counting received data</mark></p><div class="indented"><pre class="code"><code>MPI_Get_count(status,datatype,count);
MPI_Get_elements(status,datatype,count);</code></pre><p>
Both are equivalent for basic datatypes such as
<mark class="highlight-gray"><code>MPI_INT</code></mark>
, ...
</p><hr/><ul class="toggle"><li><details open=""><summary>Example</summary><pre class="code"><code>#include &lt;assert.h&gt;int recvbuf[600]; // large enough
count = 600; // equal or larger to what is being sentMPI_Status status;
success = MPI_Recv(recvbuf,count,MPI_INT,2,THISMSG,comm,&amp;status);int realcount;
MPI_Get_count(status,MPI_INT,&amp;realcount);
// possibly realcount&lt;count;
assert(realcount&lt;=count);</code></pre></details></li></ul></div><p></p><p></p><p><mark class="highlight-blue">Sources of non-determinism</mark></p><div class="indented"><p>Deterministic messages are non-overtaking (messages sent arrive at destination in same order).</p><ol class="numbered-list" start="1" type="1"><li>
Wildcards
<pre class="code"><code>MPI_Recv(..., MPI_ANY_SOURCE, MPI_ANY_TAG, ...);</code></pre><p>Any message, from any sender at any time</p></li></ol><ol class="numbered-list" start="2" type="1"><li>
Probe
<pre class="code"><code>MPI_Probe(source,tag,comm,&amp;status); // blocking
MPI_Iprobe(source,tag,comm,&amp;flag,&amp;status); // nonblocking</code></pre><p>
Stops blocking, when message with given source, and tag in comm have arrived and is ready for reception
<mark class="highlight-gray">(</mark><mark class="highlight-gray"><code>MPI_Recv()</code></mark><mark class="highlight-gray">then can be called without blocking)</mark>
.
</p><p><code><mark class="highlight-gray">flag == 1</mark></code>
means message with source and tag ready for reception in comm (then
<mark class="highlight-gray"><code>status</code></mark>
is also updated).
</p><hr/><ul class="toggle"><li><details open=""><summary>Example</summary><pre class="code"><code>#include &lt;assert.h&gt;MPI_Status status;
int tag = 777;MPI_Probe(MPI_ANY_SOURCE,tag,comm,&amp;status);
// blocking call - returns when message with tag 777 has arrived
assert(status.MPI_TAG==tag);int source = status.MPI_SOURCE;
int count;
MPI_Get_count(status,MPI_INT,&amp;count); // get count
recvbuf = (int*)malloc(count*sizeof(int)); // allocate
MPI_Recv(recvbuf,count,MPI_INT,source,tag,comm,MPI_STATUS_IGNORE);</code></pre></details></li></ul></li></ol></div><p></p><p></p><h2>Examples</h2><p><mark class="highlight-blue">Examples</mark></p><div class="indented"><ul class="toggle"><li><details open=""><summary>Example: Sending double and integer</summary><pre class="code"><code>int a[N];
float area;
MPI_Send(a,N,MPI_INT,j,TAG1,MPI_COMM_WORLD); // send a
MPI_Send(&amp;area,1,MPI_FLOAT,j,TAG2,MPI_COMM_WORLD); // send area</code></pre><p><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="1.2em"><mo>↓</mo></mstyle></mrow><annotation encoding="application/x-tex">\large \downarrow</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 1.066656em; vertical-align: -0.23332799999999998em"></span><span class="mrel sizing reset-size6 size7">↓</span></span></span></span></span><span>﻿</span></span></p><pre class="code"><code>int a[N];
float area;
MPI_Recv(a,N,MPI_INT,j,TAG1,MPI_COMM_WORLD); // receive a
MPI_Recv(&amp;area,1,MPI_FLOAT,j,TAG2,MPI_COMM_WORLD); // receive area</code></pre><p></p></details></li></ul><ul class="toggle"><li><details open=""><summary>Example: Sending 500 integers</summary><p>
Process2
<mark class="highlight-gray">-</mark><em><mark class="highlight-gray">500 integers →</mark></em><em></em>
Process500
</p><pre class="code"><code>int THISMSGTAG = 777; // message TAG
int count = 500;if (rank==2) {
int sendbuf[500] = {&lt;500 integers&gt;};
MPI_Send(sendbuf,count,MPI_INT,4,THISMSGTAG,comm);} else if (rank==4) {
int recvbuf[count + 100]; // equal or larger than what is being sent
MPI_Status status;
success = MPI_Recv(recvbuf,count,MPI_INT,2,THISMSGTAG,comm,&amp;status);}</code></pre><p><em>“Start reception of message</em><mark class="highlight-gray"><code><em>THISMSGTAG</em></code></mark><em>from rank 2 in</em><mark class="highlight-gray"><code><em>comm</em></code></mark><em>, store result in</em><mark class="highlight-gray"><code><em>recvbuf</em></code></mark><em>, at most 600 consecutive integers (otherwise</em><mark class="highlight-gray"><code><em>success==MPI_ERR_TRUNCATE</em></code></mark><em>)</em></p></details></li></ul><ul class="toggle"><li><details open=""><summary>Example: Non matching types</summary><p>Here the types dont match.</p><div class="indented"><p>Communication would take place but its bad practice.</p><p>Type could be lost → Processors could have different endianness.</p></div><p></p><pre class="code"><code>double a;
MPI_Send(&amp;a,1,MPI_DOUBLE,j,1111,MPI_COMM_WORLD);</code></pre><p><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="1.2em"><mo>↓</mo></mstyle></mrow><annotation encoding="application/x-tex">\large \downarrow</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 1.066656em; vertical-align: -0.23332799999999998em"></span><span class="mrel sizing reset-size6 size7">↓</span></span></span></span></span><span>﻿</span></span></p><pre class="code"><code>double a;
MPI_Recv(a,sizeof(double),MPI_BYTE,i,1111,MPI_COMM_WORLD,MPI_STATUS_IGNORE);</code></pre><p></p></details></li></ul></div><p></p><p></p><p><mark class="highlight-blue">Synchronization with 0-count message</mark></p><div class="indented"><ul class="toggle"><li><details open=""><summary>Example: One sided synchronization</summary><p>MPI processes are not synchronized - messages can be used.</p><div class="indented"><p>Receiving process cannnot proceed before message arrives.</p></div><p></p><pre class="code"><code>MPI_Send(NULL,0,MPI_INT,dest,tag,comm); // 0 count message
↓
MPI_Recv(NULL,0,MPI_INT,source,tag,comm,&amp;status);</code></pre><p></p></details></li></ul><ul class="toggle"><li><details open=""><summary>Example: Pairwise synchronization</summary><pre class="code"><code>MPI_Ssend(NULL,0,MPI_INT,dest,tag,comm); // blocks until message received
↓
MPI_Recv(NULL,0,MPI_INT,source,tag,comm,&amp;stat);</code></pre><p></p></details></li></ul></div><p></p><p></p><h2>Safe programming</h2><p><mark class="highlight-blue">Unsafe programming</mark></p><div class="indented"><p>
It’s possible that the program does not lead to a deadlock if multiple processors
<mark class="highlight-gray">MPI_Send()</mark>
to eachother simultaniously.
</p><p>The exact conditions of local-completion depend on the implementation in the library.</p><hr/><ul class="toggle"><li><details open=""><summary>Example: 2d, 5-point stencil algorithm (unsafe)</summary><p>
Given
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>×</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">m \times n</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.66666em; vertical-align: -0.08333em"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em"></span><span class="mord mathnormal">n</span></span></span></span></span><span>﻿</span></span>
matrix
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em"></span><span class="mord mathnormal">u</span></span></span></span></span><span>﻿</span></span>
:
</p><div class="indented"><p><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>u</mi><mo stretchy="false">[</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">]</mo><mo>←</mo><mfrac><mn>1</mn><mn>4</mn></mfrac><mo>⋅</mo><mo stretchy="false">(</mo><mstyle mathcolor="pink"><mi>u</mi><mo stretchy="false">[</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo>+</mo><mi>u</mi><mo stretchy="false">[</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo>+</mo><mn>1</mn><mo stretchy="false">]</mo><mo>+</mo><mi>u</mi><mo stretchy="false">[</mo><mi>i</mi><mo>−</mo><mn>1</mn><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">]</mo><mo>+</mo><mi>u</mi><mo stretchy="false">[</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">]</mo></mstyle><mo>−</mo><msup><mi>h</mi><mn>2</mn></msup><mo>⋅</mo><mi>f</mi><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mstyle></mrow><annotation encoding="application/x-tex">
\small u[i,j] \larr \frac{1}{4}\cdot
(\textcolor{pink}{u[i,j-1]+u[i,j+1]+u[i-1,j]+u[i+1,j]}-h^ 2 \cdot f(i,j))
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5">u</span><span class="mopen sizing reset-size6 size5">[</span><span class="mord mathnormal sizing reset-size6 size5">i</span><span class="mpunct sizing reset-size6 size5">,</span><span class="mspace" style="margin-right: 0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.05724em">j</span><span class="mclose sizing reset-size6 size5">]</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span><span class="mrel sizing reset-size6 size5">←</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height: 1.051764em; vertical-align: -0.3105em"></span><span class="mord sizing reset-size6 size5"><span class="mopen nulldelimiter sizing reset-size5 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.8236266666666667em"><span style="top: -2.6550000000000002em"><span class="pstrut" style="height: 3em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight"><span class="mord mtight">4</span></span></span></span><span style="top: -3.23em"><span class="pstrut" style="height: 3em"></span><span class="frac-line" style="border-bottom-width: 0.04em"></span></span><span style="top: -3.394em"><span class="pstrut" style="height: 3em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size5 size6"></span></span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">⋅</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mopen sizing reset-size6 size5">(</span><span class="mord mathnormal sizing reset-size6 size5" style="color: pink">u</span><span class="mopen sizing reset-size6 size5" style="color: pink">[</span><span class="mord mathnormal sizing reset-size6 size5" style="color: pink">i</span><span class="mpunct sizing reset-size6 size5" style="color: pink">,</span><span class="mspace" style="margin-right: 0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.05724em; color: pink">
j
</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5" style="color: pink">−</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord sizing reset-size6 size5" style="color: pink">1</span><span class="mclose sizing reset-size6 size5" style="color: pink">]</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5" style="color: pink">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5" style="color: pink">u</span><span class="mopen sizing reset-size6 size5" style="color: pink">[</span><span class="mord mathnormal sizing reset-size6 size5" style="color: pink">i</span><span class="mpunct sizing reset-size6 size5" style="color: pink">,</span><span class="mspace" style="margin-right: 0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.05724em; color: pink">
j
</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5" style="color: pink">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord sizing reset-size6 size5" style="color: pink">1</span><span class="mclose sizing reset-size6 size5" style="color: pink">]</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5" style="color: pink">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5" style="color: pink">u</span><span class="mopen sizing reset-size6 size5" style="color: pink">[</span><span class="mord mathnormal sizing reset-size6 size5" style="color: pink">i</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5" style="color: pink">−</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord sizing reset-size6 size5" style="color: pink">1</span><span class="mpunct sizing reset-size6 size5" style="color: pink">,</span><span class="mspace" style="margin-right: 0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.05724em; color: pink">
j
</span><span class="mclose sizing reset-size6 size5" style="color: pink">]</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5" style="color: pink">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5" style="color: pink">u</span><span class="mopen sizing reset-size6 size5" style="color: pink">[</span><span class="mord mathnormal sizing reset-size6 size5" style="color: pink">i</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5" style="color: pink">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord sizing reset-size6 size5" style="color: pink">1</span><span class="mpunct sizing reset-size6 size5" style="color: pink">,</span><span class="mspace" style="margin-right: 0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.05724em; color: pink">
j
</span><span class="mclose sizing reset-size6 size5" style="color: pink">]</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">−</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.713364em; vertical-align: 0em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7926266666666666em"><span style="top: -2.963em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">⋅</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.10764em">f</span><span class="mopen sizing reset-size6 size5">(</span><span class="mord mathnormal sizing reset-size6 size5">i</span><span class="mpunct sizing reset-size6 size5">,</span><span class="mspace" style="margin-right: 0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.05724em">j</span><span class="mclose sizing reset-size6 size5">))</span></span></span></span></span><span>﻿</span></span></p><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%203.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%203.png" style="width: 192px"/></a></figure></div><p></p><p>Special conditions on borders:</p><div class="indented"><p><mark class="highlight-gray"><code>i=0</code></mark>
,
<mark class="highlight-gray"><code>i=m-1</code></mark>
,
<mark class="highlight-gray"><code>j=0</code></mark>
,
<mark class="highlight-gray"><code>j=n-1</code></mark></p></div><p></p><p>Sequential solution:</p><div class="indented"><p><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>O</mi><mo stretchy="false">(</mo><mi>m</mi><mo>⋅</mo><mi>n</mi><mo>⋅</mo><mi>f</mi><mo stretchy="false">)</mo></mstyle></mrow><annotation encoding="application/x-tex">\small O(m\cdot n \cdot f)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.02778em">O</span><span class="mopen sizing reset-size6 size5">(</span><span class="mord mathnormal sizing reset-size6 size5">m</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">⋅</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.400005em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5">n</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">⋅</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.10764em">f</span><span class="mclose sizing reset-size6 size5">)</span></span></span></span></span><span>﻿</span></span>
per iteration
</p></div><p></p><hr/><p>Parallelization</p><div class="indented"><p>
We split the matrix into equal sized submatrices
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msup><mi>m</mi><mo lspace="0em" mathvariant="normal" rspace="0em">′</mo></msup><mo>×</mo><msup><mi>n</mi><mo lspace="0em" mathvariant="normal" rspace="0em">′</mo></msup></mstyle></mrow><annotation encoding="application/x-tex">\small m' \times n'</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.7350329999999999em; vertical-align: -0.07499700000000001em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7333733333333333em"><span style="top: -2.963em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">×</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.660036em; vertical-align: 0em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7333733333333333em"><span style="top: -2.963em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>
and perform each locally.
</p><p>Borders of each matrix must read values from other submatrices → use messages.</p><p>
Work:
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>O</mi><mo stretchy="false">(</mo><msup><mi>m</mi><mo lspace="0em" mathvariant="normal" rspace="0em">′</mo></msup><mo>⋅</mo><msup><mi>n</mi><mo lspace="0em" mathvariant="normal" rspace="0em">′</mo></msup><mo>⋅</mo><mi>f</mi><mo stretchy="false">)</mo></mstyle></mrow><annotation encoding="application/x-tex">\small O(m' \cdot n' \cdot f)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.02778em">O</span><span class="mopen sizing reset-size6 size5">(</span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7333733333333333em"><span style="top: -2.963em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">⋅</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.660036em; vertical-align: 0em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7333733333333333em"><span style="top: -2.963em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">⋅</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.10764em">f</span><span class="mclose sizing reset-size6 size5">)</span></span></span></span></span><span>﻿</span></span>
per process
</p><div class="indented"><p><mark class="highlight-gray">update is</mark><mark class="highlight-gray"><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>O</mi><mo stretchy="false">(</mo><mi>f</mi><mo stretchy="false">)</mo></mstyle></mrow><annotation encoding="application/x-tex">\small O(f)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.02778em">
O
</span><span class="mopen sizing reset-size6 size5">(</span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.10764em">
f
</span><span class="mclose sizing reset-size6 size5">)</span></span></span></span></span><span>﻿</span></span></mark><mark class="highlight-gray">.</mark></p><p><mark class="highlight-gray">two messages of</mark><mark class="highlight-gray"><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>O</mi><mo stretchy="false">(</mo><msup><mi>m</mi><mo lspace="0em" mathvariant="normal" rspace="0em">′</mo></msup><mo stretchy="false">)</mo></mstyle></mrow><annotation encoding="application/x-tex">\small O(m')</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.02778em">
O
</span><span class="mopen sizing reset-size6 size5">(</span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7333733333333333em"><span style="top: -2.963em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose sizing reset-size6 size5">)</span></span></span></span></span><span>﻿</span></span></mark><mark class="highlight-gray">for columns</mark></p><p><mark class="highlight-gray">two messages of</mark><mark class="highlight-gray"><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mo lspace="0em" mathvariant="normal" rspace="0em">′</mo></msup><mo stretchy="false">)</mo></mstyle></mrow><annotation encoding="application/x-tex">\small O(n')</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.02778em">
O
</span><span class="mopen sizing reset-size6 size5">(</span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7333733333333333em"><span style="top: -2.963em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose sizing reset-size6 size5">)</span></span></span></span></span><span>﻿</span></span></mark><mark class="highlight-gray">for rows</mark></p></div><p></p></div><p></p><p></p><p>Parallel algorithm</p><div class="indented"><p>
Assume we are looking at view of rank
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>i</mi></mstyle></mrow><annotation encoding="application/x-tex">\small i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.593568em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5">i</span></span></span></span></span><span>﻿</span></span>
.
</p><ol class="numbered-list" start="1" type="1"><li>
“Halo-exchange of depth 1”
<ol class="numbered-list" start="1" type="i"><li>Receive rows and columns of 4 neighbour-processes.</li></ol><ol class="numbered-list" start="2" type="i"><li>Send rows and columns to 4 neighbour-processes.</li></ol></li></ol><ol class="numbered-list" start="2" type="1"><li>Parallel stencil computation</li></ol></div><p></p><p></p><p>If first receiving, then sending → deadlock</p><div class="indented"><p>
Each receive blocks until send operation starts (this never happens if multiple interdependent blocks receive
simultaniously)
</p></div><p></p><p>If first sending, then receiving → unsafe</p><div class="indented"><p>Deadlock only based on message size and library implementation.</p><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%204.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%204.png" style="width: 192px"/></a></figure></div><p></p><p></p></details></li></ul><ul class="toggle"><li><details open=""><summary>Example: 1d-stencil (unsafe)</summary><p>
Arrays
<mark class="highlight-gray"><code>a</code></mark>
and
<mark class="highlight-gray"><code>b</code></mark>
distributed in blocks over MPI processes
</p><pre class="code"><code>for (i=n[j]; i&lt;n[j+1]; i++) {
b[i] = a[i-1]+a[i]+a[i+1];
}</code></pre><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%205.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%205.png" style="width: 240px"/></a></figure><p></p><ol class="numbered-list" start="1" type="1"><li>
Receiving before sending
<pre class="code"><code>float *a = malloc((n/p+2)*sizeof(float));
a += 1; // offset, such that -1 and n/p can b addressed// step 1 [1; size-1]
if (rank&gt;0) {
MPI_Recv(&amp;a[-1],1,MPI_FLOAT,rank-1,999,comm,&amp;status); // &lt;-- DEADLOCK
MPI_Send(&amp;a[0],1,MPI_FLOAT,rank-1,999,comm);
}// step 2 [0; size-2]
if (rank&lt;size-1) {
MPI_Recv(&amp;a[n/p],1,MPI_FLOAT,rank+1,999,comm,&amp;status); // &lt;-- DEADLOCK
MPI_Send(&amp;a[n/p-1],1,MPI_FLOAT,rank+1,999,comm;
}for (i=0; i&lt;n/p; i++) {
b[i] = a[i-1]+a[i]+a[i+1];
}</code></pre><p><mark class="highlight-red">Deadlock:</mark>
Processes try to receive without sending blocks.
</p><p></p></li></ol><ol class="numbered-list" start="2" type="1"><li>
Sending before receiving
<p>
Is possible without deadlocks
<mark class="highlight-red">based on the implementation</mark>
:
</p><div class="indented"><p>We don’t have to wait until the message was received but until the buffer is safe to use again.</p></div><p></p><p><mark class="highlight-red">Unsafe</mark>
programming.
</p></li></ol><p></p></details></li></ul></div><p></p><p></p><p><mark class="highlight-blue">Safe programming</mark></p><div class="indented"><p><mark class="highlight-teal">A) symmetry breaking (scheduling)</mark></p><div class="indented"><p>Problem: can lead to serialization, difficult with odd number of processes.</p></div><p></p></div><p></p><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%206.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%206.png" style="width: 192px"/></a></figure><p></p><div class="indented"><p><mark class="highlight-teal">B) using</mark><mark class="highlight-teal"><code>MPI_Sendrecv</code></mark><mark class="highlight-teal">to combine sending and receiving.</mark></p><div class="indented"><p>Performance advantage: utilitzes fully bidirectional communication network.</p><pre class="code"><code>MPI_Sendrecv(
// send
void *sendbuf, int sendcount, MPI_Datatype sendtype, int dest, int sendtag,
// receive
void *recvbuf, int recvcount, MPI_Datatype recvtype, int source, int recvtag,
MPI_Comm comm, MPI_Status *status
);</code></pre><ul class="toggle"><li><details open=""><summary>In depth</summary><p>Is equivalent to</p><pre class="code"><code>// immediate send
MPI_Request request;
MPI_Irecv(recvbuf,recvcount,recvtype,source,recvtag,comm,&amp;request);// receive (wait until received)
MPI_Send(sendbuf,sendcount,sendtype,dest,sendtag,comm);// wait (until sent message received)
MPI_Wait(&amp;request,status);</code></pre></details></li></ul><hr/><ul class="toggle"><li><details open=""><summary>Example: 1d-stencil (safe)</summary><p>
Arrays
<mark class="highlight-gray"><code>a</code></mark>
and
<mark class="highlight-gray"><code>b</code></mark>
distributed in blocks over MPI processes
</p><pre class="code"><code>for (i=n[j]; i&lt;n[j+1]; i++) {
b[i] = a[i-1]+a[i]+a[i+1];
}</code></pre><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%205.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%205.png" style="width: 240px"/></a></figure><p></p><pre class="code"><code>float *a = malloc((n/p+2)*sizeof(float));
a += 1; // offset, such that -1 and n/p can b addressed// step 1 [1; size-1]
if (rank&gt;0) {
MPI_Sendrecv(…,rank+1,…,rank-1,…);
}// step 2 [0; size-2]
if (rank&lt;size-1) {
MPI_Sendrecv(…,rank-1,…,rank+1,…);
}for (i=0; i&lt;n/p; i++) {
b[i] = a[i-1]+a[i]+a[i+1];
}</code></pre><p></p><p></p></details></li></ul><ul class="toggle"><li><details open=""><summary>Example: Hillis-Steele prefix sums algorithm (safe)</summary><p>
Round
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>k</mi></mstyle></mrow><annotation encoding="application/x-tex">\small k</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.624996em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.03148em">k</span></span></span></span></span><span>﻿</span></span>
, each process
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>i</mi></mstyle></mrow><annotation encoding="application/x-tex">\small i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.593568em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5">i</span></span></span></span></span><span>﻿</span></span>
:
</p><div class="indented"><ol class="numbered-list" start="1" type="1"><li>
receives partial sum from
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>i</mi><mo>−</mo><msup><mn>2</mn><mi>k</mi></msup></mstyle></mrow><annotation encoding="application/x-tex">\small i-2^k</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.668565em; vertical-align: -0.07499700000000001em"></span><span class="mord mathnormal sizing reset-size6 size5">i</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">−</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.7433639999999999em; vertical-align: 0em"></span><span class="mord sizing reset-size6 size5"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8259599999999999em"><span style="top: -2.963em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.03148em">
k
</span></span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span></li></ol><ol class="numbered-list" start="2" type="1"><li>
sends partial result to
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>i</mi><mo>+</mo><msup><mn>2</mn><mi>k</mi></msup></mstyle></mrow><annotation encoding="application/x-tex">\small i+2^k</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.668565em; vertical-align: -0.07499700000000001em"></span><span class="mord mathnormal sizing reset-size6 size5">i</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.7433639999999999em; vertical-align: 0em"></span><span class="mord sizing reset-size6 size5"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8259599999999999em"><span style="top: -2.963em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.03148em">
k
</span></span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span></li></ol></div><p></p><pre class="code"><code>MPI_Sendrecv(…, rank+2^k, …, rank-2^k, …);</code></pre><p></p></details></li></ul></div><p></p></div><p></p><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%207.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%207.png" style="width: 192px"/></a></figure><p></p><div class="indented"><p><mark class="highlight-teal">C) Immediate operations</mark><mark class="highlight-teal"><code>MPI_Isend</code></mark><mark class="highlight-teal">,</mark><mark class="highlight-teal"><code>MPI_Irecv</code></mark><mark class="highlight-teal">(nonblocking operations)</mark></p><div class="indented"><p>Immediate, non-blocking, local completion.</p><div class="indented"><p>Returns immediately (but initiates operation).</p><p>Can be used to prevent deadlocks and improve performance (overlapping communication with computation).</p></div><p></p><p><em>Sending</em></p><div class="indented"><pre class="code"><code>MPI_Isend(sendbuf,…,rank,tag,comm,request);</code></pre><p><mark class="highlight-gray"><code>sendbuf</code></mark>
can not be reused until completion has been checked.
</p><ul class="toggle"><li><details open=""><summary>In depth</summary><pre class="code"><code>MPI_Status status;
MPI_Request request;
MPI_Isend(sendbuf,…,comm,&amp;request);// check progress information
MPI_Test(&amp;request,flag,&amp;status);</code></pre><p>
If
<mark class="highlight-gray"><code>flag == 1</code></mark><mark class="highlight-gray"></mark>
then operation has completed.
</p><p></p><pre class="code"><code>MPI_Isend(sendbuf,…,comm,&amp;request);
MPI_Wait(&amp;request,&amp;status);</code></pre><p>
Is equivalent to
<mark class="highlight-gray"><code>MPI_Send();</code></mark></p><p></p></details></li></ul></div><p></p><p><em>Receiving</em></p><div class="indented"><pre class="code"><code>MPI_Irecv(recvbuf,…,rank,tag,comm,request);</code></pre><p>Messages are received after completion.</p></div><p></p><hr/><ul class="toggle"><li><details open=""><summary>Example: 2d, 5-point stencil algorithm (safe)</summary><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%208.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%208.png" style="width: 288px"/></a></figure></details></li></ul></div><p></p></div><p></p><p></p><p><mark class="highlight-blue">Test and completion calls</mark></p><div class="indented"><pre class="code"><code>MPI_Test(&amp;request,flag,&amp;status); // update status in flag (boolean)
MPI_Wait(&amp;request,&amp;status); // completion non-localMPI_Waitall(number,array_of_requests,array_of_statuses)
MPI_TestallMPI_Waitany
MPI_TestanyMPI_Waitsome
MPI_Testsome</code></pre></div><p></p><p></p><p></p><h1>Datatypes</h1><pre class="code"><code>basetype *sendbuf;
sendbuf = malloc(count*extent*sizeof(basetype));
MPI_Send(sendbuf,count,datatype,dest,tag,comm);</code></pre><p>Goal: Not communicating elements one after the other with multiple small messages but loading data into large consecutive buffer.</p><p></p><p><mark class="highlight-blue">Datatypes</mark></p><div class="indented"><p>Describe unit of communication.</p><div class="indented"><p>They have a size, extent (footprint), internal structure and order.</p><p>New types can also be derived.</p></div><p></p><pre class="code"><code>MPI_Type_get_extent(datatype,&amp;lb,&amp;extent); // difference between first and last byte
MPI_Type_size(datatype,&amp;bytes); // number of bytes occupied</code></pre><pre class="code"><code>MPI_Type_contiguous(count,basetype,&amp;newtype);
MPI_Type_vector(count,blocksize,stride,basetype,&amp;newtype);
MPI_Type_create_indexed_block(count,block,displs,basetype,&amp;newtype);
MPI_Type_indexed(count,blocks,displs,basetype,&amp;newtype);
MPI_Type_create_struct(count,blocks,displs,etypes,&amp;newtype); // complicated
...MPI_Type_commit(&amp;newtype); // sets newtype as new datatype</code></pre></div><p></p><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%209.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%209.png" style="width: 240px"/></a></figure><p></p><p></p><h1>One-sided communication</h1><p><mark class="highlight-blue">One-sided communication</mark></p><div class="indented"><p>Only one process is explicitly involved.</p></div><p></p><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2010.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2010.png" style="width: 132px"/></a></figure><p><mark class="highlight-blue">General properties</mark></p><div class="indented"><p>non-blocking, local-completion</p><p>data on target is exposed in communication-window and is addressed with “relative displacement”.</p></div><p></p><p></p><h2>Window, Epoch model</h2><p><mark class="highlight-blue">Communication window</mark></p><div class="indented"><p>global objects, memory processes accessed in one-sided communication.</p><p>The target address of origin and target must be different (to disallow race conditions).</p><pre class="code"><code>MPI_Win_create(
base, // given by communicator
size,
dispunit, // displacement unit
info, // special (key,value) that can influence properties -&gt; set MPI_INFO_NULL
comm, // communicator
&amp;win // address of window
);</code></pre></div><p></p><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2011.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2011.png" style="width: 120px"/></a></figure><p></p><p></p><h2>Origin, Target</h2><p><mark class="highlight-blue">Origin</mark></p><div class="indented"><p>Initiates communication, provides arguments (alone).</p><pre class="code"><code>MPI_Put(
obuf, // buffer
ocount,
otype,
target,
tdisp, // displacement = base + targetdispunit * targetdisp
tcount,
ttype,
win
);</code></pre></div><p></p><p><mark class="highlight-blue">Target</mark></p><div class="indented"><p>Not involved in communication.</p><pre class="code"><code>MPI_Get(
obuf,
ocount,
target,
tdisp,
tcount,
ttype,
win
);MPI_Accumulate( // atomic operation, concurrency allowed
obuf,ocount,
otype,
target,tdisp,tcount,ttype,
op,
win
);</code></pre></div><p></p><p><mark class="highlight-blue">Examples</mark></p><div class="indented"><ul class="toggle"><li><details open=""><summary>Example: Binary search</summary><pre class="code"><code>l = -1; // lower boundary
u = n; // upper boundarydo {
m = (l+u)/2; // half
if (x&lt;A[m]) {
u = m; // upper &lt;- half
} else {
l = m; // lower &lt;- half
}
} while (l+1&lt;u);i = l;</code></pre><p>
Value found in sorted array in
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>O</mi><mo stretchy="false">(</mo><msub><mrow><mi>log</mi><mo>⁡</mo></mrow><mn>2</mn></msub><mi>n</mi><mo stretchy="false">)</mo></mstyle></mrow><annotation encoding="application/x-tex">\small O( \log_2 n)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.909996em; vertical-align: -0.23499599999999998em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.02778em">O</span><span class="mopen sizing reset-size6 size5">(</span><span class="mop sizing reset-size6 size5"><span class="mop">
lo
<span style="margin-right: 0.01389em">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.16852em"><span style="top: -2.3388933333333335em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.26110666666666665em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size5">n</span><span class="mclose sizing reset-size6 size5">)</span></span></span></span></span><span>﻿</span></span>
steps.
</p><p><em><mark class="highlight-gray">Note: binary search can’t be sped up significantly by parallel processing.</mark></em></p><p></p><p>
Each process gets a block of size
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>n</mi><mi mathvariant="normal">/</mi><mi>p</mi></mstyle></mrow><annotation encoding="application/x-tex">\small n/p</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5">n</span><span class="mord sizing reset-size6 size5">/</span><span class="mord mathnormal sizing reset-size6 size5">p</span></span></span></span></span><span>﻿</span></span>
in
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>A</mi></mstyle></mrow><annotation encoding="application/x-tex">\small A</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.614997em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5">A</span></span></span></span></span><span>﻿</span></span>
.
</p><div class="indented"><p>All processes make their block accessible to others in communication window</p></div><p></p><pre class="code"><code>int p;
int r; // rank
MPI_Comm_size(comm,&amp;p);
MPI_Comm_rank(comm,&amp;r);// create window for other processes
A = (int*)malloc(n/p*sizeof(int));
… // init block (see later)
MPI_Win_create(A,(n/p)*sizeof(int),sizeof(int),MPI_INFO_NULL,comm,&amp;win);l = -1; // lower boundary
u = n; // upper boundary
mA; // equivalent of A[m] in this process' blockdo {
m = (l+u)/2; // halfMPI_Win_fence(MPI_NO_PRECEDE,win);
t = m/p; // target process
tix = m%p; // index at target
MPI_Get(&amp;mA,1,MPI_INT,t,tix,1,MPI_INT,win);
MPI_Win_fence(MPI_NO_SUCCEED,win);if (x&lt;mA) {
u = m; // upper &lt;- half
} else {
l = m; // lower &lt;- half
}
} while (l+1&lt;u);i = l;</code></pre><p>Alternatively, instead of fences one could use:</p><pre class="code"><code>MPI_Win_lock(MPI_LOCK_SHARED,t,0,win);
tix = m%p; // index at target
MPI_Get(&amp;mA,1,MPI_INT,t,tix,1,MPI_INT,win);
MPI_Win_unlock(t,win);</code></pre><p></p></details></li></ul><ul class="toggle"><li><details open=""><summary>Example: Merge</summary><p><mark class="highlight-gray"><code>merge(A,n,B,m,C)</code></mark></p><p>
Sorted arrays distributed in evenly sized blocks
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>n</mi><mi mathvariant="normal">/</mi><mi>p</mi></mstyle></mrow><annotation encoding="application/x-tex">\small n/p</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5">n</span><span class="mord sizing reset-size6 size5">/</span><span class="mord mathnormal sizing reset-size6 size5">p</span></span></span></span></span><span>﻿</span></span>
.
</p><div class="indented"><p>
Elements in process
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>r</mi></mstyle></mrow><annotation encoding="application/x-tex">\small r</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.387504em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.02778em">r</span></span></span></span></span><span>﻿</span></span>
are
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mo>≤</mo></mstyle></mrow><annotation encoding="application/x-tex">\small \leq</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.6947460000000001em; vertical-align: -0.12237300000000001em"></span><span class="mrel sizing reset-size6 size5">≤</span></span></span></span></span><span>﻿</span></span>
than process
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>r</mi><mo>+</mo><mn>1</mn></mstyle></mrow><annotation encoding="application/x-tex">\small r+1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.599994em; vertical-align: -0.07499700000000001em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.02778em">r</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.5799960000000001em; vertical-align: 0em"></span><span class="mord sizing reset-size6 size5">1</span></span></span></span></span><span>﻿</span></span>
.
</p><p>
Each process stores a block of
<mark class="highlight-gray"><code>C</code></mark><mark class="highlight-gray"></mark>
of size
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mo stretchy="false">(</mo><mi>n</mi><mo>+</mo><mi>m</mi><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mn>2</mn></mstyle></mrow><annotation encoding="application/x-tex">\small (n+m)/2</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mopen sizing reset-size6 size5">(</span><span class="mord mathnormal sizing reset-size6 size5">n</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5">m</span><span class="mclose sizing reset-size6 size5">)</span><span class="mord sizing reset-size6 size5">/2</span></span></span></span></span><span>﻿</span></span>
.
</p><p></p></div><p></p><p><em>Algorithm:</em></p><ol class="numbered-list" start="1" type="1"><li>
Use co-ranking algorithm.
<p>
All
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>p</mi></mstyle></mrow><annotation encoding="application/x-tex">\small p</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.5625em; vertical-align: -0.174996em"></span><span class="mord mathnormal sizing reset-size6 size5">p</span></span></span></span></span><span>﻿</span></span>
processes co-rank in parallel.
</p><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2012.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2012.png" style="width: 192px"/></a></figure></li></ol><ol class="numbered-list" start="2" type="1"><li>
Copy partial blocks into intermediate
<mark class="highlight-gray"><code>C’</code></mark>
array.
<p>One-sided communication (partial block can read elements from other processes).</p><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2013.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2013.png" style="width: 192px"/></a></figure></li></ol><ol class="numbered-list" start="3" type="1"><li>
Local sequential merge of
<mark class="highlight-gray"><code>C'</code></mark>
array into
<code><mark class="highlight-gray">C</mark></code><mark class="highlight-gray"></mark>
block.
</li></ol><p></p></details></li></ul></div><p></p><p></p><h2>Epoch model, synchronization</h2><p><mark class="highlight-blue">Epoch model</mark></p><div class="indented"><p>
Access epoch
<mark class="highlight-gray"></mark>
Origin has access to target
</p><p>Exposure epoch Target must expose memory</p><hr/><p>Open epoch start of access or exposure</p><p>Close epoch synchronization, communication operations become visible</p><p>End of epoch Access and exposure completed (data arrived at target)</p></div><p></p><p></p><p><mark class="highlight-blue">Synchronization in epochs</mark></p><div class="indented"><p><mark class="highlight-teal">Active (global) synchronization</mark></p><div class="indented"><p>Active global synchronization (involves origin and target).</p><div class="indented"><p>Closes previous epoch, opens a new one.</p></div><p></p><p>Collective operation, called by all processes in comm of win.</p><pre class="code"><code>MPI_Win_fence(assert,win);</code></pre><ul class="toggle"><li><details open=""><summary>Example</summary><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2014.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2014.png" style="width: 240px"/></a></figure><p></p></details></li></ul></div><p></p><p><mark class="highlight-teal">Active (dedicated) synchronization</mark></p><div class="indented"><p>Active global synchronization (involves origin and target).</p><p>Pairwise synchronization.</p><pre class="code"><code>// open/close access epoch (targets)
MPI_Win_start(…,group);
MPI_Win_complete();// open/close exposure epoch (origin)
MPI_Win_post(…,group);
MPI_Win_wait();</code></pre><ul class="toggle"><li><details open=""><summary>Example</summary><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2015.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2015.png" style="width: 288px"/></a></figure><p></p></details></li></ul></div><p></p><p><mark class="highlight-teal">Passive synchronization</mark></p><div class="indented"><p>Only origin process involved.</p><p>Not a lock (critical section)</p><div class="indented"><p>difficult to use for mutual exclusion, weak mechanism</p></div><p></p><pre class="code"><code>// open/close exposure epoch (origin)
MPI_Win_lock(locktype,target,assertion,win);
MPI_Win_unlock(target,win);</code></pre></div><p></p></div><p></p><p></p><p></p><h1>Collective communication</h1><figure class="block-color-gray_background callout" style="white-space: pre-wrap; display: flex"><div style="font-size: 1.5em"><span class="icon">💡</span></div><div style="width: 100%">Collectives should be used whenever possible! (better conciseness, performance)</div></figure><p></p><p><mark class="highlight-blue">Collective communication</mark></p><div class="indented"><p>
Collective operations = all processes in
<em>comm</em>
must call given function (all are explicitly involved and must call the same collective communication operation).
</p><p>
Requirements: If a process calls collective operation on
<em>comm</em>
then all other included processes
<span style="border-bottom: 0.05em solid">must also call the same operation</span>
and
</p><div class="indented"><ul class="bulleted-list"><li style="list-style-type: disc">no other collective in between</li></ul><ul class="bulleted-list"><li style="list-style-type: disc">same root (else it deadlocks)</li></ul><ul class="bulleted-list"><li style="list-style-type: disc">consistent arguments (same size and types)</li></ul></div><p></p></div><p></p><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2016.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2016.png" style="width: 144px"/></a></figure><p></p><p><mark class="highlight-blue">General properties</mark></p><div class="indented"><p>Collective operations are:</p><div class="indented"><ul class="bulleted-list"><li style="list-style-type: disc">safe won’t interfere with one another</li></ul><ul class="bulleted-list"><li style="list-style-type: disc">blocking completion is non-local and must be fully completed to return</li></ul><ul class="bulleted-list"><li style="list-style-type: disc">
not synchronizing any process can return independent of other processes
<p><mark class="highlight-gray">(except</mark><mark class="highlight-gray"><code>MPI_Barrier(&amp;com)</code></mark><mark class="highlight-gray">)</mark></p></li></ul></div><p></p><hr/><ul class="toggle"><li><details open=""><summary>
Example:
<mark class="highlight-gray"><code>MPI_Bcast</code></mark></summary><p><mark class="highlight-gray"><code>Bcast</code></mark><mark class="highlight-gray">sends data from root → all.</mark></p><ul class="bulleted-list"><li style="list-style-type: disc">
blocking
<p>root: doesn’t return untill data has left buffer</p><p>non-root: doesn’t return until data has been received in buffer</p></li></ul><ul class="bulleted-list"><li style="list-style-type: disc">
not synchronizing
<p>any process can return independent of other processes</p><p></p></li></ul></details></li></ul><ul class="toggle"><li><details open=""><summary>Example: Safe vs. Unsafe</summary><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2017.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2017.png" style="width: 288px"/></a></figure><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2018.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2018.png" style="width: 288px"/></a></figure><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2019.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2019.png" style="width: 288px"/></a><figcaption>
look at
<mark class="highlight-gray"><code>comm1</code></mark><mark class="highlight-gray"></mark>
/
<mark class="highlight-gray"><code>comm2</code></mark><mark class="highlight-gray"></mark>
argument
</figcaption></figure><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2020.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2020.png" style="width: 288px"/></a><figcaption>
look at
<mark class="highlight-gray"><code>comm1</code></mark><mark class="highlight-gray"></mark>
/
<mark class="highlight-gray"><code>comm2</code></mark><mark class="highlight-gray"></mark>
argument
</figcaption></figure><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2021.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2021.png" style="width: 288px"/></a></figure><p></p></details></li></ul></div><p></p><p></p><p><mark class="highlight-blue">Symmetric vs. Non-symmetric</mark></p><div class="indented"><p>Symmetric = All processes have the same role</p><p>Non-symmetric = Some process (ie. root) is special</p></div><p></p><p></p><p><mark class="highlight-blue">Regular vs. irregular</mark></p><div class="indented"><p>Regular = All processes exchange (send/receive) the same amount of data (segments with the same size and data type)</p><p>
Irregular, vector, v-collective = Some pairs exchange (send/receive) different amounts of data (different data-types: different sizes,
displacements relative to start address).
</p><div class="indented"><p>
Examples:
<mark class="highlight-gray"><code>MPI_Gatherv</code></mark>
,
<mark class="highlight-gray"><code>MPI_Scatterv</code></mark>
,
<mark class="highlight-gray"><code>MPI_Allgatherv</code></mark>
,
<mark class="highlight-gray"><code>MPI_Alltoallv</code></mark>
,
<mark class="highlight-gray"><code>MPI_Alltoallw</code></mark></p></div><p></p></div><p></p><p></p><p><mark class="highlight-blue">Differences with point-to-point communication</mark></p><div class="indented"><ul class="bulleted-list"><li style="list-style-type: disc">
No
<mark class="highlight-gray"><code>tag</code></mark><mark class="highlight-gray"></mark>
argument
</li></ul><ul class="bulleted-list"><li style="list-style-type: disc">Amount of data for sender and receiver must be equal</li></ul><ul class="bulleted-list"><li style="list-style-type: disc">
Buffers of size 0 don’t have to be sent
<ul class="toggle"><li><details open=""><summary>
Example: Implementing
<mark class="highlight-gray"><code>no-op</code></mark><mark class="highlight-gray"></mark>
with collective operations
</summary><p>“Nothing broadcast”</p><pre class="code"><code>MPI_Bcast(buffer,0,MPI_CHAR,…,root,comm);</code></pre><pre class="code"><code>MPI_Bcast(buffer,0,MPI_CHAR,…,root,comm);</code></pre></details></li></ul><ul class="toggle"><li><details open=""><summary>
Example: Implementing
<mark class="highlight-gray"><code>no-op</code></mark><mark class="highlight-gray"></mark>
with
<mark class="highlight-gray"><code>Send</code></mark>
and
<mark class="highlight-gray"><code>Recv</code></mark></summary><pre class="code"><code>MPI_Send(buffer,0,MPI_CHAR,j,TAG,comm);</code></pre><pre class="code"><code>MPI_Recv(buffer,10,MPI_CHAR,j,TAG,comm,&amp;status); // size can be larger</code></pre></details></li></ul></li></ul></div><p></p><p></p><h2>Overview</h2><p><mark class="highlight-blue">Collective patterns, operations in MPI</mark></p><div class="indented"><p><mark class="highlight-teal">Distributing data</mark></p><div class="indented"><p><mark class="highlight-gray"><code>MPI_Bcast</code></mark>
: root → all
</p><div class="indented"><p><mark class="highlight-gray"><code>MPI_Scatter</code></mark>
: root → all (
<em>personalized</em>
data)
</p><p><mark class="highlight-gray"><code>MPI_Gather</code></mark>
: all → root
</p></div><p></p><p><mark class="highlight-gray"><code>MPI_Alltoall</code></mark>
: all → all, “transpose” (
<em>personalized</em>
data)
</p><p><mark class="highlight-gray"><code>MPI_Allgather</code></mark>
: all → all, “transpose”
</p></div><p></p><p></p><p><mark class="highlight-teal">Applying associative function (ie. “+”) to data from each process</mark></p><div class="indented"><p><mark class="highlight-gray"><code>MPI_Reduce</code></mark>
: result at root
</p><p><mark class="highlight-gray"><code>MPI_Allreduce</code></mark>
: result to all
</p><p><mark class="highlight-gray"><code>MPI_Reduce_scatter</code></mark>
: result scattered/distributed
</p><p><mark class="highlight-gray"><code>MPI_Scan</code></mark>
: prefix-sums
</p></div><p></p><p></p><p><mark class="highlight-teal">Synchronization</mark></p><div class="indented"><p><mark class="highlight-gray"><code>MPI_Barrier</code></mark>
: (semantic) Synchronization
</p></div><p></p></div><p></p><p></p><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2022.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2022.png" style="width: 120px"/></a></figure><p></p><h2>Operations</h2><p><mark class="highlight-blue">Duplicating communicators</mark></p><div class="indented"><p>Duplicates communicator: Same processes, but also copied to different comms.</p><pre class="code"><code>MPI_Comm_dup(comm, &amp;comm1);</code></pre><p><mark class="highlight-gray"><code>comm</code></mark><mark class="highlight-gray"></mark>
can not interfere with
<mark class="highlight-gray"><code>comm1</code></mark></p><hr/><ul class="toggle"><li><details open=""><summary>Example: Usage in libraries</summary><p>
Good practice when writing libraries: here the library uses
<mark class="highlight-gray"><code>libcomm</code></mark><mark class="highlight-gray"></mark>
and there is no interference.
</p><pre class="code"><code>int my_library_init(comm, &amp;libcomm) {
MPI_Comm_dup(comm, &amp;libcomm); // store somewhere
...
}</code></pre></details></li></ul></div><p></p><p></p><p><mark class="highlight-blue">Splitting communicators</mark></p><div class="indented"><p>Partition processes into disjoint sets with independent comms.</p><pre class="code"><code>MPI_Comm_split(comm1,color,key,&amp;comm2);
MPI_Comm_create(comm1,group,&amp;comm2);</code></pre><p>
color defines subset in
<mark class="highlight-gray"><code>comm2</code></mark></p><p>
key defines relative order in
<mark class="highlight-gray"><code>comm2</code></mark><mark class="highlight-gray">(for each color)</mark></p><p>
group
<mark class="highlight-gray"><code>MPI_Group</code></mark><mark class="highlight-gray"></mark>
of ordered processes
</p><hr/><ul class="toggle"><li><details open=""><summary>Example: Even-odd split</summary><p>Used in divide and conquer algorithms.</p><pre class="code"><code>MPI_Comm_rank(comm1,&amp;rank); // get rank in comm1int color = rank%2;
int key = 0;
MPI_Comm_split(comm1,color,key,&amp;comm2); // split by color// find process' new rank in comm2
MPI_Comm_size(comm2,&amp;newsize);
MPI_Comm_rank(comm2,&amp;newrank);</code></pre><p>
if rank even:
<mark class="highlight-gray"><code>color == 0</code></mark><mark class="highlight-gray"></mark>
in
<mark class="highlight-gray"></mark><code><mark class="highlight-gray">comm2</mark></code></p><p>
if rank odd:
<mark class="highlight-gray"><code>color == 1</code></mark><mark class="highlight-gray"></mark>
in
<mark class="highlight-gray"></mark><code><mark class="highlight-gray">comm2</mark></code></p><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2023.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2023.png" style="width: 192px"/></a></figure><p></p></details></li></ul><ul class="toggle"><li><details open=""><summary>Example: Master-worker pattern (non-scalable)</summary><p>master gives workers their work, receives result</p><p>worker synchronize independently of master</p><hr/><p>
If workers use
<mark class="highlight-gray"><code>MPI_Barrier(comm)</code></mark>
,
<mark class="highlight-gray"><code>MPI_Allgather(comm)</code></mark>
and master is doing something else it causes a deadlock. Therefore they have to use the split communicator (only for
workers).
</p><p></p><p>A) Splitting</p><div class="indented"><pre class="code"><code>int color = (rank&gt;0 ? 1 : 0);
int key = 0;
MPI_Comm_split(comm,color,key,&amp;workers);
// workers for rank&gt;0 in comm: all workers
// workers for rank==0 in comm: only master</code></pre><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2024.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2024.png" style="width: 240px"/></a></figure></div><p></p><p></p><p>B) Processing groups</p><div class="indented"><pre class="code"><code>MPI_Comm_group(comm,&amp;group); // get processes in comm// exclude rank 0
ranklist[0] = 0;
MPI_Group_excl(group,1,ranklist,&amp;workgroup); // group operationMPI_Comm_create(comm,workgroup,&amp;workers);
// rank 0 (in comm) not in workers
// workers==MPI_COMM_NULL for rank 0 in comm</code></pre><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2025.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2025.png" style="width: 240px"/></a></figure></div><p></p><p></p><p></p></details></li></ul></div><p></p><p></p><p><mark class="highlight-blue">Barrier</mark></p><div class="indented"><p>
(Is the only
<em>synchronizing</em>
operator)
</p><pre class="code"><code>MPI_Barrier(comm);</code></pre><p>
Calling process waits for all other processes in
<mark class="highlight-gray"><code>comm</code></mark><mark class="highlight-gray"></mark>
to enter barrier and can only return when they have done so.
</p><p>
Explicit
<mark class="highlight-gray"><code>MPI_Barrier</code></mark><mark class="highlight-gray"></mark>
calls should never be needed for correctness of MPI programs (there is always a way to program without them).
</p><hr/><ul class="toggle"><li><details open=""><summary>Example: Timing a function</summary><pre class="code"><code>MPI_Barrier(comm); // processes hopefully now synchronizeddouble start = MPI_Wtime();
&lt;something to be timed&gt;
double stop = MPI_Wtime();double local_time = stop-start;
double spent_time; // time for slowest process
MPI_Allreduce(&amp;local_time,&amp;spent_time,1,MPI_DOUBLE,MPI_MAX,comm);</code></pre></details></li></ul></div><p></p><p></p><p><mark class="highlight-blue">Bcast</mark></p><div class="indented"><p>distributes data: root → all</p><pre class="code"><code>MPI_Bcast(buffer,count,datatype,root,comm); // root stays the same for all</code></pre><p>Root sends data to all other non-root processes.</p><p>Any process can be the root.</p><hr/><ul class="toggle"><li><details open=""><summary>Example: Different sizes (unsafe)</summary><pre class="code"><code>int matrixdims[3]; // 3 dimensional matrixif (rank==0) {
MPI_Bcast(matrixdims,3,MPI_INT,0,comm); // different sizes: 3
} else {
MPI_Bcast(matrixdims,2,MPI_INT,0,comm); // different sizes: 2
}</code></pre><p>The implementation above probably works, but it’s unsafe</p></details></li></ul></div><p></p><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2026.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2026.png" style="width: 192px"/></a></figure><p></p><p><mark class="highlight-blue">Gather</mark></p><div class="indented"><p>gathers data: all → root</p><pre class="code"><code>MPI_Gather(
sbuf,scount,stype, // sender
rbuf,rcount,rtype, // receiver
root,comm
);</code></pre><ul class="toggle"><li><details open=""><summary>Alternative</summary><p>The implementation is much more efficient.</p><pre class="code"><code>// root
if (rank==root) {
// receive from others
for (…i!=root…) {
MPI_Recv(rbuf+i*rcount*extent(rtype),rcount,rtype,i,GATTAG,comm,MPI_STATUS_IGNORE);
}
// send and receive from self
MPI_Sendrecv(
sbuf,…,root,…,
rbuf+root*rcount*extent(rtype),…,root,…
);// others
} else {
// send
MPI_Send(sbuf,scount,stype,root,GATTAG,comm);
}</code></pre><p></p></details></li></ul><p>
Each process contributes to block of data at buffer
<mark class="highlight-gray"><code>rbuf</code></mark><mark class="highlight-gray"></mark>
in root:
</p><div class="indented"><p>
block from process
<mark class="highlight-gray"><code>i</code></mark>
stored at:
<mark class="highlight-gray"><code>rbuf+i*rcount*extent(rtype)</code></mark></p><p>where:</p><div class="indented"><ul class="bulleted-list"><li style="list-style-type: disc"><mark class="highlight-gray"><code>rcount</code></mark><mark class="highlight-gray"></mark>
is count of one block, not the whole
<mark class="highlight-gray"><code>rbuf</code></mark></li></ul><ul class="bulleted-list"><li style="list-style-type: disc"><mark class="highlight-gray"><code>extent(rtype)</code></mark>
is the size in bytes spanned by MPI types
<p>
ie.
<mark class="highlight-gray"><code>extent(MPI_INT) == sizeof(int)</code></mark></p></li></ul></div><p></p></div><p></p><p>Root also gathers from itself.</p><div class="indented"><p>
can be prevented with
<mark class="highlight-gray"><code>MPI_IN_PLACE</code></mark>
argument for
<mark class="highlight-gray"><code>sbuf</code></mark>
.
</p><p>this means: result from root is already in place</p></div><p></p></div><p></p><div class="column-list"><div class="column" style="width: 50%"><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2027.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2027.png" style="width: 240px"/></a></figure></div><div class="column" style="width: 50%"><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2028.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2028.png" style="width: 240px"/></a></figure></div></div><p></p><p><mark class="highlight-blue">Scatter</mark></p><div class="indented"><p>distributes data: root → all (but processes get different blocks)</p><pre class="code"><code>MPI_Scatter(
sbuf,scount,stype, // send
rbuf,rcount,rtype, // receive
root,comm
);</code></pre><p>Root sends different block from its buffer to each process.</p><div class="indented"><p>
Blocks stored in rank order at root:
<mark class="highlight-gray"><code>sbuf+i*scount*extent(stype)</code></mark></p></div><p></p><p>Root also scatters to itself:</p><div class="indented"><p>
can be prevented with
<mark class="highlight-gray"><code>MPI_IN_PLACE</code></mark>
argument for
<mark class="highlight-gray"><code>sbuf</code></mark>
.
</p><p>this means: result from root is already in place.</p></div><p></p><hr/><ul class="toggle"><li><details open=""><summary>Example: Scatter-Gather pattern</summary><p>
Distribute data with
<mark class="highlight-gray"><code>MPI_Scatter(A,...)</code></mark>
of size
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>n</mi><mi mathvariant="normal">/</mi><mi>p</mi></mstyle></mrow><annotation encoding="application/x-tex">\small n/p</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5">n</span><span class="mord sizing reset-size6 size5">/</span><span class="mord mathnormal sizing reset-size6 size5">p</span></span></span></span></span><span>﻿</span></span>
, then collect results with
<mark class="highlight-gray"><code>MPI_Gather(B,...)</code></mark>
.
</p><pre class="code"><code>int root = 0;
MPI_Comm_size(comm,&amp;p);
MPI_Comm_rank(comm,&amp;r);
assert(n%p==0); // else use MPI_Scatterv (irregular collective)// allocate a,c and initialize a with values
if (rank==root) {
int *a = (int*)malloc(n*sizeof(int)); // a: root -&gt; all
int *c = (int*)malloc(n*sizeof(int)); // c: root &lt;- all
for (i=0; i&lt;n; i++) a[i] = &lt;init&gt;;
}// allocate b
int *b = (int*)malloc((n/p)*sizeof(int)); // a -&gt; b block -&gt; cMPI_Scatter( // root: a -&gt; b
a,n/p,MPI_INT,
b,n/p,MPI_INT,
root,comm
);
... // compute on b: all processes
MPI_Gather( // root: b -&gt; c
b,n/p,MPI_INT,
c,n/p,MPI_INT,
root,comm
);</code></pre><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2029.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2029.png" style="width: 192px"/></a></figure><p></p></details></li></ul><ul class="toggle"><li><details open=""><summary>Example: barrier (unsafe)</summary><p>
May have better performance than
<mark class="highlight-gray"><code>send-recv</code></mark><mark class="highlight-gray"></mark>
since we don’t actually send empty messages (but it depends on the implementation → unsafe)
</p><pre class="code"><code>MPI_Gather(NULL,0,MPI_BYTE,NULL,0,MPI_BYTE,0,comm);
MPI_Scatter(NULL,0,MPI_BYTE,NULL,0,MPI_BYTE,0,comm);</code></pre></details></li></ul></div><p></p><div class="column-list"><div class="column" style="width: 50%"><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2030.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2030.png" style="width: 240px"/></a></figure></div><div class="column" style="width: 50%"><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2031.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2031.png" style="width: 240px"/></a></figure></div></div><p></p><p><mark class="highlight-blue">Allgather</mark></p><div class="indented"><pre class="code"><code>MPI_Allgather(
sbuf,scount,stype, // send
rbuf,rcount,rtype, // receive
comm
);</code></pre><ul class="toggle"><li><details open=""><summary>Alternative</summary><pre class="code"><code>MPI_Gather(sbuf,…,rbuf,…,0,comm);
MPI_Bcast(rbuf,size*rcount,rtype,…,0,comm);</code></pre><pre class="code"><code>for (i) { // all-to-all broadcast
if (i==rank) MPI_Bcast(sbuf,…,i,comm);
else MPI_Bcast(rbuf+i*rcount*extent(rtype),…,i,comm);
}
memcpy(rbuf+rank*rcount*extent(rtype),sbuf,…);</code></pre><p>but performance of library is much better-</p><p>
It always performs better than
<mark class="highlight-gray"><code>Gather</code></mark>
+
<mark class="highlight-gray"><code>Bcast</code></mark>
.
</p><p></p></details></li></ul><p>
Each process sends block to
<mark class="highlight-gray"><code>rbuf</code></mark><mark class="highlight-gray"></mark>
of all other processes.
</p><div class="indented"><p>
Ends up storing other blocks aswell in order
<mark class="highlight-gray"><code>rbuf+i*rcount*extent(rtype)</code></mark></p></div><p></p><p>
Process also sends block to itself: can be prevented with
<mark class="highlight-gray"><code>MPI_IN_PLACE</code></mark>
argument for
<mark class="highlight-gray"><code>sbuf</code></mark>
(must be set for all processes).
</p><p>Data gets “transposed” (see graphics below).</p><hr/><figure class="link-to-page"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Matrix-Vector%20multiplication%206b87a0f032e948739a0094a064dc675e.html"><span class="icon">📎</span>
Matrix-Vector multiplication
</a></figure><figure class="link-to-page"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Matrix-Matrix%20multiplication%208b568b4aee7449d691cc2914b415905e.html"><span class="icon">📎</span>
Matrix-Matrix multiplication
</a></figure></div><p></p><div class="column-list"><div class="column" style="width: 50%"><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2032.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2032.png" style="width: 240px"/></a></figure></div><div class="column" style="width: 50%"><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2033.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2033.png" style="width: 240px"/></a></figure></div></div><p></p><p><mark class="highlight-blue">Alltoall</mark></p><div class="indented"><p>
Same as
<mark class="highlight-gray"><code>Allgather</code></mark>
but blocks sent are different for each process.
</p><pre class="code"><code>MPI_Alltoall(
sbuf,scount,stype, // send
rbuf,rcount,rtype, // receive
comm
);</code></pre><p>Data gets “transposed” (see graphics below).</p><p>Each processor contributes to different block of data in other processes.</p><div class="indented"><p>
Block
<em>to</em>
process
<mark class="highlight-gray"><code>i</code></mark><mark class="highlight-gray"></mark>
is stored at:
<mark class="highlight-gray"><code>sbuf+i*scount*extent(stype)</code></mark></p><p>
Block
<em>from</em>
process
<mark class="highlight-gray"><code>i</code></mark><mark class="highlight-gray"></mark>
is stored at:
<mark class="highlight-gray"><code>rbuf+i*rcount*extent(rtype)</code></mark></p></div><p></p></div><p></p><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2034.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2034.png" style="width: 144px"/></a></figure><p></p><p><mark class="highlight-blue">Gatherv</mark></p><div class="indented"><p>Same as gather but with irregular data.</p><pre class="code"><code>MPI_Gatherv(
sbuf,scount,stype, // send
rbuf,rcount,rdisp,rtype, // receive (address, count, displacement, type)
root,comm
)</code></pre><p>Data must not overlap.</p><p>
Block from process
<mark class="highlight-gray"><code>i</code></mark><mark class="highlight-gray"></mark>
is stored at:
<mark class="highlight-gray"><code>rbuf+disp[i]*extent(rtype)</code></mark></p><hr/><ul class="toggle"><li><details open=""><summary>Example: Root gathers initially unknown amount of data from all processes</summary><p><mark class="highlight-gray"><code>scount</code></mark>
and
<mark class="highlight-gray"><code>rcounts[i]</code></mark>
must match.
</p><div class="indented"><p>
Won’t work if root doesn’t know
<mark class="highlight-gray"><code>scount</code></mark>
of other processes.
</p></div><p></p><pre class="code"><code>if (rank==root) {
MPI_Gatherv(sbuf,…rbuf,rcounts,rdisp,…,comm); // rcounts as array
} else {
MPI_Gatherv(sbuf,scount,…,comm); // scount
}</code></pre><p></p><p>
Here we use regular gather to gather the
<mark class="highlight-gray"><code>rcounts</code></mark>
array from all processes.
</p><pre class="code"><code>if (rank==root) {
MPI_Gather(scount,1,MPI_INT,rcounts,1,MPI_INT,comm);
// compute displacements
MPI_Gatherv(sbuf,…rbuf,rcounts,rdisp,…,comm);
} else {
MPI_Gather(scount,1,MPI_INT,rcounts,1,MPI_INT,comm);
MPI_Gatherv(sbuf,scount,…,comm);
}</code></pre></details></li></ul></div><p></p><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2035.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2035.png" style="width: 192px"/></a></figure><p></p><h2>Reduction collectives</h2><p><em><mark class="highlight-blue">About reduction collectives</mark></em></p><div class="indented"><ul class="bulleted-list"><li style="list-style-type: disc">
Each process has vector of data
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mover accent="true"><mi>x</mi><mo>⃗</mo></mover></mstyle></mrow><annotation encoding="application/x-tex">\small \vec x</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.6426em; vertical-align: 0em"></span><span class="mord accent sizing reset-size6 size5"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.714em"><span style="top: -2.9em"><span class="pstrut" style="height: 2.9em"></span><span class="mord mathnormal">x</span></span><span style="top: -2.9em"><span class="pstrut" style="height: 2.9em"></span><span class="accent-body" style="left: -0.20772em"><span class="overlay" style="height: 0.714em; width: 0.471em"><svg height="0.714em" preserveaspectratio="xMinYMin" style="width: 0.471em" viewbox="0 0 471 714" width="0.471em"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>
(same size, same type)
</li></ul><ul class="bulleted-list"><li style="list-style-type: disc">
Associative operation
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mo>+</mo></mstyle></mrow><annotation encoding="application/x-tex">\small +</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.599994em; vertical-align: -0.07499700000000001em"></span><span class="mord sizing reset-size6 size5">+</span></span></span></span></span><span>﻿</span></span>
(built in MPI or user defined)
<p>
for element wise reduction
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mover accent="true"><mi>y</mi><mo>⃗</mo></mover><mo>=</mo><msub><mover accent="true"><mi>x</mi><mo>⃗</mo></mover><mn>0</mn></msub><mo>+</mo><msub><mover accent="true"><mi>x</mi><mo>⃗</mo></mover><mn>1</mn></msub><mo>+</mo><msub><mover accent="true"><mi>x</mi><mo>⃗</mo></mover><mn>2</mn></msub><mo>+</mo><mo>…</mo><mo>+</mo><msub><mover accent="true"><mi>x</mi><mo>⃗</mo></mover><mrow><mi>p</mi><mo>−</mo><mn>1</mn></mrow></msub></mstyle></mrow><annotation encoding="application/x-tex">
\small \vec y = \vec x_0+\vec x_1+\vec x_2+ … +\vec x_{p-1}
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.817596em; vertical-align: -0.174996em"></span><span class="mord accent sizing reset-size6 size5"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.714em"><span style="top: -2.9em"><span class="pstrut" style="height: 2.9em"></span><span class="mord mathnormal" style="margin-right: 0.03588em">y</span></span><span style="top: -2.9em"><span class="pstrut" style="height: 2.9em"></span><span class="accent-body" style="left: -0.17994em"><span class="overlay" style="height: 0.714em; width: 0.471em"><svg height="0.714em" preserveaspectratio="xMinYMin" style="width: 0.471em" viewbox="0 0 471 714" width="0.471em"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em"><span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2777777777777778em"></span><span class="mrel sizing reset-size6 size5">=</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height: 0.7776em; vertical-align: -0.135em"></span><span class="mord sizing reset-size6 size5"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.714em"><span style="top: -2.9em"><span class="pstrut" style="height: 2.9em"></span><span class="mord mathnormal">x</span></span><span style="top: -2.9em"><span class="pstrut" style="height: 2.9em"></span><span class="accent-body" style="left: -0.20772em"><span class="overlay" style="height: 0.714em; width: 0.471em"><svg height="0.714em" preserveaspectratio="xMinYMin" style="width: 0.471em" viewbox="0 0 471 714" width="0.471em"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.7776em; vertical-align: -0.135em"></span><span class="mord sizing reset-size6 size5"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.714em"><span style="top: -2.9em"><span class="pstrut" style="height: 2.9em"></span><span class="mord mathnormal">x</span></span><span style="top: -2.9em"><span class="pstrut" style="height: 2.9em"></span><span class="accent-body" style="left: -0.20772em"><span class="overlay" style="height: 0.714em; width: 0.471em"><svg height="0.714em" preserveaspectratio="xMinYMin" style="width: 0.471em" viewbox="0 0 471 714" width="0.471em"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.7776em; vertical-align: -0.135em"></span><span class="mord sizing reset-size6 size5"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.714em"><span style="top: -2.9em"><span class="pstrut" style="height: 2.9em"></span><span class="mord mathnormal">x</span></span><span style="top: -2.9em"><span class="pstrut" style="height: 2.9em"></span><span class="accent-body" style="left: -0.20772em"><span class="overlay" style="height: 0.714em; width: 0.471em"><svg height="0.714em" preserveaspectratio="xMinYMin" style="width: 0.471em" viewbox="0 0 471 714" width="0.471em"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.599994em; vertical-align: -0.07499700000000001em"></span><span class="minner sizing reset-size6 size5">…</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.894264em; vertical-align: -0.25166400000000005em"></span><span class="mord sizing reset-size6 size5"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.714em"><span style="top: -2.9em"><span class="pstrut" style="height: 2.9em"></span><span class="mord mathnormal">x</span></span><span style="top: -2.9em"><span class="pstrut" style="height: 2.9em"></span><span class="accent-body" style="left: -0.20772em"><span class="overlay" style="height: 0.714em; width: 0.471em"><svg height="0.714em" preserveaspectratio="xMinYMin" style="width: 0.471em" viewbox="0 0 471 714" width="0.471em"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span></p><p><mark class="highlight-gray"><em>associative means brackets don’t influence result</em></mark><mark class="highlight-gray"><em><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mo stretchy="false">(</mo><mi>a</mi><mo>+</mo><mi>b</mi><mo stretchy="false">)</mo><mo>+</mo><mi>c</mi><mo>=</mo><mi>a</mi><mo>+</mo><mo stretchy="false">(</mo><mi>b</mi><mo>+</mo><mi>c</mi><mo stretchy="false">)</mo></mstyle></mrow><annotation encoding="application/x-tex">\small (a + b) + c = a + (b + c)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mopen sizing reset-size6 size5">(</span><span class="mord mathnormal sizing reset-size6 size5">a</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5">b</span><span class="mclose sizing reset-size6 size5">)</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.387504em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5">c</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span><span class="mrel sizing reset-size6 size5">=</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height: 0.599994em; vertical-align: -0.07499700000000001em"></span><span class="mord mathnormal sizing reset-size6 size5">a</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mopen sizing reset-size6 size5">(</span><span class="mord mathnormal sizing reset-size6 size5">b</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5">c</span><span class="mclose sizing reset-size6 size5">)</span></span></span></span></span><span>﻿</span></span></em></mark></p><p><mark class="highlight-gray"><em>commutativity can also be exploited</em></mark><mark class="highlight-gray"><em><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>a</mi><mo>⋅</mo><mi>b</mi><mo>=</mo><mi>b</mi><mo>⋅</mo><mi>a</mi></mstyle></mrow><annotation encoding="application/x-tex">\small a \cdot b = b \cdot a</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.400005em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5">a</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">⋅</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.624996em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5">b</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span><span class="mrel sizing reset-size6 size5">=</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height: 0.624996em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5">b</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">⋅</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.387504em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5">a</span></span></span></span></span><span>﻿</span></span></em></mark></p></li></ul><ul class="bulleted-list"><li style="list-style-type: disc">
stored in
<p><mark class="highlight-gray"><code>MPI_Reduce</code></mark><mark class="highlight-gray"></mark>
root
</p><p><mark class="highlight-gray"><code>MPI_Allreduce</code></mark>
all processes
</p><p><mark class="highlight-gray"><code>MPI_Allreduce</code></mark>
scattered in blocks
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mover accent="true"><mi>y</mi><mo>⃗</mo></mover><mn>0</mn></msub><mo separator="true">,</mo><msub><mover accent="true"><mi>y</mi><mo>⃗</mo></mover><mn>1</mn></msub><mo separator="true">,</mo><mo>…</mo></mstyle></mrow><annotation encoding="application/x-tex">\small \vec y_0,\vec y_1, \dots</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.817596em; vertical-align: -0.174996em"></span><span class="mord sizing reset-size6 size5"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.714em"><span style="top: -2.9em"><span class="pstrut" style="height: 2.9em"></span><span class="mord mathnormal" style="margin-right: 0.03588em">y</span></span><span style="top: -2.9em"><span class="pstrut" style="height: 2.9em"></span><span class="accent-body" style="left: -0.17994em"><span class="overlay" style="height: 0.714em; width: 0.471em"><svg height="0.714em" preserveaspectratio="xMinYMin" style="width: 0.471em" viewbox="0 0 471 714" width="0.471em"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em"><span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: -0.03588em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span><span class="mpunct sizing reset-size6 size5">,</span><span class="mspace" style="margin-right: 0.16666666666666666em"></span><span class="mord sizing reset-size6 size5"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.714em"><span style="top: -2.9em"><span class="pstrut" style="height: 2.9em"></span><span class="mord mathnormal" style="margin-right: 0.03588em">y</span></span><span style="top: -2.9em"><span class="pstrut" style="height: 2.9em"></span><span class="accent-body" style="left: -0.17994em"><span class="overlay" style="height: 0.714em; width: 0.471em"><svg height="0.714em" preserveaspectratio="xMinYMin" style="width: 0.471em" viewbox="0 0 471 714" width="0.471em"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em"><span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: -0.03588em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span><span class="mpunct sizing reset-size6 size5">,</span><span class="mspace" style="margin-right: 0.16666666666666666em"></span><span class="minner sizing reset-size6 size5">…</span></span></span></span></span><span>﻿</span></span></p></li></ul></div><p></p><p></p><p><em><mark class="highlight-blue">Operators</mark></em></p><div class="indented"><p>One can also register user defined operators</p><pre class="code"><code>MPI_Op_create(MPI_User_function *function, int commutative, MPI_Op *op);
MPI_Op_free(MPI_Op *op); // free after usage</code></pre></div><p></p><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2036.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2036.png" style="width: 240px"/></a></figure><p></p><p><mark class="highlight-blue">Reduce</mark></p><div class="indented"><pre class="code"><code>MPI_Reduce(sbuf,rbuf,count,type,op,root,comm);</code></pre><pre class="code"><code>MPI_Reduce(
void *sendbuf, void *recvbuf,
int count, // input per processor is a vector
MPI_Datatype datatype,
MPI_Op op, // associative operators (can be user defined)
int root,
MPI_Comm comm
);</code></pre><p>
Elementwise result stored in
<mark class="highlight-gray"><code>rbuf</code></mark><mark class="highlight-gray"></mark>
at root.
</p><p>
If
<mark class="highlight-gray"><code>MPI_IN_PLACE</code></mark><mark class="highlight-gray"></mark>
as argument for
<mark class="highlight-gray"><code>sbuf</code></mark>
, then input is taken from
<mark class="highlight-gray"><code>rbuf</code></mark>
.
</p><hr/><ul class="toggle"><li><details open=""><summary>Example: Single scalar</summary><pre class="code"><code>if (rank==root) {
x = rank;
MPI_Reduce(&amp;x,&amp;y,1,MPI_INT,MPI_SUM,root,comm);
if (y!=(size*(size-1))/2) printf("Error!\n");
// y significant at root only
} else {
x = rank;
MPI_Reduce(&amp;x,&amp;y,1,MPI_INT,MPI_SUM,root,comm);
}</code></pre></details></li></ul><ul class="toggle"><li><details open=""><summary>Example: Ring</summary><p>Root passes vector to next process ... and so on ... until it reaches root again.</p><p><mark class="highlight-teal">Idea</mark></p><div class="indented"><p><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>x</mi><mn>0</mn></msub><mo>+</mo><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msub><mi>x</mi><mn>2</mn></msub><mo>+</mo><msub><mi>x</mi><mn>3</mn></msub><mo>+</mo><mo>…</mo><mo>+</mo><msub><mi>x</mi><mrow><mi>p</mi><mo>−</mo><mn>2</mn></mrow></msub><mo>+</mo><msub><mi>x</mi><mrow><mi>p</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>=</mo><mi>y</mi></mstyle></mrow><annotation encoding="application/x-tex">
\small x_{0}+x_{1}+x_{2}+x_3+\ldots+x_{p-2}+x_{p-1}=y
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.6599970000000001em; vertical-align: -0.135em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.6599970000000001em; vertical-align: -0.135em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.6599970000000001em; vertical-align: -0.135em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.6599970000000001em; vertical-align: -0.135em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.599994em; vertical-align: -0.07499700000000001em"></span><span class="minner sizing reset-size6 size5">…</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.776661em; vertical-align: -0.25166400000000005em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.6391680000000001em; vertical-align: -0.25166400000000005em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2777777777777778em"></span><span class="mrel sizing reset-size6 size5">=</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height: 0.5625em; vertical-align: -0.174996em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.03588em">y</span></span></span></span></span><span>﻿</span></span></p><p><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mo stretchy="false">(</mo><msub><mi>x</mi><mn>0</mn></msub><mo>+</mo><msub><mi>x</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mn>2</mn></msub><mo>+</mo><msub><mi>x</mi><mn>3</mn></msub><mo stretchy="false">)</mo><mo>+</mo><mo>…</mo><mo>+</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mrow><mi>p</mi><mo>−</mo><mn>2</mn></mrow></msub><mo>+</mo><msub><mi>x</mi><mrow><mi>p</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo><mo>=</mo><mi>y</mi></mstyle></mrow><annotation encoding="application/x-tex">
\small (x_{0}+x_{1})+(x_{2}+x_3)+\ldots+(x_{p-2}+x_{p-1})=y
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mopen sizing reset-size6 size5">(</span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span><span class="mclose sizing reset-size6 size5">)</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mopen sizing reset-size6 size5">(</span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span><span class="mclose sizing reset-size6 size5">)</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.599994em; vertical-align: -0.07499700000000001em"></span><span class="minner sizing reset-size6 size5">…</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.9266640000000002em; vertical-align: -0.25166400000000005em"></span><span class="mopen sizing reset-size6 size5">(</span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.9266640000000002em; vertical-align: -0.25166400000000005em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span></span></span></span></span></span></span><span class="mclose sizing reset-size6 size5">)</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span><span class="mrel sizing reset-size6 size5">=</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height: 0.5625em; vertical-align: -0.174996em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.03588em">y</span></span></span></span></span><span>﻿</span></span></p><p><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mo stretchy="false">(</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mn>0</mn></msub><mo>+</mo><msub><mi>x</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mn>2</mn></msub><mo>+</mo><msub><mi>x</mi><mn>3</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>+</mo><mo>…</mo><mo>+</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mrow><mi>p</mi><mo>−</mo><mn>2</mn></mrow></msub><mo>+</mo><msub><mi>x</mi><mrow><mi>p</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>=</mo><mi>y</mi></mstyle></mrow><annotation encoding="application/x-tex">
\small ((x_{0}+x_{1})+(x_{2}+x_3))+\ldots+(x_{p-2}+x_{p-1}))=y
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mopen sizing reset-size6 size5">((</span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span><span class="mclose sizing reset-size6 size5">)</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mopen sizing reset-size6 size5">(</span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span><span class="mclose sizing reset-size6 size5">))</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.599994em; vertical-align: -0.07499700000000001em"></span><span class="minner sizing reset-size6 size5">…</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.9266640000000002em; vertical-align: -0.25166400000000005em"></span><span class="mopen sizing reset-size6 size5">(</span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.9266640000000002em; vertical-align: -0.25166400000000005em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span></span></span></span></span></span></span><span class="mclose sizing reset-size6 size5">))</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span><span class="mrel sizing reset-size6 size5">=</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height: 0.5625em; vertical-align: -0.174996em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.03588em">y</span></span></span></span></span><span>﻿</span></span></p><p><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>…</mo></mrow><annotation encoding="application/x-tex">\dots</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.12em; vertical-align: 0em"></span><span class="minner">…</span></span></span></span></span><span>﻿</span></span></p></div><p></p><p><mark class="highlight-teal">Creates a binomial tree</mark></p><div class="indented"><p>Root node is active in every communication round.</p><p>
Time complexity:
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mrow><mo fence="true">(</mo><msub><mrow><mi>log</mi><mo>⁡</mo></mrow><mn>2</mn></msub><mi>p</mi><mo fence="true">)</mo></mrow><mo stretchy="false">(</mo><mi>α</mi><mo>+</mo><mi>β</mi><mi>n</mi><mo>+</mo><mi>y</mi><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><mi>O</mi><mo stretchy="false">(</mo><msub><mrow><mi>log</mi><mo>⁡</mo></mrow><mn>2</mn></msub><mi>p</mi><mo stretchy="false">)</mo></mstyle></mrow><annotation encoding="application/x-tex">
\small \left(\log _{2} p\right)(\alpha+\beta n+y n) = O(\log_2p)
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.2725em"></span><span class="minner sizing reset-size6 size5"><span class="mopen sizing reset-size5 size6 delimcenter" style="top: 0.024999999999999994em">
(
</span><span class="mop"><span class="mop">
lo
<span style="margin-right: 0.01389em">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.16852em"><span style="top: -2.3388933333333335em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.26110666666666665em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.16666666666666666em"></span><span class="mord mathnormal">p</span><span class="mclose sizing reset-size5 size6 delimcenter" style="top: 0.024999999999999994em">
)
</span></span><span class="mspace" style="margin-right: 0.16666666666666666em"></span><span class="mopen sizing reset-size6 size5">(</span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.0037em">α</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.799992em; vertical-align: -0.174996em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.05278em">β</span><span class="mord mathnormal sizing reset-size6 size5">n</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.03588em">y</span><span class="mord mathnormal sizing reset-size6 size5">n</span><span class="mclose sizing reset-size6 size5">)</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span><span class="mrel sizing reset-size6 size5">=</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height: 0.909996em; vertical-align: -0.23499599999999998em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.02778em">O</span><span class="mopen sizing reset-size6 size5">(</span><span class="mop sizing reset-size6 size5"><span class="mop">
lo
<span style="margin-right: 0.01389em">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.16852em"><span style="top: -2.3388933333333335em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.26110666666666665em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size5">p</span><span class="mclose sizing reset-size6 size5">)</span></span></span></span></span><span>﻿</span></span></p><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2037.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2037.png" style="width: 144px"/></a></figure><p><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>r</mi><mo>=</mo><msub><mrow><mi>log</mi><mo>⁡</mo></mrow><mn>2</mn></msub><mi>p</mi></mstyle></mrow><annotation encoding="application/x-tex">\small r=\log _{2} p</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.387504em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.02778em">r</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span><span class="mrel sizing reset-size6 size5">=</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height: 0.859992em; vertical-align: -0.23499599999999998em"></span><span class="mop sizing reset-size6 size5"><span class="mop">
lo
<span style="margin-right: 0.01389em">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.16852em"><span style="top: -2.3388933333333335em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.26110666666666665em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.16666666666666666em"></span><span class="mord mathnormal sizing reset-size6 size5">p</span></span></span></span></span><span>﻿</span></span></p><p>
total levels =
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>r</mi><mo>+</mo><mn>1</mn></mstyle></mrow><annotation encoding="application/x-tex">\small r + 1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.599994em; vertical-align: -0.07499700000000001em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.02778em">r</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.5799960000000001em; vertical-align: 0em"></span><span class="mord sizing reset-size6 size5">1</span></span></span></span></span><span>﻿</span></span></p><p>
Number of nodes at level
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>k</mi></mstyle></mrow><annotation encoding="application/x-tex">\small k</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.624996em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.03148em">k</span></span></span></span></span><span>﻿</span></span>
where
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mn>0</mn><mo>≤</mo><mi>k</mi><mo>≤</mo><mi>r</mi></mstyle></mrow><annotation encoding="application/x-tex">\small 0 \leq k \leq r</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.702369em; vertical-align: -0.12237300000000001em"></span><span class="mord sizing reset-size6 size5">0</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span><span class="mrel sizing reset-size6 size5">≤</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height: 0.747369em; vertical-align: -0.12237300000000001em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.03148em">k</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span><span class="mrel sizing reset-size6 size5">≤</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height: 0.387504em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.02778em">r</span></span></span></span></span><span>﻿</span></span>
:
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mstyle mathsize="1.2em"><mrow><mo fence="true">(</mo><mfrac linethickness="0px"><mrow><mtext></mtext><mi>r</mi><mtext></mtext></mrow><mrow><mtext></mtext><mi>k</mi><mtext></mtext></mrow></mfrac><mo fence="true">)</mo></mrow><mstyle mathsize="0.9em"><mo>=</mo><mi>r</mi><mo stretchy="false">!</mo><mi mathvariant="normal">/</mi><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mi>r</mi><mo>−</mo><mi>k</mi><mo stretchy="false">)</mo><mo stretchy="false">!</mo><mi>k</mi><mo stretchy="false">!</mo><mo stretchy="false">)</mo></mstyle></mstyle></mstyle></mrow><annotation encoding="application/x-tex">
\small \large\binom{~r~}{~k~}\small =r ! /((r-k) ! k !)
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 1.324em; vertical-align: -0.414em"></span><span class="mord sizing reset-size6 size7"><span class="mopen sizing reset-size7 size6 delimcenter" style="top: -0.04999999999999999em"><span class="delimsizing size1">(</span></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.7310399999999999em"><span style="top: -2.455em"><span class="pstrut" style="height: 2.8em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mspace nobreak mtight"><span class="mtight"></span></span><span class="mord mathnormal mtight" style="margin-right: 0.03148em">
k
</span><span class="mspace nobreak mtight"><span class="mtight"></span></span></span></span></span><span style="top: -3.2439999999999998em"><span class="pstrut" style="height: 2.8em"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mspace nobreak mtight"><span class="mtight"></span></span><span class="mord mathnormal mtight" style="margin-right: 0.02778em">
r
</span><span class="mspace nobreak mtight"><span class="mtight"></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em"><span></span></span></span></span></span><span class="mclose sizing reset-size7 size6 delimcenter" style="top: -0.04999999999999999em"><span class="delimsizing size1">)</span></span></span><span class="mspace" style="margin-right: 0.2777777777777778em"></span><span class="mrel sizing reset-size6 size5">=</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.02778em">r</span><span class="mclose sizing reset-size6 size5">!</span><span class="mord sizing reset-size6 size5">/</span><span class="mopen sizing reset-size6 size5">((</span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.02778em">r</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">−</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.03148em">k</span><span class="mclose sizing reset-size6 size5">)!</span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right: 0.03148em">k</span><span class="mclose sizing reset-size6 size5">!)</span></span></span></span></span><span>﻿</span></span></p></div><p></p><p></p><p><mark class="highlight-teal">Algorithm</mark></p><div class="indented"><pre class="code"><code>bit = 0x1;while ((rank&amp;bit)==0x0 &amp; bit&lt;size) {
&lt;receive from rank|bit&gt; // bit set
bit &lt;&lt;= 1; // shift right
}
&lt;send to rank | (~bit)&gt; // mask out bit</code></pre><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2038.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2038.png" style="width: 288px"/></a></figure></div><p></p></details></li></ul></div><p></p><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2039.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2039.png" style="width: 84px"/></a></figure><p></p><p><mark class="highlight-blue">Allreduce</mark></p><div class="indented"><pre class="code"><code>MPI_Allreduce(sbuf,rbuf,count,type,op,comm);</code></pre><p>
Elementwise result stored in
<mark class="highlight-gray"><code>rbuf</code></mark><mark class="highlight-gray"></mark>
in every process.
</p><p>
If
<mark class="highlight-gray"><code>MPI_IN_PLACE</code></mark><mark class="highlight-gray"></mark>
as argument for
<mark class="highlight-gray"><code>sbuf</code></mark>
, then input is taken from
<mark class="highlight-gray"><code>rbuf</code></mark>
.
</p></div><p></p><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2040.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2040.png" style="width: 96px"/></a></figure><p></p><p><mark class="highlight-blue">Reduce_scatter_block</mark></p><div class="indented"><pre class="code"><code>MPI_Reduce_scatter_block(sbuf,rbuf,count,type,op,comm);</code></pre><ul class="toggle"><li><details open=""><summary>Alternative</summary><p>
Can also be expressed through
<mark class="highlight-gray"><code>Reduce_scatter</code></mark></p><p>Here we took an arbitrary size for the counts.</p><pre class="code"><code>MPI_Reduce_scatter_block(partial,result,n/p,MPI_FLOAT,MPI_SUM,comm);</code></pre><pre class="code"><code>for (i=0; i&lt;p; i++) counts[i] = n/p;
MPI_Reduce_scatter(partial,result,counts,MPI_FLOAT,MPI_SUM,comm);</code></pre><p></p></details></li></ul><p>
Elementwise result is scattered in same sized blocks, stored in
<mark class="highlight-gray"><code>rbuf</code></mark><mark class="highlight-gray"></mark>
for every process.
</p><p>
If
<mark class="highlight-gray"><code>MPI_IN_PLACE</code></mark><mark class="highlight-gray"></mark>
as argument for
<mark class="highlight-gray"><code>sbuf</code></mark>
, then input is taken from
<mark class="highlight-gray"><code>rbuf</code></mark>
.
</p><hr/><figure class="link-to-page"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Matrix-Vector%20multiplication%206b87a0f032e948739a0094a064dc675e.html"><span class="icon">📎</span>
Matrix-Vector multiplication
</a></figure></div><p></p><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2041.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2041.png" style="width: 192px"/></a></figure><p></p><p><mark class="highlight-blue">Reduce_scatter</mark></p><div class="indented"><pre class="code"><code>MPI_Reduce_scatter(sbuf,rbuf,counts,type,op,comm);</code></pre><p>
Same as
<mark class="highlight-gray"><code>Reduce_scatter_block</code></mark><mark class="highlight-gray"></mark>
but the block-sizes can differ.
</p><div class="indented"><p>
All processes must have the same
<mark class="highlight-gray"><code>counts[]</code></mark>
.
</p></div><p></p><p>
If
<mark class="highlight-gray"><code>MPI_IN_PLACE</code></mark><mark class="highlight-gray"></mark>
as argument for
<mark class="highlight-gray"><code>sbuf</code></mark>
, then input is taken from
<mark class="highlight-gray"><code>rbuf</code></mark>
.
</p></div><p></p><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2042.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2042.png" style="width: 192px"/></a></figure><p></p><h2>Scan collectives</h2><p><em><mark class="highlight-blue">About scan collectives</mark></em></p><div class="indented"><ul class="bulleted-list"><li style="list-style-type: disc">
Each process has vector of data
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mover accent="true"><mi>x</mi><mo>⃗</mo></mover></mstyle></mrow><annotation encoding="application/x-tex">\small \vec x</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.6426em; vertical-align: 0em"></span><span class="mord accent sizing reset-size6 size5"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.714em"><span style="top: -2.9em"><span class="pstrut" style="height: 2.9em"></span><span class="mord mathnormal">x</span></span><span style="top: -2.9em"><span class="pstrut" style="height: 2.9em"></span><span class="accent-body" style="left: -0.20772em"><span class="overlay" style="height: 0.714em; width: 0.471em"><svg height="0.714em" preserveaspectratio="xMinYMin" style="width: 0.471em" viewbox="0 0 471 714" width="0.471em"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>
(same size, same type)
</li></ul><ul class="bulleted-list"><li style="list-style-type: disc">
Associative operation
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mo>+</mo></mstyle></mrow><annotation encoding="application/x-tex">\small +</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.599994em; vertical-align: -0.07499700000000001em"></span><span class="mord sizing reset-size6 size5">+</span></span></span></span></span><span>﻿</span></span>
(built in MPI or user defined)
<p>
for element wise calculation of prefix sums
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>y</mi><mi>i</mi></msub><mo>=</mo><msub><mover accent="true"><mi>x</mi><mo>⃗</mo></mover><mn>0</mn></msub><mo>+</mo><msub><mover accent="true"><mi>x</mi><mo>⃗</mo></mover><mn>1</mn></msub><mo>+</mo><msub><mover accent="true"><mi>x</mi><mo>⃗</mo></mover><mn>2</mn></msub><mo>+</mo><mo>…</mo><mo>+</mo><msub><mover accent="true"><mi>x</mi><mo>⃗</mo></mover><mrow><mi>p</mi><mo>−</mo><mn>1</mn></mrow></msub></mstyle></mrow><annotation encoding="application/x-tex">
\small y_i = \vec x_0+\vec x_1+\vec x_2+ … +\vec x_{p-1}
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.5625em; vertical-align: -0.174996em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal" style="margin-right: 0.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.28967999999999994em"><span style="top: -2.45em; margin-left: -0.03588em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2777777777777778em"></span><span class="mrel sizing reset-size6 size5">=</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height: 0.7776em; vertical-align: -0.135em"></span><span class="mord sizing reset-size6 size5"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.714em"><span style="top: -2.9em"><span class="pstrut" style="height: 2.9em"></span><span class="mord mathnormal">x</span></span><span style="top: -2.9em"><span class="pstrut" style="height: 2.9em"></span><span class="accent-body" style="left: -0.20772em"><span class="overlay" style="height: 0.714em; width: 0.471em"><svg height="0.714em" preserveaspectratio="xMinYMin" style="width: 0.471em" viewbox="0 0 471 714" width="0.471em"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.7776em; vertical-align: -0.135em"></span><span class="mord sizing reset-size6 size5"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.714em"><span style="top: -2.9em"><span class="pstrut" style="height: 2.9em"></span><span class="mord mathnormal">x</span></span><span style="top: -2.9em"><span class="pstrut" style="height: 2.9em"></span><span class="accent-body" style="left: -0.20772em"><span class="overlay" style="height: 0.714em; width: 0.471em"><svg height="0.714em" preserveaspectratio="xMinYMin" style="width: 0.471em" viewbox="0 0 471 714" width="0.471em"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.7776em; vertical-align: -0.135em"></span><span class="mord sizing reset-size6 size5"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.714em"><span style="top: -2.9em"><span class="pstrut" style="height: 2.9em"></span><span class="mord mathnormal">x</span></span><span style="top: -2.9em"><span class="pstrut" style="height: 2.9em"></span><span class="accent-body" style="left: -0.20772em"><span class="overlay" style="height: 0.714em; width: 0.471em"><svg height="0.714em" preserveaspectratio="xMinYMin" style="width: 0.471em" viewbox="0 0 471 714" width="0.471em"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.599994em; vertical-align: -0.07499700000000001em"></span><span class="minner sizing reset-size6 size5">…</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.894264em; vertical-align: -0.25166400000000005em"></span><span class="mord sizing reset-size6 size5"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.714em"><span style="top: -2.9em"><span class="pstrut" style="height: 2.9em"></span><span class="mord mathnormal">x</span></span><span style="top: -2.9em"><span class="pstrut" style="height: 2.9em"></span><span class="accent-body" style="left: -0.20772em"><span class="overlay" style="height: 0.714em; width: 0.471em"><svg height="0.714em" preserveaspectratio="xMinYMin" style="width: 0.471em" viewbox="0 0 471 714" width="0.471em"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span style="top: -2.45em; margin-left: 0em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2796266666666667em"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span></p><p><mark class="highlight-gray"><em>associative means brackets don’t influence result</em></mark><mark class="highlight-gray"><em><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mo stretchy="false">(</mo><mi>a</mi><mo>+</mo><mi>b</mi><mo stretchy="false">)</mo><mo>+</mo><mi>c</mi><mo>=</mo><mi>a</mi><mo>+</mo><mo stretchy="false">(</mo><mi>b</mi><mo>+</mo><mi>c</mi><mo stretchy="false">)</mo></mstyle></mrow><annotation encoding="application/x-tex">\small (a + b) + c = a + (b + c)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mopen sizing reset-size6 size5">(</span><span class="mord mathnormal sizing reset-size6 size5">a</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5">b</span><span class="mclose sizing reset-size6 size5">)</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.387504em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5">c</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span><span class="mrel sizing reset-size6 size5">=</span><span class="mspace" style="margin-right: 0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height: 0.599994em; vertical-align: -0.07499700000000001em"></span><span class="mord mathnormal sizing reset-size6 size5">a</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mopen sizing reset-size6 size5">(</span><span class="mord mathnormal sizing reset-size6 size5">b</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.9em; vertical-align: -0.225em"></span><span class="mord mathnormal sizing reset-size6 size5">c</span><span class="mclose sizing reset-size6 size5">)</span></span></span></span></span><span>﻿</span></span></em></mark></p></li></ul><ul class="bulleted-list"><li style="list-style-type: disc">
stored in
<p><mark class="highlight-gray"><code>MPI_Scan</code></mark><mark class="highlight-gray"></mark><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>y</mi><mi>i</mi></msub></mstyle></mrow><annotation encoding="application/x-tex">\small y_i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.5625em; vertical-align: -0.174996em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal" style="margin-right: 0.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.28967999999999994em"><span style="top: -2.45em; margin-left: -0.03588em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"></mstyle></mrow><annotation encoding="application/x-tex">\small</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"></span></span></span><span>﻿</span></span>
at rank
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>i</mi></mstyle></mrow><annotation encoding="application/x-tex">\small i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.593568em; vertical-align: 0em"></span><span class="mord mathnormal sizing reset-size6 size5">i</span></span></span></span></span><span>﻿</span></span></p><p><mark class="highlight-gray"><code>MPI_Exscan</code></mark><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>y</mi><mi>i</mi></msub></mstyle></mrow><annotation encoding="application/x-tex">\small y_i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.5625em; vertical-align: -0.174996em"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal" style="margin-right: 0.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.28967999999999994em"><span style="top: -2.45em; margin-left: -0.03588em; margin-right: 0.05555555555555556em"><span class="pstrut" style="height: 2.6em"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span><style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"></mstyle></mrow><annotation encoding="application/x-tex">\small</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"></span></span></span><span>﻿</span></span>
at rank
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>i</mi><mo>+</mo><mn>1</mn></mstyle></mrow><annotation encoding="application/x-tex">\small i+1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.668565em; vertical-align: -0.07499700000000001em"></span><span class="mord mathnormal sizing reset-size6 size5">i</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right: 0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height: 0.5799960000000001em; vertical-align: 0em"></span><span class="mord sizing reset-size6 size5">1</span></span></span></span></span><span>﻿</span></span>
(undefined for rank
<style>
@import url("https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css");
</style><span class="notion-text-equation-token" contenteditable="false" data-token-index="0" style="user-select: all; -webkit-user-select: all; -moz-user-select: all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mn>0</mn></mstyle></mrow><annotation encoding="application/x-tex">\small 0</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height: 0.5799960000000001em; vertical-align: 0em"></span><span class="mord sizing reset-size6 size5">0</span></span></span></span></span><span>﻿</span></span>
)
</p></li></ul></div><p></p><p></p><p><mark class="highlight-blue">Scan (inclusive prefix sum)</mark></p><div class="indented"><pre class="code"><code>MPI_Scan(sbuf,rbuf,count,type,op,comm);</code></pre><p>
Elementwise prefix sums over
<mark class="highlight-gray"><code>sbuf</code></mark><mark class="highlight-gray"></mark>
vectors.
</p><p>
Rank
<mark class="highlight-gray"><code>i</code></mark><mark class="highlight-gray"></mark>
stores sum from rank 0 to i (included).
</p></div><p></p><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2043.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2043.png" style="width: 108px"/></a></figure><p></p><p><mark class="highlight-blue">Exscan (exclusive prefix sum)</mark></p><div class="indented"><pre class="code"><code>MPI_Exscan(sbuf,rbuf,count,type,op,comm);</code></pre><p>
Elementwise prefix sums over
<mark class="highlight-gray"><code>sbuf</code></mark><mark class="highlight-gray"></mark>
vectors.
</p><p>
Rank
<mark class="highlight-gray"><code>i</code></mark><mark class="highlight-gray"></mark>
stores sum from rank 0 to i (included).
</p><hr/><figure class="link-to-page"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Quicksort%202036de6282044d22938d7fa086a8cf80.html"><span class="icon">📎</span>
Quicksort
</a></figure></div><p></p><figure class="image"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2044.png"><img src="MPI%2020fd651f521e4ebebc3762c8dee24adb/Untitled%2044.png" style="width: 108px"/></a></figure><p></p><figure class="link-to-page"><a href="MPI%2020fd651f521e4ebebc3762c8dee24adb/Bucket-sort%2018632432d6a846b3ac1876b0b1c39643.html"><span class="icon">📎</span>
Bucket-sort
</a></figure></div></article></body></html>